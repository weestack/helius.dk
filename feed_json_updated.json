{"version": "https://jsonfeed.org/version/1", "title": "Helius", "home_page_url": "https://helius.dk/", "feed_url": "https://helius.dk/feed_json_updated.json", "description": "Personal website and blog og Alexander H\u00f8gh", "icon": null, "authors": [], "language": "en", "items": [{"id": "https://helius.dk/blog/2026/02/01/simd-getting-started/", "url": "https://helius.dk/blog/2026/02/01/simd-getting-started/", "title": "SIMD getting started", "content_html": "<p><img alt=\"Math dots spanning and twisting\" src=\"/static/SIMD_getting_started/hero_image_numbers.jpg\" /></p>\n<h1 id=\"simd-getting-started\">SIMD getting started</h1>\n<p>SIMD (Single Instruction, Multiple Data), in simple terms, refers to CPU instructions that allow computations to take place in parallel. While standard instructions typically execute one at a time (scalar), SIMD performs multiple calculations simultaneously. For example, you can process 8 data points in a single clock cycle, significantly optimizing both performance and power efficiency.  </p>\n<p>This post focuses on NEON (ARM's SIMD architecture) rather than <a href=\"https://doc.rust-lang.org/std/simd/index.html\">Rust's standard SIMD library</a>, simply because I prefer the control of specialization over generalization.</p>\n<!-- more -->\n<h2 id=\"following-the-guide\">Following the guide</h2>\n<p>ARM Developers provides a guide for getting started with NEON by taking an existing x86_64 (AVX) example and converting it to NEON using <a href=\"SIMD.info\">SIMD.info</a> to find the relevant counterparts.<br />\n<a href=\"https://learn.arm.com/learning-paths/cross-platform/simd-info-demo/simdinfo-example1/\">Reference program com arm.com</a>.</p>\n<div class=\"language-C highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;xmmintrin.h&gt;</span>\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;stdio.h&gt;</span>\n</span><span id=\"__span-0-3\"><a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a>\n</span><span id=\"__span-0-4\"><a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-0-5\"><a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"w\">    </span><span class=\"kr\">__m128</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_mm_set_ps</span><span class=\"p\">(</span><span class=\"mf\">16.0f</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mf\">9.0f</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mf\">4.0f</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mf\">1.0f</span><span class=\"p\">);</span>\n</span><span id=\"__span-0-6\"><a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"w\">    </span><span class=\"kr\">__m128</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_mm_set_ps</span><span class=\"p\">(</span><span class=\"mf\">4.0f</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mf\">3.0f</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mf\">2.0f</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mf\">1.0f</span><span class=\"p\">);</span>\n</span><span id=\"__span-0-7\"><a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a>\n</span><span id=\"__span-0-8\"><a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a><span class=\"w\">    </span><span class=\"kr\">__m128</span><span class=\"w\"> </span><span class=\"n\">cmp_result</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_mm_cmpgt_ps</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">);</span>\n</span><span id=\"__span-0-9\"><a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a>\n</span><span id=\"__span-0-10\"><a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\" href=\"#__codelineno-0-10\"></a><span class=\"w\">    </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">a_arr</span><span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">b_arr</span><span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">cmp_arr</span><span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">];</span>\n</span><span id=\"__span-0-11\"><a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\" href=\"#__codelineno-0-11\"></a><span class=\"w\">    </span><span class=\"n\">_mm_storeu_ps</span><span class=\"p\">(</span><span class=\"n\">a_arr</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"p\">);</span>\n</span><span id=\"__span-0-12\"><a id=\"__codelineno-0-12\" name=\"__codelineno-0-12\" href=\"#__codelineno-0-12\"></a><span class=\"w\">    </span><span class=\"n\">_mm_storeu_ps</span><span class=\"p\">(</span><span class=\"n\">b_arr</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">);</span>\n</span><span id=\"__span-0-13\"><a id=\"__codelineno-0-13\" name=\"__codelineno-0-13\" href=\"#__codelineno-0-13\"></a><span class=\"w\">    </span><span class=\"n\">_mm_storeu_ps</span><span class=\"p\">(</span><span class=\"n\">cmp_arr</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cmp_result</span><span class=\"p\">);</span>\n</span><span id=\"__span-0-14\"><a id=\"__codelineno-0-14\" name=\"__codelineno-0-14\" href=\"#__codelineno-0-14\"></a>\n</span><span id=\"__span-0-15\"><a id=\"__codelineno-0-15\" name=\"__codelineno-0-15\" href=\"#__codelineno-0-15\"></a><span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">++</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-0-16\"><a id=\"__codelineno-0-16\" name=\"__codelineno-0-16\" href=\"#__codelineno-0-16\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">cmp_arr</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"mf\">0.0f</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-0-17\"><a id=\"__codelineno-0-17\" name=\"__codelineno-0-17\" href=\"#__codelineno-0-17\"></a><span class=\"w\">            </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;Element %d: %.2f is larger than %.2f</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">a_arr</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">b_arr</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]);</span>\n</span><span id=\"__span-0-18\"><a id=\"__codelineno-0-18\" name=\"__codelineno-0-18\" href=\"#__codelineno-0-18\"></a><span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-0-19\"><a id=\"__codelineno-0-19\" name=\"__codelineno-0-19\" href=\"#__codelineno-0-19\"></a><span class=\"w\">            </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;Element %d: %.2f is not larger than %.2f</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">a_arr</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">b_arr</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]);</span>\n</span><span id=\"__span-0-20\"><a id=\"__codelineno-0-20\" name=\"__codelineno-0-20\" href=\"#__codelineno-0-20\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n</span><span id=\"__span-0-21\"><a id=\"__codelineno-0-21\" name=\"__codelineno-0-21\" href=\"#__codelineno-0-21\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-0-22\"><a id=\"__codelineno-0-22\" name=\"__codelineno-0-22\" href=\"#__codelineno-0-22\"></a>\n</span><span id=\"__span-0-23\"><a id=\"__codelineno-0-23\" name=\"__codelineno-0-23\" href=\"#__codelineno-0-23\"></a><span class=\"w\">    </span><span class=\"kr\">__m128</span><span class=\"w\"> </span><span class=\"n\">add_result</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_mm_add_ps</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">);</span>\n</span><span id=\"__span-0-24\"><a id=\"__codelineno-0-24\" name=\"__codelineno-0-24\" href=\"#__codelineno-0-24\"></a><span class=\"w\">    </span><span class=\"kr\">__m128</span><span class=\"w\"> </span><span class=\"n\">mul_result</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_mm_mul_ps</span><span class=\"p\">(</span><span class=\"n\">add_result</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">);</span>\n</span><span id=\"__span-0-25\"><a id=\"__codelineno-0-25\" name=\"__codelineno-0-25\" href=\"#__codelineno-0-25\"></a><span class=\"w\">    </span><span class=\"kr\">__m128</span><span class=\"w\"> </span><span class=\"n\">sqrt_result</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_mm_sqrt_ps</span><span class=\"p\">(</span><span class=\"n\">mul_result</span><span class=\"p\">);</span>\n</span><span id=\"__span-0-26\"><a id=\"__codelineno-0-26\" name=\"__codelineno-0-26\" href=\"#__codelineno-0-26\"></a>\n</span><span id=\"__span-0-27\"><a id=\"__codelineno-0-27\" name=\"__codelineno-0-27\" href=\"#__codelineno-0-27\"></a><span class=\"w\">    </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">];</span>\n</span><span id=\"__span-0-28\"><a id=\"__codelineno-0-28\" name=\"__codelineno-0-28\" href=\"#__codelineno-0-28\"></a>\n</span><span id=\"__span-0-29\"><a id=\"__codelineno-0-29\" name=\"__codelineno-0-29\" href=\"#__codelineno-0-29\"></a><span class=\"w\">    </span><span class=\"n\">_mm_storeu_ps</span><span class=\"p\">(</span><span class=\"n\">res</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">add_result</span><span class=\"p\">);</span>\n</span><span id=\"__span-0-30\"><a id=\"__codelineno-0-30\" name=\"__codelineno-0-30\" href=\"#__codelineno-0-30\"></a><span class=\"w\">    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;Addition Result: %f %f %f %f</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">]);</span>\n</span><span id=\"__span-0-31\"><a id=\"__codelineno-0-31\" name=\"__codelineno-0-31\" href=\"#__codelineno-0-31\"></a>\n</span><span id=\"__span-0-32\"><a id=\"__codelineno-0-32\" name=\"__codelineno-0-32\" href=\"#__codelineno-0-32\"></a><span class=\"w\">    </span><span class=\"n\">_mm_storeu_ps</span><span class=\"p\">(</span><span class=\"n\">res</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">mul_result</span><span class=\"p\">);</span>\n</span><span id=\"__span-0-33\"><a id=\"__codelineno-0-33\" name=\"__codelineno-0-33\" href=\"#__codelineno-0-33\"></a><span class=\"w\">    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;Multiplication Result: %f %f %f %f</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">]);</span>\n</span><span id=\"__span-0-34\"><a id=\"__codelineno-0-34\" name=\"__codelineno-0-34\" href=\"#__codelineno-0-34\"></a>\n</span><span id=\"__span-0-35\"><a id=\"__codelineno-0-35\" name=\"__codelineno-0-35\" href=\"#__codelineno-0-35\"></a><span class=\"w\">    </span><span class=\"n\">_mm_storeu_ps</span><span class=\"p\">(</span><span class=\"n\">res</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sqrt_result</span><span class=\"p\">);</span>\n</span><span id=\"__span-0-36\"><a id=\"__codelineno-0-36\" name=\"__codelineno-0-36\" href=\"#__codelineno-0-36\"></a><span class=\"w\">    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;Square Root Result: %f %f %f %f</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">]);</span>\n</span><span id=\"__span-0-37\"><a id=\"__codelineno-0-37\" name=\"__codelineno-0-37\" href=\"#__codelineno-0-37\"></a>\n</span><span id=\"__span-0-38\"><a id=\"__codelineno-0-38\" name=\"__codelineno-0-38\" href=\"#__codelineno-0-38\"></a><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n</span><span id=\"__span-0-39\"><a id=\"__codelineno-0-39\" name=\"__codelineno-0-39\" href=\"#__codelineno-0-39\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>Here is my version of a counterpart in rust:\n<div class=\"language-Rust highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">arch</span><span class=\"p\">::</span><span class=\"n\">aarch64</span><span class=\"p\">::{</span>\n</span><span id=\"__span-1-2\"><a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"w\">    </span><span class=\"n\">vaddq_f32</span><span class=\"p\">,</span><span class=\"w\"> </span>\n</span><span id=\"__span-1-3\"><a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"w\">    </span><span class=\"n\">vcgtq_f32</span><span class=\"p\">,</span><span class=\"w\"> </span>\n</span><span id=\"__span-1-4\"><a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"w\">    </span><span class=\"n\">vld1q_f32</span><span class=\"p\">,</span><span class=\"w\"> </span>\n</span><span id=\"__span-1-5\"><a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"w\">    </span><span class=\"n\">vmulq_f32</span><span class=\"p\">,</span><span class=\"w\"> </span>\n</span><span id=\"__span-1-6\"><a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"w\">    </span><span class=\"n\">vsqrtq_f32</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-7\"><a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"w\">    </span><span class=\"n\">float32x4_t</span><span class=\"p\">,</span><span class=\"w\"> </span>\n</span><span id=\"__span-1-8\"><a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a><span class=\"w\">    </span><span class=\"n\">vgetq_lane_f32</span><span class=\"p\">,</span><span class=\"w\"> </span>\n</span><span id=\"__span-1-9\"><a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a><span class=\"p\">};</span>\n</span><span id=\"__span-1-10\"><a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a>\n</span><span id=\"__span-1-11\"><a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-12\"><a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a><span class=\"w\">    </span><span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-13\"><a id=\"__codelineno-1-13\" name=\"__codelineno-1-13\" href=\"#__codelineno-1-13\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">a_vec</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"mf\">16.0</span><span class=\"k\">f32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mf\">9.0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mf\">4.0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mf\">1.0</span><span class=\"p\">];</span>\n</span><span id=\"__span-1-14\"><a id=\"__codelineno-1-14\" name=\"__codelineno-1-14\" href=\"#__codelineno-1-14\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">b_vec</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"mf\">4.0</span><span class=\"k\">f32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mf\">3.0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mf\">2.0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mf\">2.0</span><span class=\"p\">];</span>\n</span><span id=\"__span-1-15\"><a id=\"__codelineno-1-15\" name=\"__codelineno-1-15\" href=\"#__codelineno-1-15\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">float32x4_t</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">vld1q_f32</span><span class=\"p\">(</span><span class=\"n\">a_vec</span><span class=\"p\">.</span><span class=\"n\">as_ptr</span><span class=\"p\">());</span>\n</span><span id=\"__span-1-16\"><a id=\"__codelineno-1-16\" name=\"__codelineno-1-16\" href=\"#__codelineno-1-16\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">float32x4_t</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">vld1q_f32</span><span class=\"p\">(</span><span class=\"n\">b_vec</span><span class=\"p\">.</span><span class=\"n\">as_ptr</span><span class=\"p\">());</span>\n</span><span id=\"__span-1-17\"><a id=\"__codelineno-1-17\" name=\"__codelineno-1-17\" href=\"#__codelineno-1-17\"></a>\n</span><span id=\"__span-1-18\"><a id=\"__codelineno-1-18\" name=\"__codelineno-1-18\" href=\"#__codelineno-1-18\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">cmp</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">vcgtq_f32</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-19\"><a id=\"__codelineno-1-19\" name=\"__codelineno-1-19\" href=\"#__codelineno-1-19\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">lanes</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"kt\">u32</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">mem</span><span class=\"p\">::</span><span class=\"n\">transmute</span><span class=\"p\">(</span><span class=\"n\">cmp</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-20\"><a id=\"__codelineno-1-20\" name=\"__codelineno-1-20\" href=\"#__codelineno-1-20\"></a>\n</span><span id=\"__span-1-21\"><a id=\"__codelineno-1-21\" name=\"__codelineno-1-21\" href=\"#__codelineno-1-21\"></a><span class=\"w\">        </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">..</span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-22\"><a id=\"__codelineno-1-22\" name=\"__codelineno-1-22\" href=\"#__codelineno-1-22\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">lanes</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-23\"><a id=\"__codelineno-1-23\" name=\"__codelineno-1-23\" href=\"#__codelineno-1-23\"></a><span class=\"w\">                </span><span class=\"fm\">println!</span><span class=\"p\">(</span><span class=\"s\">&quot;{} is greater than {}&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">a_vec</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">b_vec</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]);</span>\n</span><span id=\"__span-1-24\"><a id=\"__codelineno-1-24\" name=\"__codelineno-1-24\" href=\"#__codelineno-1-24\"></a><span class=\"w\">            </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-25\"><a id=\"__codelineno-1-25\" name=\"__codelineno-1-25\" href=\"#__codelineno-1-25\"></a><span class=\"w\">                </span><span class=\"fm\">println!</span><span class=\"p\">(</span><span class=\"s\">&quot;{} is not greater than {}&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">a_vec</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">b_vec</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]);</span>\n</span><span id=\"__span-1-26\"><a id=\"__codelineno-1-26\" name=\"__codelineno-1-26\" href=\"#__codelineno-1-26\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-27\"><a id=\"__codelineno-1-27\" name=\"__codelineno-1-27\" href=\"#__codelineno-1-27\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-28\"><a id=\"__codelineno-1-28\" name=\"__codelineno-1-28\" href=\"#__codelineno-1-28\"></a>\n</span><span id=\"__span-1-29\"><a id=\"__codelineno-1-29\" name=\"__codelineno-1-29\" href=\"#__codelineno-1-29\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">add_result</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">vaddq_f32</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-30\"><a id=\"__codelineno-1-30\" name=\"__codelineno-1-30\" href=\"#__codelineno-1-30\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">mul_result</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">vmulq_f32</span><span class=\"p\">(</span><span class=\"n\">add_result</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-31\"><a id=\"__codelineno-1-31\" name=\"__codelineno-1-31\" href=\"#__codelineno-1-31\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">sqrt_result</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">vsqrtq_f32</span><span class=\"p\">(</span><span class=\"n\">mul_result</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-32\"><a id=\"__codelineno-1-32\" name=\"__codelineno-1-32\" href=\"#__codelineno-1-32\"></a><span class=\"w\">        </span><span class=\"fm\">println!</span><span class=\"p\">(</span>\n</span><span id=\"__span-1-33\"><a id=\"__codelineno-1-33\" name=\"__codelineno-1-33\" href=\"#__codelineno-1-33\"></a><span class=\"w\">            </span><span class=\"s\">&quot;Addition results: {} {} {} {}&quot;</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-34\"><a id=\"__codelineno-1-34\" name=\"__codelineno-1-34\" href=\"#__codelineno-1-34\"></a><span class=\"w\">            </span><span class=\"n\">vgetq_lane_f32</span><span class=\"p\">(</span><span class=\"n\">add_result</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">),</span>\n</span><span id=\"__span-1-35\"><a id=\"__codelineno-1-35\" name=\"__codelineno-1-35\" href=\"#__codelineno-1-35\"></a><span class=\"w\">            </span><span class=\"n\">vgetq_lane_f32</span><span class=\"p\">(</span><span class=\"n\">add_result</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">),</span>\n</span><span id=\"__span-1-36\"><a id=\"__codelineno-1-36\" name=\"__codelineno-1-36\" href=\"#__codelineno-1-36\"></a><span class=\"w\">            </span><span class=\"n\">vgetq_lane_f32</span><span class=\"p\">(</span><span class=\"n\">add_result</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">),</span>\n</span><span id=\"__span-1-37\"><a id=\"__codelineno-1-37\" name=\"__codelineno-1-37\" href=\"#__codelineno-1-37\"></a><span class=\"w\">            </span><span class=\"n\">vgetq_lane_f32</span><span class=\"p\">(</span><span class=\"n\">add_result</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">)</span>\n</span><span id=\"__span-1-38\"><a id=\"__codelineno-1-38\" name=\"__codelineno-1-38\" href=\"#__codelineno-1-38\"></a><span class=\"w\">        </span><span class=\"p\">);</span>\n</span><span id=\"__span-1-39\"><a id=\"__codelineno-1-39\" name=\"__codelineno-1-39\" href=\"#__codelineno-1-39\"></a>\n</span><span id=\"__span-1-40\"><a id=\"__codelineno-1-40\" name=\"__codelineno-1-40\" href=\"#__codelineno-1-40\"></a><span class=\"w\">        </span><span class=\"fm\">println!</span><span class=\"p\">(</span>\n</span><span id=\"__span-1-41\"><a id=\"__codelineno-1-41\" name=\"__codelineno-1-41\" href=\"#__codelineno-1-41\"></a><span class=\"w\">            </span><span class=\"s\">&quot;Multiplication results: {} {} {} {}&quot;</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-42\"><a id=\"__codelineno-1-42\" name=\"__codelineno-1-42\" href=\"#__codelineno-1-42\"></a><span class=\"w\">            </span><span class=\"n\">vgetq_lane_f32</span><span class=\"p\">(</span><span class=\"n\">mul_result</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">),</span>\n</span><span id=\"__span-1-43\"><a id=\"__codelineno-1-43\" name=\"__codelineno-1-43\" href=\"#__codelineno-1-43\"></a><span class=\"w\">            </span><span class=\"n\">vgetq_lane_f32</span><span class=\"p\">(</span><span class=\"n\">mul_result</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">),</span>\n</span><span id=\"__span-1-44\"><a id=\"__codelineno-1-44\" name=\"__codelineno-1-44\" href=\"#__codelineno-1-44\"></a><span class=\"w\">            </span><span class=\"n\">vgetq_lane_f32</span><span class=\"p\">(</span><span class=\"n\">mul_result</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">),</span>\n</span><span id=\"__span-1-45\"><a id=\"__codelineno-1-45\" name=\"__codelineno-1-45\" href=\"#__codelineno-1-45\"></a><span class=\"w\">            </span><span class=\"n\">vgetq_lane_f32</span><span class=\"p\">(</span><span class=\"n\">mul_result</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">)</span>\n</span><span id=\"__span-1-46\"><a id=\"__codelineno-1-46\" name=\"__codelineno-1-46\" href=\"#__codelineno-1-46\"></a><span class=\"w\">        </span><span class=\"p\">);</span>\n</span><span id=\"__span-1-47\"><a id=\"__codelineno-1-47\" name=\"__codelineno-1-47\" href=\"#__codelineno-1-47\"></a>\n</span><span id=\"__span-1-48\"><a id=\"__codelineno-1-48\" name=\"__codelineno-1-48\" href=\"#__codelineno-1-48\"></a><span class=\"w\">        </span><span class=\"fm\">println!</span><span class=\"p\">(</span>\n</span><span id=\"__span-1-49\"><a id=\"__codelineno-1-49\" name=\"__codelineno-1-49\" href=\"#__codelineno-1-49\"></a><span class=\"w\">            </span><span class=\"s\">&quot;Square Root results: {} {} {} {}&quot;</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-50\"><a id=\"__codelineno-1-50\" name=\"__codelineno-1-50\" href=\"#__codelineno-1-50\"></a><span class=\"w\">            </span><span class=\"n\">vgetq_lane_f32</span><span class=\"p\">(</span><span class=\"n\">sqrt_result</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">),</span>\n</span><span id=\"__span-1-51\"><a id=\"__codelineno-1-51\" name=\"__codelineno-1-51\" href=\"#__codelineno-1-51\"></a><span class=\"w\">            </span><span class=\"n\">vgetq_lane_f32</span><span class=\"p\">(</span><span class=\"n\">sqrt_result</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">),</span>\n</span><span id=\"__span-1-52\"><a id=\"__codelineno-1-52\" name=\"__codelineno-1-52\" href=\"#__codelineno-1-52\"></a><span class=\"w\">            </span><span class=\"n\">vgetq_lane_f32</span><span class=\"p\">(</span><span class=\"n\">sqrt_result</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">),</span>\n</span><span id=\"__span-1-53\"><a id=\"__codelineno-1-53\" name=\"__codelineno-1-53\" href=\"#__codelineno-1-53\"></a><span class=\"w\">            </span><span class=\"n\">vgetq_lane_f32</span><span class=\"p\">(</span><span class=\"n\">sqrt_result</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">)</span>\n</span><span id=\"__span-1-54\"><a id=\"__codelineno-1-54\" name=\"__codelineno-1-54\" href=\"#__codelineno-1-54\"></a><span class=\"w\">        </span><span class=\"p\">);</span>\n</span><span id=\"__span-1-55\"><a id=\"__codelineno-1-55\" name=\"__codelineno-1-55\" href=\"#__codelineno-1-55\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-56\"><a id=\"__codelineno-1-56\" name=\"__codelineno-1-56\" href=\"#__codelineno-1-56\"></a><span class=\"p\">}</span>\n</span></code></pre></div></p>\n<h2 id=\"breaking-it-down\">Breaking it down</h2>\n<p>We are primarily looking at vector instructions across <span class=\"arithmatex\">\\(N\\)</span> lanes.<br />\nEach lane holds a specific number of bits; the bit-width of the register determines how many lanes you can use. For example, a 128-bit register can be split into four 32-bit lanes.</p>\n<blockquote>\n<p><code>float32x4_t</code>: A register containing four 32-bit lanes, totaling 128 bits of memory.</p>\n<p><code>vld1q_f32</code>: Loads an array into a 128-bit float32x4_t register.</p>\n<p><code>vaddq_f32</code>: Takes two float32x4_t vectors and adds their corresponding elements (e.g., index 0 of the first vector is added to index 0 of the second).</p>\n<p><code>vcgtq_f32</code>: Compares elements of two vectors to determine if the first is \"Greater Than\" the second. It returns 0 for false and the 32-bit maximum (all bits set to 1) for true.</p>\n<p><code>vmulq_f32</code>: Multiplies the corresponding elements of two vectors.</p>\n<p><code>vsqrtq_f32</code>: Calculates the square root of each individual element in the vector.</p>\n<p><code>vgetq_lane_f32</code>: Extracts the value from a specific lane within a 4-lane vector.</p>\n</blockquote>\n<p>The remaining code uses standard Rust patterns which we won't cover in detail here.</p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Compilation Create a file named <code>arm_example.rs</code> and compile it using the optimization flag:</p>\n</div>\n<div class=\"language-Bash highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a>rustc<span class=\"w\"> </span>-O<span class=\"w\"> </span>arm_example.rs\n</span></code></pre></div>\n<figure>\n<p>After compiling, you can run the program to see the parallel results:\n<img alt=\"Arm example program output\" src=\"/static/SIMD_getting_started/running_arm_example.png\" /></p>\n<figcaption>\n<p>Arm example program output</p>\n</figcaption>\n</figure>", "image": null, "date_modified": "2026-02-01T08:36:08+00:00", "authors": [{"name": "Alexander H\u00f8gh"}], "tags": ["CPU Instructions", "Rust", "Rust", "SIMD"]}, {"id": "https://helius.dk/blog/2026/01/28/hot-reloading/", "url": "https://helius.dk/blog/2026/01/28/hot-reloading/", "title": "Hot reloading", "content_html": "<p><img alt=\"Red canvas of components comming in and out\" src=\"/static/hot_reloading/header_image.jpg\" /></p>\n<h1 id=\"hot-reloading\">Hot reloading</h1>\n<p>Hot reloading is an effective way to keep development iterations fast. Furthermore, it could\u2014and probably already does\u2014help solve some production issues. Here, we will take a naive and simplified look at how it could be used for a live trader to reload a critical component without restarting the entire suite, but instead only a specific component.    </p>\n<!-- more -->\n\n<p>The layout of our small example will be simple. We will have a main CLI binary and a shared dynamic library that we hot reload. More specifically, we create a CLI that prints the price of an asset on Binance every five seconds. We can then utilize the hot-reload functionality to introduce an order book for the spread or a second API interface at runtime, provided we keep our logic tight.</p>\n<p>While our example is simple, imagine having a live trader with a preflight time of one minute or more. It might need to download a number of candles to initialize indicators, or even more data to normalize values for machine learning. It could also be used for high-frequency trading, where even a minute of downtime is critical for current positions and, even worse, costs money.</p>\n<h2 id=\"limitations\">Limitations</h2>\n<p>We have a few limitations or at least obstacles that we need to address to achieve hot reloadability successfully.</p>\n<ul>\n<li>Rust has no stable ABI</li>\n<li>We have to introduce a stable ABI</li>\n<li>Components need to be decoupled from the start by this design</li>\n</ul>\n<h3 id=\"abi\">ABI</h3>\n<p>Rust does not have a stable Application Binary Interface (ABI). This is a design choice in rustc to allow optimization of memory layout along with other performance improvements. However, this represents a significant challenge. If we were to rely on Rust\u2019s unstable ABI, which makes no guarantees about types such as String or Vec, even the slightest change could cause a crash.</p>\n<p>Because of this, we need to bridge into something that does have a stable ABI. This is where the Foreign Function Interface (FFI) comes into play. FFI is simply the ability to call a procedure or routine from a different language. In this example, we will use the stable ABI provided by C.</p>\n<h2 id=\"price-printer\">Price printer</h2>\n<p><div class=\"language-toml highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"k\">[package]</span>\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;price_printer&quot;</span>\n</span><span id=\"__span-0-3\"><a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"n\">authors</span><span class=\"p\">.</span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n</span><span id=\"__span-0-4\"><a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"n\">edition</span><span class=\"p\">.</span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n</span><span id=\"__span-0-5\"><a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a>\n</span><span id=\"__span-0-6\"><a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"k\">[dependencies]</span>\n</span><span id=\"__span-0-7\"><a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a><span class=\"n\">reqwest</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;0.13.1&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">&quot;json&quot;</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-0-8\"><a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a><span class=\"n\">tokio</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;1&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">&quot;full&quot;</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-0-9\"><a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a><span class=\"n\">serde</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;1&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">&quot;derive&quot;</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-0-10\"><a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\" href=\"#__codelineno-0-10\"></a>\n</span><span id=\"__span-0-11\"><a id=\"__codelineno-0-11\" name=\"__codelineno-0-11\" href=\"#__codelineno-0-11\"></a><span class=\"k\">[lib]</span>\n</span><span id=\"__span-0-12\"><a id=\"__codelineno-0-12\" name=\"__codelineno-0-12\" href=\"#__codelineno-0-12\"></a><span class=\"n\">crate-type</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">&quot;rlib&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">&quot;dylib&quot;</span><span class=\"p\">]</span>\n</span></code></pre></div>\nPay attention to dylib, this will create dynamic shared library that other languages can connect to with abi, we are going to be using this in our main loop to load the dynamic library directly into the other part of our program as a hot pluggable component. </p>\n<p><div class=\"language-Rust highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">time</span><span class=\"p\">::</span><span class=\"n\">Duration</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-2\"><a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">serde</span><span class=\"p\">::</span><span class=\"n\">Deserialize</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-3\"><a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">reqwest</span><span class=\"p\">::</span><span class=\"n\">Error</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-4\"><a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">tokio</span><span class=\"p\">::</span><span class=\"n\">time</span><span class=\"p\">::</span><span class=\"n\">sleep</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-5\"><a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a>\n</span><span id=\"__span-1-6\"><a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"cp\">#[derive(Deserialize, Debug, Clone)]</span>\n</span><span id=\"__span-1-7\"><a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">TickerPrice</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-8\"><a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">String</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-9\"><a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">price</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">String</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-10\"><a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-1-11\"><a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a>\n</span><span id=\"__span-1-12\"><a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a><span class=\"cp\">#[unsafe(no_mangle)]</span>\n</span><span id=\"__span-1-13\"><a id=\"__codelineno-1-13\" name=\"__codelineno-1-13\" href=\"#__codelineno-1-13\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">extern</span><span class=\"w\"> </span><span class=\"s\">&quot;C&quot;</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">price_printer</span><span class=\"p\">(</span><span class=\"n\">keep_running</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">sync</span><span class=\"p\">::</span><span class=\"n\">atomic</span><span class=\"p\">::</span><span class=\"n\">AtomicBool</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-14\"><a id=\"__codelineno-1-14\" name=\"__codelineno-1-14\" href=\"#__codelineno-1-14\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">rt</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">tokio</span><span class=\"p\">::</span><span class=\"n\">runtime</span><span class=\"p\">::</span><span class=\"n\">Builder</span><span class=\"p\">::</span><span class=\"n\">new_current_thread</span><span class=\"p\">()</span>\n</span><span id=\"__span-1-15\"><a id=\"__codelineno-1-15\" name=\"__codelineno-1-15\" href=\"#__codelineno-1-15\"></a><span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">enable_all</span><span class=\"p\">()</span>\n</span><span id=\"__span-1-16\"><a id=\"__codelineno-1-16\" name=\"__codelineno-1-16\" href=\"#__codelineno-1-16\"></a><span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">build</span><span class=\"p\">()</span>\n</span><span id=\"__span-1-17\"><a id=\"__codelineno-1-17\" name=\"__codelineno-1-17\" href=\"#__codelineno-1-17\"></a><span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n</span><span id=\"__span-1-18\"><a id=\"__codelineno-1-18\" name=\"__codelineno-1-18\" href=\"#__codelineno-1-18\"></a>\n</span><span id=\"__span-1-19\"><a id=\"__codelineno-1-19\" name=\"__codelineno-1-19\" href=\"#__codelineno-1-19\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;SOLUSDC&quot;</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-20\"><a id=\"__codelineno-1-20\" name=\"__codelineno-1-20\" href=\"#__codelineno-1-20\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">url</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"fm\">format!</span><span class=\"p\">(</span><span class=\"s\">&quot;https://api.binance.com/api/v3/ticker/price?symbol={}&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-21\"><a id=\"__codelineno-1-21\" name=\"__codelineno-1-21\" href=\"#__codelineno-1-21\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">reqwest</span><span class=\"p\">::</span><span class=\"n\">Client</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">();</span>\n</span><span id=\"__span-1-22\"><a id=\"__codelineno-1-22\" name=\"__codelineno-1-22\" href=\"#__codelineno-1-22\"></a>\n</span><span id=\"__span-1-23\"><a id=\"__codelineno-1-23\" name=\"__codelineno-1-23\" href=\"#__codelineno-1-23\"></a><span class=\"w\">    </span><span class=\"n\">rt</span><span class=\"p\">.</span><span class=\"n\">block_on</span><span class=\"p\">(</span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-24\"><a id=\"__codelineno-1-24\" name=\"__codelineno-1-24\" href=\"#__codelineno-1-24\"></a><span class=\"w\">        </span><span class=\"k\">loop</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-25\"><a id=\"__codelineno-1-25\" name=\"__codelineno-1-25\" href=\"#__codelineno-1-25\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">keep_running</span><span class=\"p\">).</span><span class=\"n\">load</span><span class=\"p\">(</span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">sync</span><span class=\"p\">::</span><span class=\"n\">atomic</span><span class=\"p\">::</span><span class=\"n\">Ordering</span><span class=\"p\">::</span><span class=\"n\">Relaxed</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-26\"><a id=\"__codelineno-1-26\" name=\"__codelineno-1-26\" href=\"#__codelineno-1-26\"></a><span class=\"w\">                </span><span class=\"k\">break</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-27\"><a id=\"__codelineno-1-27\" name=\"__codelineno-1-27\" href=\"#__codelineno-1-27\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-28\"><a id=\"__codelineno-1-28\" name=\"__codelineno-1-28\" href=\"#__codelineno-1-28\"></a>\n</span><span id=\"__span-1-29\"><a id=\"__codelineno-1-29\" name=\"__codelineno-1-29\" href=\"#__codelineno-1-29\"></a><span class=\"w\">            </span><span class=\"n\">sleep</span><span class=\"p\">(</span><span class=\"n\">Duration</span><span class=\"p\">::</span><span class=\"n\">from_secs</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)).</span><span class=\"k\">await</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-30\"><a id=\"__codelineno-1-30\" name=\"__codelineno-1-30\" href=\"#__codelineno-1-30\"></a><span class=\"w\">            </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">response</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"p\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">url</span><span class=\"p\">).</span><span class=\"n\">send</span><span class=\"p\">().</span><span class=\"k\">await</span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n</span><span id=\"__span-1-31\"><a id=\"__codelineno-1-31\" name=\"__codelineno-1-31\" href=\"#__codelineno-1-31\"></a><span class=\"w\">            </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">price</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">TickerPrice</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">response</span><span class=\"p\">.</span><span class=\"n\">json</span><span class=\"p\">().</span><span class=\"k\">await</span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n</span><span id=\"__span-1-32\"><a id=\"__codelineno-1-32\" name=\"__codelineno-1-32\" href=\"#__codelineno-1-32\"></a><span class=\"w\">            </span><span class=\"fm\">print!</span><span class=\"p\">(</span><span class=\"s\">&quot;{}: {}</span><span class=\"se\">\\r\\n</span><span class=\"s\">&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">price</span><span class=\"p\">.</span><span class=\"n\">symbol</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">price</span><span class=\"p\">.</span><span class=\"n\">price</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-33\"><a id=\"__codelineno-1-33\" name=\"__codelineno-1-33\" href=\"#__codelineno-1-33\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-34\"><a id=\"__codelineno-1-34\" name=\"__codelineno-1-34\" href=\"#__codelineno-1-34\"></a><span class=\"w\">    </span><span class=\"p\">});</span>\n</span><span id=\"__span-1-35\"><a id=\"__codelineno-1-35\" name=\"__codelineno-1-35\" href=\"#__codelineno-1-35\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-1-36\"><a id=\"__codelineno-1-36\" name=\"__codelineno-1-36\" href=\"#__codelineno-1-36\"></a>\n</span><span id=\"__span-1-37\"><a id=\"__codelineno-1-37\" name=\"__codelineno-1-37\" href=\"#__codelineno-1-37\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">fetch_price</span><span class=\"p\">(</span><span class=\"n\">client</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kp\">&amp;</span><span class=\"nc\">reqwest</span><span class=\"p\">::</span><span class=\"n\">Client</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">url</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kp\">&amp;</span><span class=\"kt\">str</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"n\">TickerPrice</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Error</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-38\"><a id=\"__codelineno-1-38\" name=\"__codelineno-1-38\" href=\"#__codelineno-1-38\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">response</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"p\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">url</span><span class=\"p\">).</span><span class=\"n\">send</span><span class=\"p\">().</span><span class=\"k\">await</span><span class=\"o\">?</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-39\"><a id=\"__codelineno-1-39\" name=\"__codelineno-1-39\" href=\"#__codelineno-1-39\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">ticker</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">TickerPrice</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">response</span><span class=\"p\">.</span><span class=\"n\">json</span><span class=\"p\">().</span><span class=\"k\">await</span><span class=\"o\">?</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-40\"><a id=\"__codelineno-1-40\" name=\"__codelineno-1-40\" href=\"#__codelineno-1-40\"></a><span class=\"w\">    </span><span class=\"nb\">Ok</span><span class=\"p\">(</span><span class=\"n\">ticker</span><span class=\"p\">)</span>\n</span><span id=\"__span-1-41\"><a id=\"__codelineno-1-41\" name=\"__codelineno-1-41\" href=\"#__codelineno-1-41\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\nNotice that we do not define the price_printer as async, by default using async with FFI is a different ballgame as the std to my knowlede has no safe implementation of async FFI, so the example got the easy route.  </p>\n<h2 id=\"main-loop\">Main loop</h2>\n<div class=\"language-toml highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"k\">[package]</span>\n</span><span id=\"__span-2-2\"><a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;main&quot;</span>\n</span><span id=\"__span-2-3\"><a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;0.1.0&quot;</span>\n</span><span id=\"__span-2-4\"><a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"n\">edition</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;2024&quot;</span>\n</span><span id=\"__span-2-5\"><a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a>\n</span><span id=\"__span-2-6\"><a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"k\">[dependencies]</span>\n</span><span id=\"__span-2-7\"><a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a><span class=\"n\">tokio</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;1&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">&quot;full&quot;</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-2-8\"><a id=\"__codelineno-2-8\" name=\"__codelineno-2-8\" href=\"#__codelineno-2-8\"></a><span class=\"n\">crossterm</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;0.29.0&quot;</span>\n</span><span id=\"__span-2-9\"><a id=\"__codelineno-2-9\" name=\"__codelineno-2-9\" href=\"#__codelineno-2-9\"></a><span class=\"n\">libloading</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;0.9.0&quot;</span>\n</span><span id=\"__span-2-10\"><a id=\"__codelineno-2-10\" name=\"__codelineno-2-10\" href=\"#__codelineno-2-10\"></a><span class=\"n\">anyhow</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;1.0.100&quot;</span>\n</span></code></pre></div>\n<div class=\"language-Rust highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">crossterm</span><span class=\"p\">::{</span>\n</span><span id=\"__span-3-2\"><a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a><span class=\"w\">    </span><span class=\"n\">event</span><span class=\"p\">::{</span><span class=\"bp\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Event</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">KeyCode</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">KeyEvent</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">KeyModifiers</span><span class=\"p\">},</span>\n</span><span id=\"__span-3-3\"><a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a><span class=\"w\">    </span><span class=\"n\">terminal</span><span class=\"p\">,</span>\n</span><span id=\"__span-3-4\"><a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a><span class=\"p\">};</span>\n</span><span id=\"__span-3-5\"><a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\" href=\"#__codelineno-3-5\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">io</span><span class=\"p\">;</span>\n</span><span id=\"__span-3-6\"><a id=\"__codelineno-3-6\" name=\"__codelineno-3-6\" href=\"#__codelineno-3-6\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">sync</span><span class=\"p\">::</span><span class=\"n\">Arc</span><span class=\"p\">;</span>\n</span><span id=\"__span-3-7\"><a id=\"__codelineno-3-7\" name=\"__codelineno-3-7\" href=\"#__codelineno-3-7\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">sync</span><span class=\"p\">::</span><span class=\"n\">atomic</span><span class=\"p\">::{</span><span class=\"n\">AtomicBool</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Ordering</span><span class=\"p\">};</span>\n</span><span id=\"__span-3-8\"><a id=\"__codelineno-3-8\" name=\"__codelineno-3-8\" href=\"#__codelineno-3-8\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">libloading</span><span class=\"p\">::</span><span class=\"n\">Library</span><span class=\"p\">;</span>\n</span><span id=\"__span-3-9\"><a id=\"__codelineno-3-9\" name=\"__codelineno-3-9\" href=\"#__codelineno-3-9\"></a>\n</span><span id=\"__span-3-10\"><a id=\"__codelineno-3-10\" name=\"__codelineno-3-10\" href=\"#__codelineno-3-10\"></a><span class=\"k\">type</span><span class=\"w\"> </span><span class=\"nc\">PriceYielder</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"k\">extern</span><span class=\"w\"> </span><span class=\"s\">&quot;C&quot;</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">AtomicBool</span><span class=\"p\">);</span>\n</span><span id=\"__span-3-11\"><a id=\"__codelineno-3-11\" name=\"__codelineno-3-11\" href=\"#__codelineno-3-11\"></a>\n</span><span id=\"__span-3-12\"><a id=\"__codelineno-3-12\" name=\"__codelineno-3-12\" href=\"#__codelineno-3-12\"></a><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">trader</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">anyhow</span><span class=\"p\">::</span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"p\">()</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-13\"><a id=\"__codelineno-3-13\" name=\"__codelineno-3-13\" href=\"#__codelineno-3-13\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">lib_path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"fm\">format!</span><span class=\"p\">(</span><span class=\"s\">&quot;target/debug/libprice_printer.dylib&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-3-14\"><a id=\"__codelineno-3-14\" name=\"__codelineno-3-14\" href=\"#__codelineno-3-14\"></a>\n</span><span id=\"__span-3-15\"><a id=\"__codelineno-3-15\" name=\"__codelineno-3-15\" href=\"#__codelineno-3-15\"></a><span class=\"w\">    </span><span class=\"k\">loop</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-16\"><a id=\"__codelineno-3-16\" name=\"__codelineno-3-16\" href=\"#__codelineno-3-16\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">lib</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">Library</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">lib_path</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"w\"> </span><span class=\"p\">};</span>\n</span><span id=\"__span-3-17\"><a id=\"__codelineno-3-17\" name=\"__codelineno-3-17\" href=\"#__codelineno-3-17\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">price_yielder</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">libloading</span><span class=\"p\">::</span><span class=\"n\">Symbol</span><span class=\"o\">&lt;</span><span class=\"n\">PriceYielder</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">lib</span><span class=\"p\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s\">b&quot;price_yielder&quot;</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"w\"> </span><span class=\"p\">};</span>\n</span><span id=\"__span-3-18\"><a id=\"__codelineno-3-18\" name=\"__codelineno-3-18\" href=\"#__codelineno-3-18\"></a>\n</span><span id=\"__span-3-19\"><a id=\"__codelineno-3-19\" name=\"__codelineno-3-19\" href=\"#__codelineno-3-19\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">stop_signal</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">AtomicBool</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"kc\">false</span><span class=\"p\">));</span>\n</span><span id=\"__span-3-20\"><a id=\"__codelineno-3-20\" name=\"__codelineno-3-20\" href=\"#__codelineno-3-20\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">stop_signal_clone</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">clone</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">stop_signal</span><span class=\"p\">);</span>\n</span><span id=\"__span-3-21\"><a id=\"__codelineno-3-21\" name=\"__codelineno-3-21\" href=\"#__codelineno-3-21\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">PriceYielder</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">price_yielder</span><span class=\"p\">;</span>\n</span><span id=\"__span-3-22\"><a id=\"__codelineno-3-22\" name=\"__codelineno-3-22\" href=\"#__codelineno-3-22\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">spawn</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">tokio</span><span class=\"p\">::</span><span class=\"n\">task</span><span class=\"p\">::</span><span class=\"n\">spawn_blocking</span><span class=\"p\">(</span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-23\"><a id=\"__codelineno-3-23\" name=\"__codelineno-3-23\" href=\"#__codelineno-3-23\"></a><span class=\"w\">            </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">ptr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">as_ptr</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">stop_signal_clone</span><span class=\"p\">);</span>\n</span><span id=\"__span-3-24\"><a id=\"__codelineno-3-24\" name=\"__codelineno-3-24\" href=\"#__codelineno-3-24\"></a><span class=\"w\">            </span><span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-25\"><a id=\"__codelineno-3-25\" name=\"__codelineno-3-25\" href=\"#__codelineno-3-25\"></a><span class=\"w\">                </span><span class=\"n\">func</span><span class=\"p\">(</span><span class=\"n\">ptr</span><span class=\"p\">);</span>\n</span><span id=\"__span-3-26\"><a id=\"__codelineno-3-26\" name=\"__codelineno-3-26\" href=\"#__codelineno-3-26\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n</span><span id=\"__span-3-27\"><a id=\"__codelineno-3-27\" name=\"__codelineno-3-27\" href=\"#__codelineno-3-27\"></a><span class=\"w\">        </span><span class=\"p\">});</span>\n</span><span id=\"__span-3-28\"><a id=\"__codelineno-3-28\" name=\"__codelineno-3-28\" href=\"#__codelineno-3-28\"></a>\n</span><span id=\"__span-3-29\"><a id=\"__codelineno-3-29\" name=\"__codelineno-3-29\" href=\"#__codelineno-3-29\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wait_for_input</span><span class=\"p\">()</span><span class=\"o\">?</span><span class=\"p\">;</span>\n</span><span id=\"__span-3-30\"><a id=\"__codelineno-3-30\" name=\"__codelineno-3-30\" href=\"#__codelineno-3-30\"></a><span class=\"w\">        </span><span class=\"n\">stop_signal</span><span class=\"p\">.</span><span class=\"n\">store</span><span class=\"p\">(</span><span class=\"kc\">true</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Ordering</span><span class=\"p\">::</span><span class=\"n\">Relaxed</span><span class=\"p\">);</span>\n</span><span id=\"__span-3-31\"><a id=\"__codelineno-3-31\" name=\"__codelineno-3-31\" href=\"#__codelineno-3-31\"></a><span class=\"w\">        </span><span class=\"n\">spawn</span><span class=\"p\">.</span><span class=\"k\">await</span><span class=\"o\">?</span><span class=\"p\">;</span>\n</span><span id=\"__span-3-32\"><a id=\"__codelineno-3-32\" name=\"__codelineno-3-32\" href=\"#__codelineno-3-32\"></a>\n</span><span id=\"__span-3-33\"><a id=\"__codelineno-3-33\" name=\"__codelineno-3-33\" href=\"#__codelineno-3-33\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-34\"><a id=\"__codelineno-3-34\" name=\"__codelineno-3-34\" href=\"#__codelineno-3-34\"></a><span class=\"w\">            </span><span class=\"k\">continue</span>\n</span><span id=\"__span-3-35\"><a id=\"__codelineno-3-35\" name=\"__codelineno-3-35\" href=\"#__codelineno-3-35\"></a><span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-36\"><a id=\"__codelineno-3-36\" name=\"__codelineno-3-36\" href=\"#__codelineno-3-36\"></a><span class=\"w\">            </span><span class=\"k\">break</span><span class=\"p\">;</span>\n</span><span id=\"__span-3-37\"><a id=\"__codelineno-3-37\" name=\"__codelineno-3-37\" href=\"#__codelineno-3-37\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n</span><span id=\"__span-3-38\"><a id=\"__codelineno-3-38\" name=\"__codelineno-3-38\" href=\"#__codelineno-3-38\"></a>\n</span><span id=\"__span-3-39\"><a id=\"__codelineno-3-39\" name=\"__codelineno-3-39\" href=\"#__codelineno-3-39\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-3-40\"><a id=\"__codelineno-3-40\" name=\"__codelineno-3-40\" href=\"#__codelineno-3-40\"></a><span class=\"w\">    </span><span class=\"nb\">Ok</span><span class=\"p\">(())</span>\n</span><span id=\"__span-3-41\"><a id=\"__codelineno-3-41\" name=\"__codelineno-3-41\" href=\"#__codelineno-3-41\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-3-42\"><a id=\"__codelineno-3-42\" name=\"__codelineno-3-42\" href=\"#__codelineno-3-42\"></a>\n</span><span id=\"__span-3-43\"><a id=\"__codelineno-3-43\" name=\"__codelineno-3-43\" href=\"#__codelineno-3-43\"></a>\n</span><span id=\"__span-3-44\"><a id=\"__codelineno-3-44\" name=\"__codelineno-3-44\" href=\"#__codelineno-3-44\"></a><span class=\"cp\">#[tokio::main]</span>\n</span><span id=\"__span-3-45\"><a id=\"__codelineno-3-45\" name=\"__codelineno-3-45\" href=\"#__codelineno-3-45\"></a><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-46\"><a id=\"__codelineno-3-46\" name=\"__codelineno-3-46\" href=\"#__codelineno-3-46\"></a><span class=\"w\">    </span><span class=\"n\">trader</span><span class=\"p\">().</span><span class=\"k\">await</span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n</span><span id=\"__span-3-47\"><a id=\"__codelineno-3-47\" name=\"__codelineno-3-47\" href=\"#__codelineno-3-47\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-3-48\"><a id=\"__codelineno-3-48\" name=\"__codelineno-3-48\" href=\"#__codelineno-3-48\"></a>\n</span><span id=\"__span-3-49\"><a id=\"__codelineno-3-49\" name=\"__codelineno-3-49\" href=\"#__codelineno-3-49\"></a><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">wait_for_input</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">io</span><span class=\"p\">::</span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"kt\">bool</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-50\"><a id=\"__codelineno-3-50\" name=\"__codelineno-3-50\" href=\"#__codelineno-3-50\"></a><span class=\"w\">    </span><span class=\"n\">terminal</span><span class=\"p\">::</span><span class=\"n\">enable_raw_mode</span><span class=\"p\">()</span><span class=\"o\">?</span><span class=\"p\">;</span>\n</span><span id=\"__span-3-51\"><a id=\"__codelineno-3-51\" name=\"__codelineno-3-51\" href=\"#__codelineno-3-51\"></a>\n</span><span id=\"__span-3-52\"><a id=\"__codelineno-3-52\" name=\"__codelineno-3-52\" href=\"#__codelineno-3-52\"></a><span class=\"w\">    </span><span class=\"k\">loop</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-53\"><a id=\"__codelineno-3-53\" name=\"__codelineno-3-53\" href=\"#__codelineno-3-53\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">Event</span><span class=\"p\">::</span><span class=\"n\">Key</span><span class=\"p\">(</span><span class=\"n\">KeyEvent</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">modifiers</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"w\"> </span><span class=\"p\">})</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">event</span><span class=\"p\">::</span><span class=\"n\">read</span><span class=\"p\">()</span><span class=\"o\">?</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-54\"><a id=\"__codelineno-3-54\" name=\"__codelineno-3-54\" href=\"#__codelineno-3-54\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">KeyCode</span><span class=\"p\">::</span><span class=\"n\">Char</span><span class=\"p\">(</span><span class=\"sc\">&#39;r&#39;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">modifiers</span><span class=\"p\">.</span><span class=\"n\">contains</span><span class=\"p\">(</span><span class=\"n\">KeyModifiers</span><span class=\"p\">::</span><span class=\"n\">CONTROL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-55\"><a id=\"__codelineno-3-55\" name=\"__codelineno-3-55\" href=\"#__codelineno-3-55\"></a><span class=\"w\">                </span><span class=\"n\">terminal</span><span class=\"p\">::</span><span class=\"n\">disable_raw_mode</span><span class=\"p\">()</span><span class=\"o\">?</span><span class=\"p\">;</span>\n</span><span id=\"__span-3-56\"><a id=\"__codelineno-3-56\" name=\"__codelineno-3-56\" href=\"#__codelineno-3-56\"></a><span class=\"w\">                </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"nb\">Ok</span><span class=\"p\">(</span><span class=\"kc\">true</span><span class=\"p\">);</span>\n</span><span id=\"__span-3-57\"><a id=\"__codelineno-3-57\" name=\"__codelineno-3-57\" href=\"#__codelineno-3-57\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n</span><span id=\"__span-3-58\"><a id=\"__codelineno-3-58\" name=\"__codelineno-3-58\" href=\"#__codelineno-3-58\"></a>\n</span><span id=\"__span-3-59\"><a id=\"__codelineno-3-59\" name=\"__codelineno-3-59\" href=\"#__codelineno-3-59\"></a><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">code</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">KeyCode</span><span class=\"p\">::</span><span class=\"n\">Char</span><span class=\"p\">(</span><span class=\"sc\">&#39;c&#39;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">modifiers</span><span class=\"p\">.</span><span class=\"n\">contains</span><span class=\"p\">(</span><span class=\"n\">KeyModifiers</span><span class=\"p\">::</span><span class=\"n\">CONTROL</span><span class=\"p\">)</span><span class=\"w\">  </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-60\"><a id=\"__codelineno-3-60\" name=\"__codelineno-3-60\" href=\"#__codelineno-3-60\"></a><span class=\"w\">                </span><span class=\"n\">terminal</span><span class=\"p\">::</span><span class=\"n\">disable_raw_mode</span><span class=\"p\">()</span><span class=\"o\">?</span><span class=\"p\">;</span>\n</span><span id=\"__span-3-61\"><a id=\"__codelineno-3-61\" name=\"__codelineno-3-61\" href=\"#__codelineno-3-61\"></a><span class=\"w\">                </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"nb\">Ok</span><span class=\"p\">(</span><span class=\"kc\">false</span><span class=\"p\">);</span>\n</span><span id=\"__span-3-62\"><a id=\"__codelineno-3-62\" name=\"__codelineno-3-62\" href=\"#__codelineno-3-62\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n</span><span id=\"__span-3-63\"><a id=\"__codelineno-3-63\" name=\"__codelineno-3-63\" href=\"#__codelineno-3-63\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n</span><span id=\"__span-3-64\"><a id=\"__codelineno-3-64\" name=\"__codelineno-3-64\" href=\"#__codelineno-3-64\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-3-65\"><a id=\"__codelineno-3-65\" name=\"__codelineno-3-65\" href=\"#__codelineno-3-65\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<h2 id=\"demonstration\">Demonstration</h2>\n<p>For the demononstration, I simply started the program, went back and changed the price printer to print BTCUSDC instead of SOLUSDC, did a cargo build followed by ctrl + r in the terminal.  </p>\n<figure>\n<p><img alt=\"Screenshot of terminal for Rust hot reload cli\" src=\"/static/hot_reloading/hot_reloading.png\" /></p>\n<figcaption>\n<p>Hot reload from SOLUSDC to BTCUSDC</p>\n</figcaption>\n</figure>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>While this was a soft and simple introduction, the application and usecases for hot reloading is numerous, we barely touched the subject here, inter communication is also possible with say a C struct, that could help preserve states between hot reloads.</p>", "image": null, "date_modified": "2026-01-29T22:08:28+00:00", "authors": [{"name": "Alexander H\u00f8gh"}], "tags": ["External C", "FFI", "Hot reloading", "Rust", "Rust", "Unsafe rust"]}, {"id": "https://helius.dk/blog/2025/02/17/making-a-stable-coin-on-solana/", "url": "https://helius.dk/blog/2025/02/17/making-a-stable-coin-on-solana/", "title": "Making a stable coin on Solana", "content_html": "<h1 id=\"making-a-stable-coin-on-solana\">Making a stable coin on Solana</h1>\n<p>Recently, I spoke with someone about creating a stablecoin. I had given it some thought myself and asked him:</p>\n<blockquote>\n<p>So how do you stabilize it on the curve?</p>\n</blockquote>\n<!-- more -->\n<p>By this, I meant how to keep it steady at $1 or \u20ac1 because whenever you mint a coin using the token program and start swapping in and out, the price fluctuates.<br />\nHe responded:</p>\n<blockquote>\n<p>You need to make triggers to keep the peg in place</p>\n</blockquote>\n<p>He also mentioned collateralization and other concepts, but that\u2019s not particularly relevant to this article.<br />\nBeing me, I kept thinking about it, and these are my (probably naive) solutions to creating a stablecoin:  </p>\n<h2 id=\"idea-one-constant-product\">Idea one Constant product</h2>\n<figure>\n<p><img alt=\"Swap distribution on a stable coin\" src=\"/static/stable_coin_on_solana/Screenshot 2025-02-17 at 21.11.58.png\" /></p>\n<figcaption>\n<p>Swap distribution on a stable coin</p>\n</figcaption>\n</figure>\n<h3 id=\"the-math\">The math</h3>\n<p>When a token is created on Solana using the token program, its value is determined by the <a href=\"https://spl.solana.com/token-swap#constant-product\">Constant product</a>. Below is a simplified version of the necessary calculation:\nMinted token supply / Solana supply\n5000 / 5000 = 1 sol</p>\n<p>If we wanted to create a token that always remains worth 1 SOL, we could develop a smart contract that mints on buys and burns on sells to maintain equilibrium.</p>\n<p>However, a stablecoin should probably track something more stable\u2014like the Euro. For that, we need an oracle.</p>\n<blockquote>\n<p>An <a href=\"https://docs.chain.link/docs/solana/data-feeds-solana/\">oracle</a> in smart contracts is a service to fetch off-chain data, such as the euro price.</p>\n</blockquote>\n<p>Now, the math effectively becomes:<br />\nminted_supply / (solana supply / euro price)\n5000 / (5000 / 7.5) =\n5000 / 666.6667 =\n7.5  </p>\n<p>The status quo can still be maintained by minting and burning with corresponding buys and sells directly within the smart contract. With the help of the oracle, it can automatically adjust itself whenever the Euro fluctuates.</p>\n<p>That concludes Idea One, which already seems to exist in the form of this <a href=\"https://github.com/saber-hq/stable-swap/blob/master/stable-swap-math/src/curve.rs#L225\">stable swap program</a>.</p>\n<h2 id=\"idea-two-liquidity-providing\">Idea two, liquidity providing</h2>\n<p><em>Idea two</em> builds upon the first but introduces a slight... let\u2019s say profit incentive (Disclaimer: This is just an idea\u2014there may be regulatory concerns).  </p>\n<p>Let\u2019s say you create a \u20ac100M stablecoin, meaning you swap \u20ac100M for the equivalent amount of SOL. At today\u2019s exchange rate (\u20ac169.49 per SOL), that would equal 590,005.31 SOL.<br />\nTo maintain its value at \u20ac1, we apply the formula from Idea One and isolate the unknown.  </p>\n<p>The real difference in this idea is using event listeners on Solana for our mint and taking the following actions:  </p>\n<ul>\n<li>If the value drops below \u20ac1, we swap in SOL to push it back up.  </li>\n<li>If the value rises above \u20ac1, we swap out SOL to bring it back down.  </li>\n</ul>\n<p>This is liquidity providing in its purest/simplest form. However, there are several challenges to consider, such as sandwich attacks, arbitrage bots, and so on.</p>\n<p>This being liquidity providing also means you need to account for price fluctuations while also ensuring the ability to stake the invested supply.</p>\n<ul>\n<li>Sandwich attacks can be mitigated by using Jito to wrap swaps.</li>\n<li>Arbitrage bots are harder to counter and require technical finesse\u2014primarily by being faster.</li>\n</ul>\n<h2 id=\"wrap-up\">Wrap up</h2>\n<p>That\u2019s it for my thoughts on stablecoins. They are by no means a new concept and operate in a heavily regulated field. This article may not have provided the exact insights you were hoping for, but at the very least, it should give you a few ideas to explore on this topic. </p>\n<h2 id=\"disclaimer\">Disclaimer:</h2>\n<p>The information provided in this blog is for educational and informational purposes only. It does not constitute financial, legal, or investment advice. Always check the regulations in effect in your jurisdiction before considering any concepts discussed here. I take no responsibility for any actions taken based on this content.</p>", "image": null, "date_modified": "2026-01-29T22:08:28+00:00", "authors": [{"name": "Alexander H\u00f8gh"}], "tags": ["Solana", "Solana Smart contract", "Solana stable coin"]}, {"id": "https://helius.dk/blog/2025/03/12/writing-a-raydium-sniper-in-rust-part-4/", "url": "https://helius.dk/blog/2025/03/12/writing-a-raydium-sniper-in-rust-part-4/", "title": "Writing a Raydium sniper in Rust part 4", "content_html": "<p><img alt=\"AI generated image of a friendly humanoid bot\" src=\"/static/raydium_sniper_part_4/ai bot wrapped in paper.jpg\" /></p>\n<h1 id=\"writing-a-raydium-sniper-in-rust-part-4\">Writing a Raydium sniper in Rust part 4</h1>\n<p>This is part four of this series, where we are creating a Solana sniper bot for Raydium from scratch in Rust. See the first post here which includes an introduction about why we use a compiled language instead of JavaScript, as well as prerequisites and a brief introduction about me. You can find the latest <a href=\"https://github.com/weestack/Solana-Sniper\">GitHub source here</a>, which will be updated with each new post.  </p>\n<p>Solana needs to be wrapped for most meme coin swaps, but is there another reason for this command?</p>\n<!-- more -->\n\n<h2 id=\"disclaimer\">Disclaimer</h2>\n<p>The information provided in this series of articles is for educational purposes only and should not be considered financial or investment advice. Trading, including sniping tokens, carries significant risks, and there is no guarantee of profit.</p>\n<p>Any decisions you make based on the content shared here are solely your responsibility. I am not liable for any financial losses incurred as a result of implementing the strategies, code, or techniques discussed in these articles.</p>\n<p>Always trade responsibly. Never risk more money than you can afford to lose. It is essential to conduct your own research and consult with a professional financial advisor if necessary before engaging in any trading activities.</p>\n<h2 id=\"what-to-expect-today\">What to expect today</h2>\n<p>Last time, we explored swap and initialization transactions, delving deeper into how to extract actionable data from Solana's blockchain for efficient token sniping. This includes identifying transaction patterns.</p>\n<p>Today, we will learn how to build our own CLI command to wrap SOL to wSOL, the common currency for swapping meme coins. Additionally, we will have a short discussion on transaction optimization.</p>\n<h2 id=\"wrapped-solana\">Wrapped Solana</h2>\n<p>The first question that might come to mind is: why do I need to wrap my Solana, and what does it even mean to wrap it?</p>\n<p>Solana (SOL) is the native token of the Solana blockchain, used for gas fees and staking.\nwSOL, however, is an SPL token with the exact same value as SOL. Just like any meme coin is created as an SPL token, wSOL is also created using Solana's SPL token program.</p>\n<p>Holding SOL in the form of wSOL means you are always ready to trade without needing to add extra instructions for wrapping your SOL when a new meme coin is released.</p>\n<h2 id=\"creating-a-cli-command\">Creating a cli command</h2>\n<p>Now that we\u2019ve covered the basics, let's create a CLI command to convert our regular, boring SOL into hot-swappable wSOL.</p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Create a new package with</p>\n<p><div class=\"language-Bash highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a>cargo<span class=\"w\"> </span>new<span class=\"w\"> </span>shell\n</span></code></pre></div>\nCreate the following files:\n<div class=\"language-Bash highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a>shell/Cargo.toml\n</span><span id=\"__span-1-2\"><a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a>shell/src/main.rs\n</span><span id=\"__span-1-3\"><a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a>shell/src/commands/mod.rs\n</span><span id=\"__span-1-4\"><a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a>shell/src/wrap_sol.rs\n</span></code></pre></div></p>\n</div>\n<p>With that, we have created all the files needed for the wrap SOL command we are going to build.</p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Fill <code>shell/Cargo.toml</code> with</p>\n<div class=\"language-toml highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"k\">[package]</span>\n</span><span id=\"__span-2-2\"><a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;shell&quot;</span>\n</span><span id=\"__span-2-3\"><a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"n\">authors</span><span class=\"p\">.</span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n</span><span id=\"__span-2-4\"><a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"n\">edition</span><span class=\"p\">.</span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n</span><span id=\"__span-2-5\"><a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"n\">homepage</span><span class=\"p\">.</span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n</span><span id=\"__span-2-6\"><a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"n\">repository</span><span class=\"p\">.</span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n</span><span id=\"__span-2-7\"><a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a><span class=\"n\">license</span><span class=\"p\">.</span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n</span><span id=\"__span-2-8\"><a id=\"__codelineno-2-8\" name=\"__codelineno-2-8\" href=\"#__codelineno-2-8\"></a><span class=\"n\">keywords</span><span class=\"p\">.</span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n</span><span id=\"__span-2-9\"><a id=\"__codelineno-2-9\" name=\"__codelineno-2-9\" href=\"#__codelineno-2-9\"></a><span class=\"n\">version</span><span class=\"p\">.</span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n</span><span id=\"__span-2-10\"><a id=\"__codelineno-2-10\" name=\"__codelineno-2-10\" href=\"#__codelineno-2-10\"></a><span class=\"n\">readme</span><span class=\"p\">.</span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n</span><span id=\"__span-2-11\"><a id=\"__codelineno-2-11\" name=\"__codelineno-2-11\" href=\"#__codelineno-2-11\"></a><span class=\"n\">categories</span><span class=\"p\">.</span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n</span><span id=\"__span-2-12\"><a id=\"__codelineno-2-12\" name=\"__codelineno-2-12\" href=\"#__codelineno-2-12\"></a><span class=\"n\">publish</span><span class=\"p\">.</span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n</span><span id=\"__span-2-13\"><a id=\"__codelineno-2-13\" name=\"__codelineno-2-13\" href=\"#__codelineno-2-13\"></a>\n</span><span id=\"__span-2-14\"><a id=\"__codelineno-2-14\" name=\"__codelineno-2-14\" href=\"#__codelineno-2-14\"></a><span class=\"k\">[dependencies]</span>\n</span><span id=\"__span-2-15\"><a id=\"__codelineno-2-15\" name=\"__codelineno-2-15\" href=\"#__codelineno-2-15\"></a><span class=\"n\">clap</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-2-16\"><a id=\"__codelineno-2-16\" name=\"__codelineno-2-16\" href=\"#__codelineno-2-16\"></a><span class=\"n\">utils</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-2-17\"><a id=\"__codelineno-2-17\" name=\"__codelineno-2-17\" href=\"#__codelineno-2-17\"></a><span class=\"n\">solana-client</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-2-18\"><a id=\"__codelineno-2-18\" name=\"__codelineno-2-18\" href=\"#__codelineno-2-18\"></a><span class=\"n\">solana-sdk</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-2-19\"><a id=\"__codelineno-2-19\" name=\"__codelineno-2-19\" href=\"#__codelineno-2-19\"></a><span class=\"n\">spl-token-client</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-2-20\"><a id=\"__codelineno-2-20\" name=\"__codelineno-2-20\" href=\"#__codelineno-2-20\"></a><span class=\"n\">spl-token</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-2-21\"><a id=\"__codelineno-2-21\" name=\"__codelineno-2-21\" href=\"#__codelineno-2-21\"></a><span class=\"n\">tokio</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-2-22\"><a id=\"__codelineno-2-22\" name=\"__codelineno-2-22\" href=\"#__codelineno-2-22\"></a>\n</span><span id=\"__span-2-23\"><a id=\"__codelineno-2-23\" name=\"__codelineno-2-23\" href=\"#__codelineno-2-23\"></a><span class=\"k\">[lints]</span>\n</span><span id=\"__span-2-24\"><a id=\"__codelineno-2-24\" name=\"__codelineno-2-24\" href=\"#__codelineno-2-24\"></a><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n</span></code></pre></div>\n</div>\n<p>We have added <code>clap</code>, a common Rust library for creating CLI commands, which provides an easy syntax for defining command-line arguments directly from structs and supports hinting.</p>\n<p>In addition to <code>clap</code> we have also introduced the <code>spl-token-client</code> and <code>spl-token</code> libraries, which are used for wrapping SOL to wSOL. </p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Fill <code>shell/src/main.rs</code> with</p>\n<div class=\"language-Rust highlight\"><table class=\"highlighttable\"><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre><span></span><span class=\"normal\"><a href=\"#__codelineno-3-1\"> 1</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-2\"> 2</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-3\"> 3</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-4\"> 4</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-5\"> 5</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-6\"> 6</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-7\"> 7</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-8\"> 8</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-9\"> 9</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-10\">10</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-11\">11</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-12\">12</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-13\">13</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-14\">14</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-15\">15</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-16\">16</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-17\">17</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-18\">18</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-19\">19</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-20\">20</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-21\">21</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-22\">22</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-23\">23</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-24\">24</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-25\">25</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-26\">26</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-27\">27</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-28\">28</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-29\">29</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-30\">30</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-31\">31</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-32\">32</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-33\">33</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-34\">34</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-35\">35</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-36\">36</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-3-37\">37</a></span></pre></div></td><td class=\"code\"><div><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\"></a><span class=\"k\">mod</span><span class=\"w\"> </span><span class=\"nn\">commands</span><span class=\"p\">;</span>\n</span><span id=\"__span-3-2\"><a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">commands</span><span class=\"p\">::</span><span class=\"n\">wrap_sol</span><span class=\"p\">::</span><span class=\"n\">WrapArgs</span><span class=\"p\">;</span>\n</span><span id=\"__span-3-3\"><a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">clap</span><span class=\"p\">::{</span><span class=\"n\">Parser</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Subcommand</span><span class=\"p\">};</span>\n</span><span id=\"__span-3-4\"><a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">solana_sdk</span><span class=\"p\">::</span><span class=\"n\">native_token</span><span class=\"p\">::</span><span class=\"n\">LAMPORTS_PER_SOL</span><span class=\"p\">;</span>\n</span><span id=\"__span-3-5\"><a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">utils</span><span class=\"p\">::</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">Env</span><span class=\"p\">;</span>\n</span><span id=\"__span-3-6\"><a id=\"__codelineno-3-6\" name=\"__codelineno-3-6\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"k\">crate</span><span class=\"p\">::</span><span class=\"n\">commands</span><span class=\"p\">::</span><span class=\"n\">wrap_sol</span><span class=\"p\">;</span>\n</span><span id=\"__span-3-7\"><a id=\"__codelineno-3-7\" name=\"__codelineno-3-7\"></a>\n</span><span id=\"__span-3-8\"><a id=\"__codelineno-3-8\" name=\"__codelineno-3-8\"></a><span class=\"cp\">#[derive(Debug, Parser)]</span><span class=\"w\"> </span><span class=\"c1\">// requires `derive` feature</span>\n</span><span id=\"__span-3-9\"><a id=\"__codelineno-3-9\" name=\"__codelineno-3-9\"></a><span class=\"cp\">#[command(name = </span><span class=\"s\">&quot;Solana Commands&quot;</span><span class=\"cp\">)]</span>\n</span><span id=\"__span-3-10\"><a id=\"__codelineno-3-10\" name=\"__codelineno-3-10\"></a><span class=\"cp\">#[command(about = </span><span class=\"s\">&quot;CLI solana commands&quot;</span><span class=\"cp\">, long_about = None)]</span>\n</span><span id=\"__span-3-11\"><a id=\"__codelineno-3-11\" name=\"__codelineno-3-11\"></a><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">Cli</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-12\"><a id=\"__codelineno-3-12\" name=\"__codelineno-3-12\"></a><span class=\"w\">    </span><span class=\"cp\">#[command(subcommand)]</span>\n</span><span id=\"__span-3-13\"><a id=\"__codelineno-3-13\" name=\"__codelineno-3-13\"></a><span class=\"w\">    </span><span class=\"n\">command</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Commands</span>\n</span><span id=\"__span-3-14\"><a id=\"__codelineno-3-14\" name=\"__codelineno-3-14\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-3-15\"><a id=\"__codelineno-3-15\" name=\"__codelineno-3-15\"></a>\n</span><span id=\"__span-3-16\"><a id=\"__codelineno-3-16\" name=\"__codelineno-3-16\"></a><span class=\"cp\">#[derive(Clone, Debug, Subcommand)]</span>\n</span><span id=\"__span-3-17\"><a id=\"__codelineno-3-17\" name=\"__codelineno-3-17\"></a><span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">Commands</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-18\"><a id=\"__codelineno-3-18\" name=\"__codelineno-3-18\"></a><span class=\"w\">    </span><span class=\"n\">WrapSol</span><span class=\"p\">(</span><span class=\"n\">WrapArgs</span><span class=\"p\">),</span>\n</span><span id=\"__span-3-19\"><a id=\"__codelineno-3-19\" name=\"__codelineno-3-19\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-3-20\"><a id=\"__codelineno-3-20\" name=\"__codelineno-3-20\"></a>\n</span><span id=\"__span-3-21\"><a id=\"__codelineno-3-21\" name=\"__codelineno-3-21\"></a><span class=\"cp\">#[tokio::main]</span>\n</span><span id=\"__span-3-22\"><a id=\"__codelineno-3-22\" name=\"__codelineno-3-22\"></a><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-23\"><a id=\"__codelineno-3-23\" name=\"__codelineno-3-23\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Env</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">().</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n</span><span id=\"__span-3-24\"><a id=\"__codelineno-3-24\" name=\"__codelineno-3-24\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">cli_command</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Cli</span><span class=\"p\">::</span><span class=\"n\">parse</span><span class=\"p\">();</span>\n</span><span id=\"__span-3-25\"><a id=\"__codelineno-3-25\" name=\"__codelineno-3-25\"></a>\n</span><span id=\"__span-3-26\"><a id=\"__codelineno-3-26\" name=\"__codelineno-3-26\"></a><span class=\"w\">    </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">cli_command</span><span class=\"p\">.</span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-27\"><a id=\"__codelineno-3-27\" name=\"__codelineno-3-27\"></a><span class=\"w\">        </span><span class=\"n\">Commands</span><span class=\"p\">::</span><span class=\"n\">WrapSol</span><span class=\"p\">(</span><span class=\"n\">wrap_args</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-28\"><a id=\"__codelineno-3-28\" name=\"__codelineno-3-28\"></a><span class=\"w\">            </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">amount</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">wrap_args</span><span class=\"p\">.</span><span class=\"n\">amount</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"kt\">f64</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">LAMPORTS_PER_SOL</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"kt\">f64</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"kt\">u64</span><span class=\"p\">;</span>\n</span><span id=\"__span-3-29\"><a id=\"__codelineno-3-29\" name=\"__codelineno-3-29\"></a>\n</span><span id=\"__span-3-30\"><a id=\"__codelineno-3-30\" name=\"__codelineno-3-30\"></a><span class=\"w\">            </span><span class=\"n\">wrap_sol</span><span class=\"p\">::</span><span class=\"n\">wrap_sol_fn</span><span class=\"p\">(</span>\n</span><span id=\"__span-3-31\"><a id=\"__codelineno-3-31\" name=\"__codelineno-3-31\"></a><span class=\"w\">                </span><span class=\"n\">amount</span><span class=\"p\">,</span>\n</span><span id=\"__span-3-32\"><a id=\"__codelineno-3-32\" name=\"__codelineno-3-32\"></a><span class=\"w\">                </span><span class=\"o\">&amp;</span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">private_key</span><span class=\"p\">,</span>\n</span><span id=\"__span-3-33\"><a id=\"__codelineno-3-33\" name=\"__codelineno-3-33\"></a><span class=\"w\">                </span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">rpc_endpoint</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">(),</span>\n</span><span id=\"__span-3-34\"><a id=\"__codelineno-3-34\" name=\"__codelineno-3-34\"></a><span class=\"w\">            </span><span class=\"p\">).</span><span class=\"k\">await</span>\n</span><span id=\"__span-3-35\"><a id=\"__codelineno-3-35\" name=\"__codelineno-3-35\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n</span><span id=\"__span-3-36\"><a id=\"__codelineno-3-36\" name=\"__codelineno-3-36\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-3-37\"><a id=\"__codelineno-3-37\" name=\"__codelineno-3-37\"></a><span class=\"p\">}</span>\n</span></code></pre></div></td></tr></table></div>\n</div>\n<p>A lot happens in the 37 lines of code above in <code>main.rs</code>, so lets break it down:</p>\n<ul>\n<li>At line 9, we define our shell and name it Solana Commands.</li>\n<li>At line 10, we provide a short description.</li>\n<li>From lines 11 to 14, we create the actual struct for the command shell, which takes in an <code>Enum Commands</code>\nAt lines 17 to 19, we define our first command, <code>WrapSol</code> with the arguments <code>WrapArgs</code> we will cover in another file. <code>clap</code> automatically parses <code>WrapSol</code> as <code>wrap-sol</code>, enabling us to run the shell command: <code>cargo run wrap-sol</code></li>\n</ul>\n<figure>\n<p><img alt=\"CLI output of running cargo run shell\" src=\"/static/raydium_sniper_part_4/Screenshot 2025-03-12 at 22.01.00.png\" /></p>\n<figcaption>\n<p>CLI output of running <code>cargo run shell</code></p>\n</figcaption>\n</figure>\n<p>The great thing about this layout is that if you wanted to create additional commands, you would simply add a new enum variant to <code>Commands. You could then call it using:</code>cargo run shell <new_command_name>` and handle it within main.rs using pattern matching.  </p>\n<ul>\n<li>From lines 26 to 36, we implement a simple match statement to handle WrapSol when it is passed as a command-line argument.</li>\n</ul>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Fill <code>shell/src/commands/mod.rs</code> with</p>\n<div class=\"language-Rust highlight\"><table class=\"highlighttable\"><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre><span></span><span class=\"normal\"><a href=\"#__codelineno-4-1\">1</a></span></pre></div></td><td class=\"code\"><div><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">mod</span><span class=\"w\"> </span><span class=\"nn\">wrap_sol</span><span class=\"p\">;</span>\n</span></code></pre></div></td></tr></table></div>\n</div>\n<p>We are making wrap_sol public so that it can be called elsewhere.</p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Fill <code>shell/src/commands/mod.rs</code> with</p>\n<div class=\"language-Rust highlight\"><table class=\"highlighttable\"><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre><span></span><span class=\"normal\"><a href=\"#__codelineno-5-1\"> 1</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-2\"> 2</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-3\"> 3</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-4\"> 4</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-5\"> 5</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-6\"> 6</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-7\"> 7</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-8\"> 8</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-9\"> 9</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-10\">10</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-11\">11</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-12\">12</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-13\">13</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-14\">14</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-15\">15</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-16\">16</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-17\">17</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-18\">18</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-19\">19</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-20\">20</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-21\">21</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-22\">22</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-23\">23</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-24\">24</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-25\">25</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-26\">26</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-27\">27</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-28\">28</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-29\">29</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-30\">30</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-31\">31</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-32\">32</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-33\">33</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-34\">34</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-35\">35</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-36\">36</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-37\">37</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-38\">38</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-39\">39</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-40\">40</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-41\">41</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-42\">42</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-43\">43</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-44\">44</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-45\">45</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-46\">46</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-47\">47</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-48\">48</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-49\">49</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-50\">50</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-51\">51</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-52\">52</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-53\">53</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-54\">54</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-55\">55</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-56\">56</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-57\">57</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-58\">58</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-59\">59</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-60\">60</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-61\">61</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-62\">62</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-63\">63</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-64\">64</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-65\">65</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-66\">66</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-67\">67</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-68\">68</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-69\">69</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-70\">70</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-71\">71</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-72\">72</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-73\">73</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-74\">74</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-75\">75</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-76\">76</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-77\">77</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-78\">78</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-79\">79</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-80\">80</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-81\">81</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-5-82\">82</a></span></pre></div></td><td class=\"code\"><div><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">sync</span><span class=\"p\">::</span><span class=\"n\">Arc</span><span class=\"p\">;</span>\n</span><span id=\"__span-5-2\"><a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">solana_client</span><span class=\"p\">::</span><span class=\"n\">nonblocking</span><span class=\"p\">::</span><span class=\"n\">rpc_client</span><span class=\"p\">::</span><span class=\"n\">RpcClient</span><span class=\"p\">;</span>\n</span><span id=\"__span-5-3\"><a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">solana_sdk</span><span class=\"p\">::</span><span class=\"n\">signature</span><span class=\"p\">::{</span><span class=\"n\">Keypair</span><span class=\"p\">};</span>\n</span><span id=\"__span-5-4\"><a id=\"__codelineno-5-4\" name=\"__codelineno-5-4\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">solana_sdk</span><span class=\"p\">::</span><span class=\"n\">signer</span><span class=\"p\">::</span><span class=\"n\">Signer</span><span class=\"p\">;</span>\n</span><span id=\"__span-5-5\"><a id=\"__codelineno-5-5\" name=\"__codelineno-5-5\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">solana_sdk</span><span class=\"p\">::</span><span class=\"n\">transaction</span><span class=\"p\">::</span><span class=\"n\">Transaction</span><span class=\"p\">;</span>\n</span><span id=\"__span-5-6\"><a id=\"__codelineno-5-6\" name=\"__codelineno-5-6\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">spl_token_client</span><span class=\"p\">::</span><span class=\"n\">client</span><span class=\"p\">::{</span><span class=\"n\">ProgramClient</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ProgramRpcClient</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ProgramRpcClientSendTransaction</span><span class=\"p\">};</span>\n</span><span id=\"__span-5-7\"><a id=\"__codelineno-5-7\" name=\"__codelineno-5-7\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">spl_token_client</span><span class=\"p\">::</span><span class=\"n\">token</span><span class=\"p\">::</span><span class=\"n\">Token</span><span class=\"p\">;</span>\n</span><span id=\"__span-5-8\"><a id=\"__codelineno-5-8\" name=\"__codelineno-5-8\"></a>\n</span><span id=\"__span-5-9\"><a id=\"__codelineno-5-9\" name=\"__codelineno-5-9\"></a><span class=\"cp\">#[derive(Debug, clap::Args, Clone)]</span>\n</span><span id=\"__span-5-10\"><a id=\"__codelineno-5-10\" name=\"__codelineno-5-10\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">WrapArgs</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-5-11\"><a id=\"__codelineno-5-11\" name=\"__codelineno-5-11\"></a><span class=\"w\">    </span><span class=\"cp\">#[arg(</span>\n</span><span id=\"__span-5-12\"><a id=\"__codelineno-5-12\" name=\"__codelineno-5-12\"></a><span class=\"cp\">            long,</span>\n</span><span id=\"__span-5-13\"><a id=\"__codelineno-5-13\" name=\"__codelineno-5-13\"></a><span class=\"cp\">    )]</span>\n</span><span id=\"__span-5-14\"><a id=\"__codelineno-5-14\" name=\"__codelineno-5-14\"></a><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">amount</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">f32</span><span class=\"p\">,</span>\n</span><span id=\"__span-5-15\"><a id=\"__codelineno-5-15\" name=\"__codelineno-5-15\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-5-16\"><a id=\"__codelineno-5-16\" name=\"__codelineno-5-16\"></a>\n</span><span id=\"__span-5-17\"><a id=\"__codelineno-5-17\" name=\"__codelineno-5-17\"></a><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">rpc</span><span class=\"p\">(</span><span class=\"n\">rpc_endpoint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">String</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">Arc</span><span class=\"o\">&lt;</span><span class=\"n\">RpcClient</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-5-18\"><a id=\"__codelineno-5-18\" name=\"__codelineno-5-18\"></a><span class=\"w\">    </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">RpcClient</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">rpc_endpoint</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">()))</span>\n</span><span id=\"__span-5-19\"><a id=\"__codelineno-5-19\" name=\"__codelineno-5-19\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-5-20\"><a id=\"__codelineno-5-20\" name=\"__codelineno-5-20\"></a><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">program_rpc</span><span class=\"p\">(</span><span class=\"n\">rpc</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Arc</span><span class=\"o\">&lt;</span><span class=\"n\">RpcClient</span><span class=\"o\">&gt;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">Arc</span><span class=\"o\">&lt;</span><span class=\"k\">dyn</span><span class=\"w\"> </span><span class=\"n\">ProgramClient</span><span class=\"o\">&lt;</span><span class=\"n\">ProgramRpcClientSendTransaction</span><span class=\"o\">&gt;&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-5-21\"><a id=\"__codelineno-5-21\" name=\"__codelineno-5-21\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">program_client</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Arc</span><span class=\"o\">&lt;</span><span class=\"k\">dyn</span><span class=\"w\"> </span><span class=\"n\">ProgramClient</span><span class=\"o\">&lt;</span><span class=\"n\">ProgramRpcClientSendTransaction</span><span class=\"o\">&gt;&gt;</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span>\n</span><span id=\"__span-5-22\"><a id=\"__codelineno-5-22\" name=\"__codelineno-5-22\"></a><span class=\"w\">        </span><span class=\"n\">ProgramRpcClient</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">rpc</span><span class=\"p\">.</span><span class=\"n\">clone</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">ProgramRpcClientSendTransaction</span><span class=\"p\">),</span>\n</span><span id=\"__span-5-23\"><a id=\"__codelineno-5-23\" name=\"__codelineno-5-23\"></a><span class=\"w\">    </span><span class=\"p\">);</span>\n</span><span id=\"__span-5-24\"><a id=\"__codelineno-5-24\" name=\"__codelineno-5-24\"></a><span class=\"w\">    </span><span class=\"n\">program_client</span>\n</span><span id=\"__span-5-25\"><a id=\"__codelineno-5-25\" name=\"__codelineno-5-25\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-5-26\"><a id=\"__codelineno-5-26\" name=\"__codelineno-5-26\"></a>\n</span><span id=\"__span-5-27\"><a id=\"__codelineno-5-27\" name=\"__codelineno-5-27\"></a><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">keypair_clone</span><span class=\"p\">(</span><span class=\"n\">kp</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kp\">&amp;</span><span class=\"nc\">Keypair</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">Keypair</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-5-28\"><a id=\"__codelineno-5-28\" name=\"__codelineno-5-28\"></a><span class=\"w\">    </span><span class=\"n\">Keypair</span><span class=\"p\">::</span><span class=\"n\">from_bytes</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">kp</span><span class=\"p\">.</span><span class=\"n\">to_bytes</span><span class=\"p\">()).</span><span class=\"n\">expect</span><span class=\"p\">(</span><span class=\"s\">&quot;failed to copy keypair&quot;</span><span class=\"p\">)</span>\n</span><span id=\"__span-5-29\"><a id=\"__codelineno-5-29\" name=\"__codelineno-5-29\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-5-30\"><a id=\"__codelineno-5-30\" name=\"__codelineno-5-30\"></a>\n</span><span id=\"__span-5-31\"><a id=\"__codelineno-5-31\" name=\"__codelineno-5-31\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">wrap_sol_fn</span><span class=\"p\">(</span><span class=\"n\">wrap_amount</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">u64</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">keypair</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kp\">&amp;</span><span class=\"nc\">Arc</span><span class=\"o\">&lt;</span><span class=\"n\">Keypair</span><span class=\"o\">&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rpc_endpoint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">String</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-5-32\"><a id=\"__codelineno-5-32\" name=\"__codelineno-5-32\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">wsol_wrap_amount</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kt\">u64</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wrap_amount</span><span class=\"p\">;</span>\n</span><span id=\"__span-5-33\"><a id=\"__codelineno-5-33\" name=\"__codelineno-5-33\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">rpc</span><span class=\"p\">(</span><span class=\"n\">rpc_endpoint</span><span class=\"p\">);</span>\n</span><span id=\"__span-5-34\"><a id=\"__codelineno-5-34\" name=\"__codelineno-5-34\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">program_client</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">program_rpc</span><span class=\"p\">(</span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">clone</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">client</span><span class=\"p\">));</span>\n</span><span id=\"__span-5-35\"><a id=\"__codelineno-5-35\" name=\"__codelineno-5-35\"></a>\n</span><span id=\"__span-5-36\"><a id=\"__codelineno-5-36\" name=\"__codelineno-5-36\"></a><span class=\"w\">    </span><span class=\"cm\">/* prepare the wSOL account */</span>\n</span><span id=\"__span-5-37\"><a id=\"__codelineno-5-37\" name=\"__codelineno-5-37\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">in_token_client</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Token</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span>\n</span><span id=\"__span-5-38\"><a id=\"__codelineno-5-38\" name=\"__codelineno-5-38\"></a><span class=\"w\">        </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">clone</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">program_client</span><span class=\"p\">),</span>\n</span><span id=\"__span-5-39\"><a id=\"__codelineno-5-39\" name=\"__codelineno-5-39\"></a><span class=\"w\">        </span><span class=\"o\">&amp;</span><span class=\"n\">spl_token</span><span class=\"p\">::</span><span class=\"n\">ID</span><span class=\"p\">,</span>\n</span><span id=\"__span-5-40\"><a id=\"__codelineno-5-40\" name=\"__codelineno-5-40\"></a><span class=\"w\">        </span><span class=\"o\">&amp;</span><span class=\"n\">spl_token</span><span class=\"p\">::</span><span class=\"n\">native_mint</span><span class=\"p\">::</span><span class=\"n\">id</span><span class=\"p\">(),</span>\n</span><span id=\"__span-5-41\"><a id=\"__codelineno-5-41\" name=\"__codelineno-5-41\"></a><span class=\"w\">        </span><span class=\"nb\">None</span><span class=\"p\">,</span>\n</span><span id=\"__span-5-42\"><a id=\"__codelineno-5-42\" name=\"__codelineno-5-42\"></a><span class=\"w\">        </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">keypair_clone</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">keypair</span><span class=\"p\">)),</span>\n</span><span id=\"__span-5-43\"><a id=\"__codelineno-5-43\" name=\"__codelineno-5-43\"></a><span class=\"w\">    </span><span class=\"p\">);</span>\n</span><span id=\"__span-5-44\"><a id=\"__codelineno-5-44\" name=\"__codelineno-5-44\"></a>\n</span><span id=\"__span-5-45\"><a id=\"__codelineno-5-45\" name=\"__codelineno-5-45\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">user_in_token_account</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">in_token_client</span><span class=\"p\">.</span><span class=\"n\">get_associated_token_address</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">keypair</span><span class=\"p\">.</span><span class=\"n\">pubkey</span><span class=\"p\">());</span>\n</span><span id=\"__span-5-46\"><a id=\"__codelineno-5-46\" name=\"__codelineno-5-46\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">wsol_acc_exists</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">in_token_client</span>\n</span><span id=\"__span-5-47\"><a id=\"__codelineno-5-47\" name=\"__codelineno-5-47\"></a><span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">get_account_info</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">user_in_token_account</span><span class=\"p\">)</span>\n</span><span id=\"__span-5-48\"><a id=\"__codelineno-5-48\" name=\"__codelineno-5-48\"></a><span class=\"w\">        </span><span class=\"p\">.</span><span class=\"k\">await</span><span class=\"p\">;</span>\n</span><span id=\"__span-5-49\"><a id=\"__codelineno-5-49\" name=\"__codelineno-5-49\"></a>\n</span><span id=\"__span-5-50\"><a id=\"__codelineno-5-50\" name=\"__codelineno-5-50\"></a><span class=\"w\">    </span><span class=\"cm\">/* ensure wsol token program has not been closed! */</span>\n</span><span id=\"__span-5-51\"><a id=\"__codelineno-5-51\" name=\"__codelineno-5-51\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">wsol_acc_exists</span><span class=\"p\">.</span><span class=\"n\">is_err</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-5-52\"><a id=\"__codelineno-5-52\" name=\"__codelineno-5-52\"></a><span class=\"w\">        </span><span class=\"n\">in_token_client</span><span class=\"p\">.</span><span class=\"n\">create_associated_token_account</span><span class=\"p\">(</span>\n</span><span id=\"__span-5-53\"><a id=\"__codelineno-5-53\" name=\"__codelineno-5-53\"></a><span class=\"w\">            </span><span class=\"o\">&amp;</span><span class=\"n\">keypair</span><span class=\"p\">.</span><span class=\"n\">pubkey</span><span class=\"p\">()</span>\n</span><span id=\"__span-5-54\"><a id=\"__codelineno-5-54\" name=\"__codelineno-5-54\"></a><span class=\"w\">        </span><span class=\"p\">).</span><span class=\"k\">await</span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n</span><span id=\"__span-5-55\"><a id=\"__codelineno-5-55\" name=\"__codelineno-5-55\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-5-56\"><a id=\"__codelineno-5-56\" name=\"__codelineno-5-56\"></a>\n</span><span id=\"__span-5-57\"><a id=\"__codelineno-5-57\" name=\"__codelineno-5-57\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">user_in_acct</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">in_token_client</span>\n</span><span id=\"__span-5-58\"><a id=\"__codelineno-5-58\" name=\"__codelineno-5-58\"></a><span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">get_account_info</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">user_in_token_account</span><span class=\"p\">)</span>\n</span><span id=\"__span-5-59\"><a id=\"__codelineno-5-59\" name=\"__codelineno-5-59\"></a><span class=\"w\">        </span><span class=\"p\">.</span><span class=\"k\">await</span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n</span><span id=\"__span-5-60\"><a id=\"__codelineno-5-60\" name=\"__codelineno-5-60\"></a>\n</span><span id=\"__span-5-61\"><a id=\"__codelineno-5-61\" name=\"__codelineno-5-61\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">balance</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">user_in_acct</span><span class=\"p\">.</span><span class=\"n\">base</span><span class=\"p\">.</span><span class=\"n\">amount</span><span class=\"p\">;</span>\n</span><span id=\"__span-5-62\"><a id=\"__codelineno-5-62\" name=\"__codelineno-5-62\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">in_token_client</span><span class=\"p\">.</span><span class=\"n\">is_native</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">balance</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">wsol_wrap_amount</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-5-63\"><a id=\"__codelineno-5-63\" name=\"__codelineno-5-63\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">transfer_amt</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">wsol_wrap_amount</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">balance</span><span class=\"p\">;</span>\n</span><span id=\"__span-5-64\"><a id=\"__codelineno-5-64\" name=\"__codelineno-5-64\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">blockhash</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"p\">.</span><span class=\"n\">get_latest_blockhash</span><span class=\"p\">().</span><span class=\"k\">await</span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n</span><span id=\"__span-5-65\"><a id=\"__codelineno-5-65\" name=\"__codelineno-5-65\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">transfer_instruction</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">solana_sdk</span><span class=\"p\">::</span><span class=\"n\">system_instruction</span><span class=\"p\">::</span><span class=\"n\">transfer</span><span class=\"p\">(</span>\n</span><span id=\"__span-5-66\"><a id=\"__codelineno-5-66\" name=\"__codelineno-5-66\"></a><span class=\"w\">            </span><span class=\"o\">&amp;</span><span class=\"n\">keypair</span><span class=\"p\">.</span><span class=\"n\">pubkey</span><span class=\"p\">(),</span>\n</span><span id=\"__span-5-67\"><a id=\"__codelineno-5-67\" name=\"__codelineno-5-67\"></a><span class=\"w\">            </span><span class=\"o\">&amp;</span><span class=\"n\">user_in_token_account</span><span class=\"p\">,</span>\n</span><span id=\"__span-5-68\"><a id=\"__codelineno-5-68\" name=\"__codelineno-5-68\"></a><span class=\"w\">            </span><span class=\"n\">transfer_amt</span><span class=\"p\">,</span>\n</span><span id=\"__span-5-69\"><a id=\"__codelineno-5-69\" name=\"__codelineno-5-69\"></a><span class=\"w\">        </span><span class=\"p\">);</span>\n</span><span id=\"__span-5-70\"><a id=\"__codelineno-5-70\" name=\"__codelineno-5-70\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">sync_instruction</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</span><span id=\"__span-5-71\"><a id=\"__codelineno-5-71\" name=\"__codelineno-5-71\"></a><span class=\"w\">            </span><span class=\"n\">spl_token</span><span class=\"p\">::</span><span class=\"n\">instruction</span><span class=\"p\">::</span><span class=\"n\">sync_native</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">spl_token</span><span class=\"p\">::</span><span class=\"n\">ID</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">user_in_token_account</span><span class=\"p\">).</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n</span><span id=\"__span-5-72\"><a id=\"__codelineno-5-72\" name=\"__codelineno-5-72\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">tx</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Transaction</span><span class=\"p\">::</span><span class=\"n\">new_signed_with_payer</span><span class=\"p\">(</span>\n</span><span id=\"__span-5-73\"><a id=\"__codelineno-5-73\" name=\"__codelineno-5-73\"></a><span class=\"w\">            </span><span class=\"o\">&amp;</span><span class=\"p\">[</span><span class=\"n\">transfer_instruction</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sync_instruction</span><span class=\"p\">],</span>\n</span><span id=\"__span-5-74\"><a id=\"__codelineno-5-74\" name=\"__codelineno-5-74\"></a><span class=\"w\">            </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">keypair</span><span class=\"p\">.</span><span class=\"n\">pubkey</span><span class=\"p\">()),</span>\n</span><span id=\"__span-5-75\"><a id=\"__codelineno-5-75\" name=\"__codelineno-5-75\"></a><span class=\"w\">            </span><span class=\"o\">&amp;</span><span class=\"p\">[</span><span class=\"o\">&amp;</span><span class=\"n\">keypair</span><span class=\"p\">],</span>\n</span><span id=\"__span-5-76\"><a id=\"__codelineno-5-76\" name=\"__codelineno-5-76\"></a><span class=\"w\">            </span><span class=\"n\">blockhash</span><span class=\"p\">,</span>\n</span><span id=\"__span-5-77\"><a id=\"__codelineno-5-77\" name=\"__codelineno-5-77\"></a><span class=\"w\">        </span><span class=\"p\">);</span>\n</span><span id=\"__span-5-78\"><a id=\"__codelineno-5-78\" name=\"__codelineno-5-78\"></a>\n</span><span id=\"__span-5-79\"><a id=\"__codelineno-5-79\" name=\"__codelineno-5-79\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">signature</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"p\">.</span><span class=\"n\">send_transaction</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">tx</span><span class=\"p\">).</span><span class=\"k\">await</span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n</span><span id=\"__span-5-80\"><a id=\"__codelineno-5-80\" name=\"__codelineno-5-80\"></a><span class=\"w\">        </span><span class=\"fm\">println!</span><span class=\"p\">(</span><span class=\"s\">&quot;signature {signature:?}&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-5-81\"><a id=\"__codelineno-5-81\" name=\"__codelineno-5-81\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-5-82\"><a id=\"__codelineno-5-82\" name=\"__codelineno-5-82\"></a><span class=\"p\">}</span>\n</span></code></pre></div></td></tr></table></div>\n</div>\n<p>A lot happened again, so let's go over it step by step.  </p>\n<p>Lines 9 to 15 define the `WrapArgs struct, which takes a float as an argument to specify how much SOL to wrap into wSOL.</p>\n<h3 id=\"wsol-transaction\"><strong>WSOL transaction</strong></h3>\n<p>Now, let's break down the instructions from lines 32 to 80.</p>\n<p><div class=\"language-Rust highlight\"><pre><span></span><code><span id=\"__span-6-1\"><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"cm\">/* prepare the wSOL account */</span>\n</span><span id=\"__span-6-2\"><a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">in_token_client</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Token</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span>\n</span><span id=\"__span-6-3\"><a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"w\">    </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">clone</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">program_client</span><span class=\"p\">),</span>\n</span><span id=\"__span-6-4\"><a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a><span class=\"w\">    </span><span class=\"o\">&amp;</span><span class=\"n\">spl_token</span><span class=\"p\">::</span><span class=\"n\">ID</span><span class=\"p\">,</span>\n</span><span id=\"__span-6-5\"><a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a><span class=\"w\">    </span><span class=\"o\">&amp;</span><span class=\"n\">spl_token</span><span class=\"p\">::</span><span class=\"n\">native_mint</span><span class=\"p\">::</span><span class=\"n\">id</span><span class=\"p\">(),</span>\n</span><span id=\"__span-6-6\"><a id=\"__codelineno-6-6\" name=\"__codelineno-6-6\" href=\"#__codelineno-6-6\"></a><span class=\"w\">    </span><span class=\"nb\">None</span><span class=\"p\">,</span>\n</span><span id=\"__span-6-7\"><a id=\"__codelineno-6-7\" name=\"__codelineno-6-7\" href=\"#__codelineno-6-7\"></a><span class=\"w\">    </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">keypair_clone</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">keypair</span><span class=\"p\">)),</span>\n</span><span id=\"__span-6-8\"><a id=\"__codelineno-6-8\" name=\"__codelineno-6-8\" href=\"#__codelineno-6-8\"></a><span class=\"p\">);</span>\n</span></code></pre></div>\nLines 37 to 43: We simply create a struct with the necessary information for the functions used later.</p>\n<p><div class=\"language-Rust highlight\"><pre><span></span><code><span id=\"__span-7-1\"><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">user_in_token_account</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">in_token_client</span><span class=\"p\">.</span><span class=\"n\">get_associated_token_address</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">keypair</span><span class=\"p\">.</span><span class=\"n\">pubkey</span><span class=\"p\">());</span>\n</span><span id=\"__span-7-2\"><a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">wsol_acc_exists</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">in_token_client</span>\n</span><span id=\"__span-7-3\"><a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a><span class=\"w\">    </span><span class=\"p\">.</span><span class=\"n\">get_account_info</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">user_in_token_account</span><span class=\"p\">)</span>\n</span><span id=\"__span-7-4\"><a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a><span class=\"w\">    </span><span class=\"p\">.</span><span class=\"k\">await</span><span class=\"p\">;</span>\n</span></code></pre></div>\nLine 45: We check if we can derive our wSOL account address and in lines 46 to 48: We fetch that address.</p>\n<p><div class=\"language-Rust highlight\"><pre><span></span><code><span id=\"__span-8-1\"><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a><span class=\"cm\">/* ensure wsol token program has not been closed! */</span>\n</span><span id=\"__span-8-2\"><a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">wsol_acc_exists</span><span class=\"p\">.</span><span class=\"n\">is_err</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-8-3\"><a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a><span class=\"w\">    </span><span class=\"n\">in_token_client</span><span class=\"p\">.</span><span class=\"n\">create_associated_token_account</span><span class=\"p\">(</span>\n</span><span id=\"__span-8-4\"><a id=\"__codelineno-8-4\" name=\"__codelineno-8-4\" href=\"#__codelineno-8-4\"></a><span class=\"w\">        </span><span class=\"o\">&amp;</span><span class=\"n\">keypair</span><span class=\"p\">.</span><span class=\"n\">pubkey</span><span class=\"p\">()</span>\n</span><span id=\"__span-8-5\"><a id=\"__codelineno-8-5\" name=\"__codelineno-8-5\" href=\"#__codelineno-8-5\"></a><span class=\"w\">    </span><span class=\"p\">).</span><span class=\"k\">await</span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n</span><span id=\"__span-8-6\"><a id=\"__codelineno-8-6\" name=\"__codelineno-8-6\" href=\"#__codelineno-8-6\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\nLines 51 to 55: We create the wSOL address if it does not already exist.</p>\n<p><div class=\"language-Rust highlight\"><pre><span></span><code><span id=\"__span-9-1\"><a id=\"__codelineno-9-1\" name=\"__codelineno-9-1\" href=\"#__codelineno-9-1\"></a><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">user_in_acct</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">in_token_client</span>\n</span><span id=\"__span-9-2\"><a id=\"__codelineno-9-2\" name=\"__codelineno-9-2\" href=\"#__codelineno-9-2\"></a><span class=\"w\">    </span><span class=\"p\">.</span><span class=\"n\">get_account_info</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">user_in_token_account</span><span class=\"p\">)</span>\n</span><span id=\"__span-9-3\"><a id=\"__codelineno-9-3\" name=\"__codelineno-9-3\" href=\"#__codelineno-9-3\"></a><span class=\"w\">    </span><span class=\"p\">.</span><span class=\"k\">await</span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n</span></code></pre></div>\nLine 57: We fetch our SOL account address.</p>\n<p>That wasn\u2019t so bad, right? \ud83d\ude09</p>\n<p>The remainder of the code simply handles the amount, signing, and actually sending the transaction. It then prints the transaction signature so we can look it up on-chain using sites like <a href=\"solana.fm\">solana.fm</a> and <a href=\"solscan.io\">solscan.io</a>.  </p>\n<h3 id=\"adding-private-key-to-environment-variables\">Adding Private Key to Environment Variables</h3>\n<div class=\"admonition danger\">\n<p class=\"admonition-title\">A word of caution:</p>\n<p>While researching how to build my own Solana sniper, I reviewed numerous codebases, and almost all had one thing in common\u2014they were malicious honeypots designed to steal unsuspecting victims' private keys and drain their entire SOL balance. <br />\nAlways be extremely careful with the code you execute and where you store your private key. Even better, make sure you understand each line of the code before running any program that involves your private key.</p>\n</div>\n<p>The final step for wrapping SOL is to add our private key to our environment variables (env) so it can be used for signing and approving transactions in the <code>wrap-sol</code> command.</p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Update <code>pub fn new()</code> in <code>utils/src/env/env.rs</code> to</p>\n<div class=\"language-Rust highlight\"><table class=\"highlighttable\"><tr><td class=\"linenos\"><div class=\"linenodiv\"><pre><span></span><span class=\"normal\"><a href=\"#__codelineno-10-1\"> 1</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-2\"> 2</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-3\"> 3</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-4\"> 4</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-5\"> 5</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-6\"> 6</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-7\"> 7</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-8\"> 8</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-9\"> 9</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-10\">10</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-11\">11</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-12\">12</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-13\">13</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-14\">14</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-15\">15</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-16\">16</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-17\">17</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-18\">18</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-19\">19</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-20\">20</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-21\">21</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-22\">22</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-23\">23</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-24\">24</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-25\">25</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-26\">26</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-27\">27</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-28\">28</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-29\">29</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-30\">30</a></span>\n<span class=\"normal\"><a href=\"#__codelineno-10-31\">31</a></span></pre></div></td><td class=\"code\"><div><pre><span></span><code><span id=\"__span-10-1\"><a id=\"__codelineno-10-1\" name=\"__codelineno-10-1\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">new</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"bp\">Self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">EnvErrors</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-10-2\"><a id=\"__codelineno-10-2\" name=\"__codelineno-10-2\"></a><span class=\"c1\">// Test if .env exists or give the option to create one from .env.dist</span>\n</span><span id=\"__span-10-3\"><a id=\"__codelineno-10-3\" name=\"__codelineno-10-3\"></a><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Path</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"s\">&quot;.env&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-10-4\"><a id=\"__codelineno-10-4\" name=\"__codelineno-10-4\"></a><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">!</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"p\">.</span><span class=\"n\">exists</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-10-5\"><a id=\"__codelineno-10-5\" name=\"__codelineno-10-5\"></a><span class=\"w\">    </span><span class=\"fm\">println!</span><span class=\"p\">(</span><span class=\"s\">&quot;Could not find .env, would you like to use .env.dist as a template instead? (y/n)&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-10-6\"><a id=\"__codelineno-10-6\" name=\"__codelineno-10-6\"></a><span class=\"w\">    </span><span class=\"n\">create_env</span><span class=\"p\">().</span><span class=\"n\">expect</span><span class=\"p\">(</span><span class=\"s\">&quot;Failed creating .env file&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-10-7\"><a id=\"__codelineno-10-7\" name=\"__codelineno-10-7\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-10-8\"><a id=\"__codelineno-10-8\" name=\"__codelineno-10-8\"></a><span class=\"n\">dotenv</span><span class=\"p\">::</span><span class=\"n\">from_path</span><span class=\"p\">(</span><span class=\"s\">&quot;.env&quot;</span><span class=\"p\">).</span><span class=\"n\">ok</span><span class=\"p\">();</span>\n</span><span id=\"__span-10-9\"><a id=\"__codelineno-10-9\" name=\"__codelineno-10-9\"></a>\n</span><span id=\"__span-10-10\"><a id=\"__codelineno-10-10\" name=\"__codelineno-10-10\"></a><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">loglevel</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">parse_log_level</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">&quot;LOG_LEVEL&quot;</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">));</span>\n</span><span id=\"__span-10-11\"><a id=\"__codelineno-10-11\" name=\"__codelineno-10-11\"></a>\n</span><span id=\"__span-10-12\"><a id=\"__codelineno-10-12\" name=\"__codelineno-10-12\"></a><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">websocket_endpoint</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">&quot;WEBSOCKET_ENDPOINT&quot;</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">);</span>\n</span><span id=\"__span-10-13\"><a id=\"__codelineno-10-13\" name=\"__codelineno-10-13\"></a><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">rpc_endpoint</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">&quot;RPC_ENDPOINT&quot;</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">);</span>\n</span><span id=\"__span-10-14\"><a id=\"__codelineno-10-14\" name=\"__codelineno-10-14\"></a>\n</span><span id=\"__span-10-15\"><a id=\"__codelineno-10-15\" name=\"__codelineno-10-15\"></a><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">private_key_path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">&quot;PRIVATE_KEYPAIR&quot;</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">;</span>\n</span><span id=\"__span-10-16\"><a id=\"__codelineno-10-16\" name=\"__codelineno-10-16\"></a><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">private_key</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">Keypair</span><span class=\"p\">::</span><span class=\"n\">read_from_file</span><span class=\"p\">(</span><span class=\"n\">private_key_path</span><span class=\"p\">).</span><span class=\"n\">unwrap</span><span class=\"p\">());</span>\n</span><span id=\"__span-10-17\"><a id=\"__codelineno-10-17\" name=\"__codelineno-10-17\"></a>\n</span><span id=\"__span-10-18\"><a id=\"__codelineno-10-18\" name=\"__codelineno-10-18\"></a><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">swap_amount</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">&quot;SWAP_AMOUNT&quot;</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">.</span><span class=\"n\">parse</span><span class=\"p\">::</span><span class=\"o\">&lt;</span><span class=\"kt\">u64</span><span class=\"o\">&gt;</span><span class=\"p\">().</span><span class=\"n\">unwrap</span><span class=\"p\">());</span>\n</span><span id=\"__span-10-19\"><a id=\"__codelineno-10-19\" name=\"__codelineno-10-19\"></a><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">swap_priority_fee</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">&quot;SWAP_PRIORITY_FEE&quot;</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">.</span><span class=\"n\">parse</span><span class=\"p\">::</span><span class=\"o\">&lt;</span><span class=\"kt\">u64</span><span class=\"o\">&gt;</span><span class=\"p\">().</span><span class=\"n\">unwrap</span><span class=\"p\">());</span>\n</span><span id=\"__span-10-20\"><a id=\"__codelineno-10-20\" name=\"__codelineno-10-20\"></a>\n</span><span id=\"__span-10-21\"><a id=\"__codelineno-10-21\" name=\"__codelineno-10-21\"></a><span class=\"nb\">Ok</span><span class=\"p\">(</span>\n</span><span id=\"__span-10-22\"><a id=\"__codelineno-10-22\" name=\"__codelineno-10-22\"></a><span class=\"w\">    </span><span class=\"bp\">Self</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-10-23\"><a id=\"__codelineno-10-23\" name=\"__codelineno-10-23\"></a><span class=\"w\">        </span><span class=\"n\">loglevel</span><span class=\"p\">,</span>\n</span><span id=\"__span-10-24\"><a id=\"__codelineno-10-24\" name=\"__codelineno-10-24\"></a><span class=\"w\">        </span><span class=\"n\">websocket_endpoint</span><span class=\"p\">,</span>\n</span><span id=\"__span-10-25\"><a id=\"__codelineno-10-25\" name=\"__codelineno-10-25\"></a><span class=\"w\">        </span><span class=\"n\">rpc_endpoint</span><span class=\"p\">,</span>\n</span><span id=\"__span-10-26\"><a id=\"__codelineno-10-26\" name=\"__codelineno-10-26\"></a><span class=\"w\">        </span><span class=\"n\">private_key</span><span class=\"p\">,</span>\n</span><span id=\"__span-10-27\"><a id=\"__codelineno-10-27\" name=\"__codelineno-10-27\"></a><span class=\"w\">        </span><span class=\"n\">swap_amount</span><span class=\"p\">,</span>\n</span><span id=\"__span-10-28\"><a id=\"__codelineno-10-28\" name=\"__codelineno-10-28\"></a><span class=\"w\">        </span><span class=\"n\">swap_priority_fee</span><span class=\"p\">,</span>\n</span><span id=\"__span-10-29\"><a id=\"__codelineno-10-29\" name=\"__codelineno-10-29\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-10-30\"><a id=\"__codelineno-10-30\" name=\"__codelineno-10-30\"></a><span class=\"p\">)</span>\n</span><span id=\"__span-10-31\"><a id=\"__codelineno-10-31\" name=\"__codelineno-10-31\"></a><span class=\"p\">}</span>\n</span></code></pre></div></td></tr></table></div>\n</div>\n<p>Lines 15 to 16 read the <code>PRIVATE_KEYPAIR</code> directive from the .env file and load the private keypair into memory.</p>\n<h2 id=\"test-run\">Test run</h2>\n<p>With all that set up, let's test it out on the devnet and see if it works.</p>\n<p>Before using your own private key, let's run a simple test on the Solana devnet using a newly generated random keypair and observe the results.</p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Be careful not to overwrite your current private key with this command unless you have a backup.</p>\n<div class=\"language-bash highlight\"><pre><span></span><code><span id=\"__span-11-1\"><a id=\"__codelineno-11-1\" name=\"__codelineno-11-1\" href=\"#__codelineno-11-1\"></a><span class=\"c1\"># Create a new key called private_key.json</span>\n</span><span id=\"__span-11-2\"><a id=\"__codelineno-11-2\" name=\"__codelineno-11-2\" href=\"#__codelineno-11-2\"></a>solana-keygen<span class=\"w\"> </span>new<span class=\"w\"> </span>-o<span class=\"w\"> </span>private_key.json\n</span><span id=\"__span-11-3\"><a id=\"__codelineno-11-3\" name=\"__codelineno-11-3\" href=\"#__codelineno-11-3\"></a>\n</span><span id=\"__span-11-4\"><a id=\"__codelineno-11-4\" name=\"__codelineno-11-4\" href=\"#__codelineno-11-4\"></a><span class=\"c1\"># Switch default config to use devnet</span>\n</span><span id=\"__span-11-5\"><a id=\"__codelineno-11-5\" name=\"__codelineno-11-5\" href=\"#__codelineno-11-5\"></a>solana<span class=\"w\"> </span>config<span class=\"w\"> </span><span class=\"nb\">set</span><span class=\"w\"> </span>--url<span class=\"w\"> </span>https://api.devnet.solana.com\n</span><span id=\"__span-11-6\"><a id=\"__codelineno-11-6\" name=\"__codelineno-11-6\" href=\"#__codelineno-11-6\"></a>\n</span><span id=\"__span-11-7\"><a id=\"__codelineno-11-7\" name=\"__codelineno-11-7\" href=\"#__codelineno-11-7\"></a><span class=\"c1\"># Get the public key of your wallet mine was 3Vy1sD9fwzUv6npTE8qM2o4DJGRRXdLryhyKfmjZByGu</span>\n</span><span id=\"__span-11-8\"><a id=\"__codelineno-11-8\" name=\"__codelineno-11-8\" href=\"#__codelineno-11-8\"></a>solana-keygen<span class=\"w\"> </span>pubkey<span class=\"w\"> </span>private_key.json\n</span><span id=\"__span-11-9\"><a id=\"__codelineno-11-9\" name=\"__codelineno-11-9\" href=\"#__codelineno-11-9\"></a>\n</span><span id=\"__span-11-10\"><a id=\"__codelineno-11-10\" name=\"__codelineno-11-10\" href=\"#__codelineno-11-10\"></a><span class=\"c1\"># Request an airdrop with fake SOL on the devnet</span>\n</span><span id=\"__span-11-11\"><a id=\"__codelineno-11-11\" name=\"__codelineno-11-11\" href=\"#__codelineno-11-11\"></a>solana<span class=\"w\"> </span>airdrop<span class=\"w\"> </span><span class=\"m\">2</span><span class=\"w\"> </span>3Vy1sD9fwzUv6npTE8qM2o4DJGRRXdLryhyKfmjZByGu\n</span></code></pre></div>\n</div>\n<p>Lastly, edit the .env file and add or replace this line: <code>PRIVATE_KEYPAIR=private_key.json</code><br />\nAlso, set the RPC_ENDPOINT to devnet while we are testing: <code>RPC_ENDPOINT=https://api.devnet.solana.com</code></p>\n<p>Once you have executed the commands from the previous steps, you should be all set to wrap some SOL into wSOL!</p>\n<figure>\n<p><img alt=\"Solana.fm with my wallet\" src=\"/static/raydium_sniper_part_4/2025-03-12_23-04.png\" /></p>\n<figcaption>\n<p>Solana.fm with my wallet</p>\n</figcaption>\n</figure>\n<figure>\n<p>Lets execute\n<div class=\"language-Bash highlight\"><pre><span></span><code><span id=\"__span-12-1\"><a id=\"__codelineno-12-1\" name=\"__codelineno-12-1\" href=\"#__codelineno-12-1\"></a>cargo<span class=\"w\"> </span>run<span class=\"w\"> </span>--bin<span class=\"w\"> </span>shell<span class=\"w\"> </span>wrap-sol<span class=\"w\"> </span>--amount<span class=\"w\"> </span><span class=\"m\">0</span>.2\n</span></code></pre></div>\nso we exchange 0.2 SOL for 0.2 WSOL.\n<img alt=\"Executing wsol wrap command\" src=\"/static/raydium_sniper_part_4/Screenshot 2025-03-12 at 23.12.12.png\" /></p>\n<figcaption>\n<p>Executing wSOL wrap command</p>\n</figcaption>\n</figure>\n<p>As you can see, I got the <a href=\"https://solana.fm/tx/MY4VpvZig1H6y2KHB9EuQuqYaZh7Yx7nEbUtHHhhkdxHxQcaZbgr5Yh13UxRq4U2TYJnfPURJ5au5PWTH8TqXnU?cluster=devnet-alpha\">signature</a>.</p>\n<div class=\"admonition node\">\n<p class=\"admonition-title\">If you get this error, it likely means you either forgot to change the RPC_ENDPOINT to devnet or did not successfully receive the 2 SOL airdrop.</p>\n<figure>\n<p><img alt=\"Executing wsol wrap command error\" src=\"/static/raydium_sniper_part_4/Screenshot 2025-03-12 at 23.16.25.png\" /></p>\n<figcaption>\n<p>Error wrapping sol</p>\n</figcaption>\n</figure>\n</div>\n<p>Great! Now, how do we confirm that the SOL was actually wrapped and not just burned? \nNavigate to <a href=\"https://solana.fm/address/3Vy1sD9fwzUv6npTE8qM2o4DJGRRXdLryhyKfmjZByGu/tokens?cluster=devnet-alpha\">my wallet</a> to check.</p>\n<figure>\n<p><img alt=\"Displaying wrapped sol\" src=\"/static/raydium_sniper_part_4/2025-03-12_23-21.png\" /></p>\n<figcaption>\n<p>Displaying wrapped sol</p>\n</figcaption>\n</figure>\n<h2 id=\"why-are-we-wrapping-sol-in-a-command\">Why are we wrapping sol in a command?</h2>\n<p>We are wrapping SOL in a command because each instruction in a transaction increases computational usage (measured in compute units or CUs). The more CUs a transaction consumes, the less likely it is to be processed quickly.</p>\n<p>Solana is designed to fit as many transactions as possible into a single block. Once a block is nearly full, some transactions will have to wait for the next block. However, if your swap transaction is small enough, it has a higher chance of being included faster potentially ahead of other, larger transactions that might be skipped. </p>\n<h2 id=\"up-next\">Up next</h2>\n<p>In the next article, we will look into how to change our SOL to WSOL, which is needed for swapping, we will do this with a command line layer.</p>", "image": null, "date_modified": "2025-03-12T22:43:25+00:00", "authors": [{"name": "Alexander H\u00f8gh"}], "tags": ["Solana", "Solana Sniper"]}, {"id": "https://helius.dk/blog/2025/01/09/writing-a-raydium-sniper-in-rust-part-2/", "url": "https://helius.dk/blog/2025/01/09/writing-a-raydium-sniper-in-rust-part-2/", "title": "Writing a Raydium sniper in Rust part 2", "content_html": "<p><img alt=\"AI generated image of an office with screens and graphs\" src=\"/static/raydium_sniper_part_2/y8.png\" /></p>\n<h1 id=\"writing-a-solana-raydium-sniper-in-rust-part-2\">Writing a Solana Raydium sniper in Rust part 2</h1>\n<p>This is part two of this series, where we are creating a Solana sniper bot for Raydium from scratch in Rust. <a href=\"/blog/2025/01/06/writing-a-raydium-sniper-in/\">See the first post here</a> which includes an introduction about why we use a compiled language instead of JavaScript, as well as a brief introduction about me. You can find the latest <a href=\"https://github.com/weestack/Solana-Sniper\">GitHub source here</a>, which will be updated with each new post.</p>\n<!-- more -->\n\n<h2 id=\"setting-up-a-logger\">Setting up a logger</h2>\n<p>Using logging in any software is essential, as it helps with debugging. Standard log levels include trace, debug, info, warn, and error.</p>\n<p>For logging, we will use <code>env_logger</code> to configure the standard logger, and <code>log</code> to write logs at different levels.</p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\"><code>Cargo.toml</code></p>\n</div>\n<div class=\"language-toml highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"c1\"># add under workspace.dependencies in root Cargo.toml</span>\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"n\">env_logger</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;0.11.6&quot;</span>\n</span><span id=\"__span-0-3\"><a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;0.4.22&quot;</span>\n</span><span id=\"__span-0-4\"><a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"c1\"># add under dependencies in utils/Cargo.tml</span>\n</span><span id=\"__span-0-5\"><a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"n\">env_logger</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-0-6\"><a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-0-7\"><a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a><span class=\"c1\"># add under dependencies in sniper/Cargo.tml</span>\n</span><span id=\"__span-0-8\"><a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>We use <code>env_logger</code> to modify Rust's standard log format so that all logs include timestamps formatted to milliseconds. This helps with orientation later by also displaying the file we are logging from, as shown in the image below.</p>\n<figure>\n<p><img alt=\"Terminal output of a started websocket in our rust program\" src=\"/static/raydium_sniper_part_2/Screenshot 2025-01-09 at 01.26.13.png\" /></p>\n<figcaption>\n<p>Terminal output of a started websocket in our rust program</p>\n</figcaption>\n</figure>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Inside <code>utils/src/env/env.rs</code>, update the rest of the code with the following:</p>\n</div>\n<div class=\"language-rust highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::{</span><span class=\"n\">env</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fmt</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fs</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">io</span><span class=\"p\">};</span>\n</span><span id=\"__span-1-2\"><a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">path</span><span class=\"p\">::</span><span class=\"n\">Path</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-3\"><a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">sync</span><span class=\"p\">::</span><span class=\"n\">Arc</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-4\"><a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">solana_program</span><span class=\"p\">::</span><span class=\"n\">native_token</span><span class=\"p\">::</span><span class=\"n\">lamports_to_sol</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-5\"><a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"k\">crate</span><span class=\"p\">::</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">errors</span><span class=\"p\">::</span><span class=\"n\">EnvErrors</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-6\"><a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">env_logger</span><span class=\"p\">::{</span><span class=\"n\">Builder</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Env</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">EnvBuilder</span><span class=\"p\">};</span><span class=\"w\"> </span><span class=\"c1\">//alias so we don&#39;t clash with our own Env struct ;</span>\n</span><span id=\"__span-1-7\"><a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"p\">::{</span><span class=\"n\">LevelFilter</span><span class=\"p\">};</span>\n</span><span id=\"__span-1-8\"><a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a>\n</span><span id=\"__span-1-9\"><a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">Env</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-10\"><a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">loglevel</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Arc</span><span class=\"o\">&lt;</span><span class=\"n\">LevelFilter</span><span class=\"o\">&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"c1\">// add LevelFilter eg enum warn, info, debug etc</span>\n</span><span id=\"__span-1-11\"><a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">websocket_endpoint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Arc</span><span class=\"o\">&lt;</span><span class=\"nb\">String</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-12\"><a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">rpc_endpoint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Arc</span><span class=\"o\">&lt;</span><span class=\"nb\">String</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-13\"><a id=\"__codelineno-1-13\" name=\"__codelineno-1-13\" href=\"#__codelineno-1-13\"></a><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">private_key</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Arc</span><span class=\"o\">&lt;</span><span class=\"nb\">String</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-14\"><a id=\"__codelineno-1-14\" name=\"__codelineno-1-14\" href=\"#__codelineno-1-14\"></a><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">swap_amount</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Arc</span><span class=\"o\">&lt;</span><span class=\"kt\">u64</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-15\"><a id=\"__codelineno-1-15\" name=\"__codelineno-1-15\" href=\"#__codelineno-1-15\"></a><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"n\">swap_priority_fee</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Arc</span><span class=\"o\">&lt;</span><span class=\"kt\">u64</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-16\"><a id=\"__codelineno-1-16\" name=\"__codelineno-1-16\" href=\"#__codelineno-1-16\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-1-17\"><a id=\"__codelineno-1-17\" name=\"__codelineno-1-17\" href=\"#__codelineno-1-17\"></a>\n</span><span id=\"__span-1-18\"><a id=\"__codelineno-1-18\" name=\"__codelineno-1-18\" href=\"#__codelineno-1-18\"></a><span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">Env</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-19\"><a id=\"__codelineno-1-19\" name=\"__codelineno-1-19\" href=\"#__codelineno-1-19\"></a><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">new</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"bp\">Self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">EnvErrors</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-20\"><a id=\"__codelineno-1-20\" name=\"__codelineno-1-20\" href=\"#__codelineno-1-20\"></a><span class=\"w\">        </span><span class=\"c1\">// Test if .env exists or give the option to create one from .env.dist</span>\n</span><span id=\"__span-1-21\"><a id=\"__codelineno-1-21\" name=\"__codelineno-1-21\" href=\"#__codelineno-1-21\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Path</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"s\">&quot;.env&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-22\"><a id=\"__codelineno-1-22\" name=\"__codelineno-1-22\" href=\"#__codelineno-1-22\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">!</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"p\">.</span><span class=\"n\">exists</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-23\"><a id=\"__codelineno-1-23\" name=\"__codelineno-1-23\" href=\"#__codelineno-1-23\"></a><span class=\"w\">            </span><span class=\"fm\">println!</span><span class=\"p\">(</span><span class=\"s\">&quot;Could not find .env, would you like to use .env.dist as a template instead? (y/n)&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-24\"><a id=\"__codelineno-1-24\" name=\"__codelineno-1-24\" href=\"#__codelineno-1-24\"></a><span class=\"w\">            </span><span class=\"n\">create_env</span><span class=\"p\">().</span><span class=\"n\">expect</span><span class=\"p\">(</span><span class=\"s\">&quot;Failed creating .env file&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-25\"><a id=\"__codelineno-1-25\" name=\"__codelineno-1-25\" href=\"#__codelineno-1-25\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-26\"><a id=\"__codelineno-1-26\" name=\"__codelineno-1-26\" href=\"#__codelineno-1-26\"></a><span class=\"w\">        </span><span class=\"n\">dotenv</span><span class=\"p\">::</span><span class=\"n\">from_path</span><span class=\"p\">(</span><span class=\"s\">&quot;.env&quot;</span><span class=\"p\">).</span><span class=\"n\">ok</span><span class=\"p\">();</span>\n</span><span id=\"__span-1-27\"><a id=\"__codelineno-1-27\" name=\"__codelineno-1-27\" href=\"#__codelineno-1-27\"></a>\n</span><span id=\"__span-1-28\"><a id=\"__codelineno-1-28\" name=\"__codelineno-1-28\" href=\"#__codelineno-1-28\"></a><span class=\"w\">        </span><span class=\"cm\">/* Read LOG_LEVEL from .env */</span>\n</span><span id=\"__span-1-29\"><a id=\"__codelineno-1-29\" name=\"__codelineno-1-29\" href=\"#__codelineno-1-29\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">loglevel</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">parse_log_level</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">&quot;LOG_LEVEL&quot;</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">));</span>\n</span><span id=\"__span-1-30\"><a id=\"__codelineno-1-30\" name=\"__codelineno-1-30\" href=\"#__codelineno-1-30\"></a>\n</span><span id=\"__span-1-31\"><a id=\"__codelineno-1-31\" name=\"__codelineno-1-31\" href=\"#__codelineno-1-31\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">websocket_endpoint</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">&quot;WEBSOCKET_ENDPOINT&quot;</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-32\"><a id=\"__codelineno-1-32\" name=\"__codelineno-1-32\" href=\"#__codelineno-1-32\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">rpc_endpoint</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">&quot;RPC_ENDPOINT&quot;</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-33\"><a id=\"__codelineno-1-33\" name=\"__codelineno-1-33\" href=\"#__codelineno-1-33\"></a>\n</span><span id=\"__span-1-34\"><a id=\"__codelineno-1-34\" name=\"__codelineno-1-34\" href=\"#__codelineno-1-34\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">private_key</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">&quot;PRIVATE_KEYPAIR&quot;</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-35\"><a id=\"__codelineno-1-35\" name=\"__codelineno-1-35\" href=\"#__codelineno-1-35\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">swap_amount</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">&quot;SWAP_AMOUNT&quot;</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">.</span><span class=\"n\">parse</span><span class=\"p\">::</span><span class=\"o\">&lt;</span><span class=\"kt\">u64</span><span class=\"o\">&gt;</span><span class=\"p\">().</span><span class=\"n\">unwrap</span><span class=\"p\">());</span>\n</span><span id=\"__span-1-36\"><a id=\"__codelineno-1-36\" name=\"__codelineno-1-36\" href=\"#__codelineno-1-36\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">swap_priority_fee</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">&quot;SWAP_PRIORITY_FEE&quot;</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">.</span><span class=\"n\">parse</span><span class=\"p\">::</span><span class=\"o\">&lt;</span><span class=\"kt\">u64</span><span class=\"o\">&gt;</span><span class=\"p\">().</span><span class=\"n\">unwrap</span><span class=\"p\">());</span>\n</span><span id=\"__span-1-37\"><a id=\"__codelineno-1-37\" name=\"__codelineno-1-37\" href=\"#__codelineno-1-37\"></a>\n</span><span id=\"__span-1-38\"><a id=\"__codelineno-1-38\" name=\"__codelineno-1-38\" href=\"#__codelineno-1-38\"></a><span class=\"w\">        </span><span class=\"nb\">Ok</span><span class=\"p\">(</span>\n</span><span id=\"__span-1-39\"><a id=\"__codelineno-1-39\" name=\"__codelineno-1-39\" href=\"#__codelineno-1-39\"></a><span class=\"w\">            </span><span class=\"bp\">Self</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-40\"><a id=\"__codelineno-1-40\" name=\"__codelineno-1-40\" href=\"#__codelineno-1-40\"></a><span class=\"w\">                </span><span class=\"n\">loglevel</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"c1\">// add loglevel to initialization of our struct</span>\n</span><span id=\"__span-1-41\"><a id=\"__codelineno-1-41\" name=\"__codelineno-1-41\" href=\"#__codelineno-1-41\"></a><span class=\"w\">                </span><span class=\"n\">websocket_endpoint</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-42\"><a id=\"__codelineno-1-42\" name=\"__codelineno-1-42\" href=\"#__codelineno-1-42\"></a><span class=\"w\">                </span><span class=\"n\">rpc_endpoint</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-43\"><a id=\"__codelineno-1-43\" name=\"__codelineno-1-43\" href=\"#__codelineno-1-43\"></a><span class=\"w\">                </span><span class=\"n\">private_key</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-44\"><a id=\"__codelineno-1-44\" name=\"__codelineno-1-44\" href=\"#__codelineno-1-44\"></a><span class=\"w\">                </span><span class=\"n\">swap_amount</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-45\"><a id=\"__codelineno-1-45\" name=\"__codelineno-1-45\" href=\"#__codelineno-1-45\"></a><span class=\"w\">                </span><span class=\"n\">swap_priority_fee</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-46\"><a id=\"__codelineno-1-46\" name=\"__codelineno-1-46\" href=\"#__codelineno-1-46\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-47\"><a id=\"__codelineno-1-47\" name=\"__codelineno-1-47\" href=\"#__codelineno-1-47\"></a><span class=\"w\">        </span><span class=\"p\">)</span>\n</span><span id=\"__span-1-48\"><a id=\"__codelineno-1-48\" name=\"__codelineno-1-48\" href=\"#__codelineno-1-48\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-49\"><a id=\"__codelineno-1-49\" name=\"__codelineno-1-49\" href=\"#__codelineno-1-49\"></a>\n</span><span id=\"__span-1-50\"><a id=\"__codelineno-1-50\" name=\"__codelineno-1-50\" href=\"#__codelineno-1-50\"></a><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">setup_logger</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-51\"><a id=\"__codelineno-1-51\" name=\"__codelineno-1-51\" href=\"#__codelineno-1-51\"></a><span class=\"w\">        </span><span class=\"c1\">// setup our custom logging format</span>\n</span><span id=\"__span-1-52\"><a id=\"__codelineno-1-52\" name=\"__codelineno-1-52\" href=\"#__codelineno-1-52\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">EnvBuilder</span><span class=\"p\">::</span><span class=\"n\">default</span><span class=\"p\">();</span>\n</span><span id=\"__span-1-53\"><a id=\"__codelineno-1-53\" name=\"__codelineno-1-53\" href=\"#__codelineno-1-53\"></a>\n</span><span id=\"__span-1-54\"><a id=\"__codelineno-1-54\" name=\"__codelineno-1-54\" href=\"#__codelineno-1-54\"></a><span class=\"w\">        </span><span class=\"n\">Builder</span><span class=\"p\">::</span><span class=\"n\">from_env</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">)</span>\n</span><span id=\"__span-1-55\"><a id=\"__codelineno-1-55\" name=\"__codelineno-1-55\" href=\"#__codelineno-1-55\"></a><span class=\"w\">            </span><span class=\"p\">.</span><span class=\"n\">filter_level</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">loglevel</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"c1\">// level from .env</span>\n</span><span id=\"__span-1-56\"><a id=\"__codelineno-1-56\" name=\"__codelineno-1-56\" href=\"#__codelineno-1-56\"></a><span class=\"w\">            </span><span class=\"p\">.</span><span class=\"n\">format_level</span><span class=\"p\">(</span><span class=\"kc\">false</span><span class=\"p\">)</span>\n</span><span id=\"__span-1-57\"><a id=\"__codelineno-1-57\" name=\"__codelineno-1-57\" href=\"#__codelineno-1-57\"></a><span class=\"w\">            </span><span class=\"p\">.</span><span class=\"n\">format_timestamp_millis</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"c1\">// display timestamp in milliseconds</span>\n</span><span id=\"__span-1-58\"><a id=\"__codelineno-1-58\" name=\"__codelineno-1-58\" href=\"#__codelineno-1-58\"></a><span class=\"w\">            </span><span class=\"p\">.</span><span class=\"n\">init</span><span class=\"p\">();</span>\n</span><span id=\"__span-1-59\"><a id=\"__codelineno-1-59\" name=\"__codelineno-1-59\" href=\"#__codelineno-1-59\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-60\"><a id=\"__codelineno-1-60\" name=\"__codelineno-1-60\" href=\"#__codelineno-1-60\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-1-61\"><a id=\"__codelineno-1-61\" name=\"__codelineno-1-61\" href=\"#__codelineno-1-61\"></a>\n</span><span id=\"__span-1-62\"><a id=\"__codelineno-1-62\" name=\"__codelineno-1-62\" href=\"#__codelineno-1-62\"></a><span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">fmt</span><span class=\"p\">::</span><span class=\"n\">Display</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Env</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-63\"><a id=\"__codelineno-1-63\" name=\"__codelineno-1-63\" href=\"#__codelineno-1-63\"></a><span class=\"w\">    </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">fmt</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"bp\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kp\">&amp;</span><span class=\"nc\">mut</span><span class=\"w\"> </span><span class=\"n\">fmt</span><span class=\"p\">::</span><span class=\"n\">Formatter</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">fmt</span><span class=\"p\">::</span><span class=\"nb\">Result</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-64\"><a id=\"__codelineno-1-64\" name=\"__codelineno-1-64\" href=\"#__codelineno-1-64\"></a><span class=\"w\">        </span><span class=\"fm\">writeln!</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;===================== ENVS Loaded =====================</span><span class=\"se\">\\r\\n</span><span class=\"s\">\\</span>\n</span><span id=\"__span-1-65\"><a id=\"__codelineno-1-65\" name=\"__codelineno-1-65\" href=\"#__codelineno-1-65\"></a><span class=\"s\">        websocket_endpoint: {:?}</span><span class=\"se\">\\r\\n</span><span class=\"s\">\\</span>\n</span><span id=\"__span-1-66\"><a id=\"__codelineno-1-66\" name=\"__codelineno-1-66\" href=\"#__codelineno-1-66\"></a><span class=\"s\">        rpc endpoint:       {:?}</span><span class=\"se\">\\r\\n</span><span class=\"s\">\\</span>\n</span><span id=\"__span-1-67\"><a id=\"__codelineno-1-67\" name=\"__codelineno-1-67\" href=\"#__codelineno-1-67\"></a><span class=\"s\">        private wallet:     {:?}</span><span class=\"se\">\\r\\n</span><span class=\"s\">\\</span>\n</span><span id=\"__span-1-68\"><a id=\"__codelineno-1-68\" name=\"__codelineno-1-68\" href=\"#__codelineno-1-68\"></a><span class=\"s\">        swap amount:        {:?} sol</span><span class=\"se\">\\r\\n</span><span class=\"s\">\\</span>\n</span><span id=\"__span-1-69\"><a id=\"__codelineno-1-69\" name=\"__codelineno-1-69\" href=\"#__codelineno-1-69\"></a><span class=\"s\">        swap_priority_fee:  {:?} sol</span><span class=\"se\">\\r\\n</span><span class=\"s\">\\</span>\n</span><span id=\"__span-1-70\"><a id=\"__codelineno-1-70\" name=\"__codelineno-1-70\" href=\"#__codelineno-1-70\"></a><span class=\"s\">        total per trade:    {:?} sol</span><span class=\"se\">\\r\\n</span><span class=\"s\">\\</span>\n</span><span id=\"__span-1-71\"><a id=\"__codelineno-1-71\" name=\"__codelineno-1-71\" href=\"#__codelineno-1-71\"></a><span class=\"s\">        =====================================================&quot;</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-72\"><a id=\"__codelineno-1-72\" name=\"__codelineno-1-72\" href=\"#__codelineno-1-72\"></a><span class=\"w\">                 </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">websocket_endpoint</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-73\"><a id=\"__codelineno-1-73\" name=\"__codelineno-1-73\" href=\"#__codelineno-1-73\"></a><span class=\"w\">                 </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">rpc_endpoint</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-74\"><a id=\"__codelineno-1-74\" name=\"__codelineno-1-74\" href=\"#__codelineno-1-74\"></a><span class=\"w\">                 </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">private_key</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-75\"><a id=\"__codelineno-1-75\" name=\"__codelineno-1-75\" href=\"#__codelineno-1-75\"></a><span class=\"w\">                 </span><span class=\"n\">lamports_to_sol</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">swap_amount</span><span class=\"p\">),</span>\n</span><span id=\"__span-1-76\"><a id=\"__codelineno-1-76\" name=\"__codelineno-1-76\" href=\"#__codelineno-1-76\"></a><span class=\"w\">                 </span><span class=\"n\">lamports_to_sol</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">swap_priority_fee</span><span class=\"p\">),</span>\n</span><span id=\"__span-1-77\"><a id=\"__codelineno-1-77\" name=\"__codelineno-1-77\" href=\"#__codelineno-1-77\"></a><span class=\"w\">                 </span><span class=\"n\">lamports_to_sol</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">swap_amount</span><span class=\"p\">.</span><span class=\"n\">clone</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">swap_priority_fee</span><span class=\"p\">.</span><span class=\"n\">clone</span><span class=\"p\">())</span>\n</span><span id=\"__span-1-78\"><a id=\"__codelineno-1-78\" name=\"__codelineno-1-78\" href=\"#__codelineno-1-78\"></a><span class=\"w\">        </span><span class=\"p\">)</span>\n</span><span id=\"__span-1-79\"><a id=\"__codelineno-1-79\" name=\"__codelineno-1-79\" href=\"#__codelineno-1-79\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-80\"><a id=\"__codelineno-1-80\" name=\"__codelineno-1-80\" href=\"#__codelineno-1-80\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-1-81\"><a id=\"__codelineno-1-81\" name=\"__codelineno-1-81\" href=\"#__codelineno-1-81\"></a>\n</span><span id=\"__span-1-82\"><a id=\"__codelineno-1-82\" name=\"__codelineno-1-82\" href=\"#__codelineno-1-82\"></a><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">create_env</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">std</span><span class=\"p\">::</span><span class=\"n\">io</span><span class=\"p\">::</span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"p\">()</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-83\"><a id=\"__codelineno-1-83\" name=\"__codelineno-1-83\" href=\"#__codelineno-1-83\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">source</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;.env.dist&quot;</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-84\"><a id=\"__codelineno-1-84\" name=\"__codelineno-1-84\" href=\"#__codelineno-1-84\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">destination</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;.env&quot;</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-85\"><a id=\"__codelineno-1-85\" name=\"__codelineno-1-85\" href=\"#__codelineno-1-85\"></a>\n</span><span id=\"__span-1-86\"><a id=\"__codelineno-1-86\" name=\"__codelineno-1-86\" href=\"#__codelineno-1-86\"></a><span class=\"w\">    </span><span class=\"fm\">println!</span><span class=\"p\">(</span><span class=\"s\">&quot;Do you want to copy &#39;{}&#39; to &#39;{}&#39; (y/n)?&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">source</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">destination</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-87\"><a id=\"__codelineno-1-87\" name=\"__codelineno-1-87\" href=\"#__codelineno-1-87\"></a>\n</span><span id=\"__span-1-88\"><a id=\"__codelineno-1-88\" name=\"__codelineno-1-88\" href=\"#__codelineno-1-88\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">String</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">();</span>\n</span><span id=\"__span-1-89\"><a id=\"__codelineno-1-89\" name=\"__codelineno-1-89\" href=\"#__codelineno-1-89\"></a><span class=\"w\">    </span><span class=\"n\">io</span><span class=\"p\">::</span><span class=\"n\">stdin</span><span class=\"p\">().</span><span class=\"n\">read_line</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-90\"><a id=\"__codelineno-1-90\" name=\"__codelineno-1-90\" href=\"#__codelineno-1-90\"></a>\n</span><span id=\"__span-1-91\"><a id=\"__codelineno-1-91\" name=\"__codelineno-1-91\" href=\"#__codelineno-1-91\"></a><span class=\"w\">    </span><span class=\"c1\">// Trim input and check the response</span>\n</span><span id=\"__span-1-92\"><a id=\"__codelineno-1-92\" name=\"__codelineno-1-92\" href=\"#__codelineno-1-92\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"p\">.</span><span class=\"n\">trim</span><span class=\"p\">().</span><span class=\"n\">eq_ignore_ascii_case</span><span class=\"p\">(</span><span class=\"s\">&quot;y&quot;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-93\"><a id=\"__codelineno-1-93\" name=\"__codelineno-1-93\" href=\"#__codelineno-1-93\"></a><span class=\"w\">        </span><span class=\"c1\">// Perform the copy</span>\n</span><span id=\"__span-1-94\"><a id=\"__codelineno-1-94\" name=\"__codelineno-1-94\" href=\"#__codelineno-1-94\"></a><span class=\"w\">        </span><span class=\"n\">fs</span><span class=\"p\">::</span><span class=\"n\">copy</span><span class=\"p\">(</span><span class=\"n\">source</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">destination</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-95\"><a id=\"__codelineno-1-95\" name=\"__codelineno-1-95\" href=\"#__codelineno-1-95\"></a><span class=\"w\">        </span><span class=\"fm\">println!</span><span class=\"p\">(</span><span class=\"s\">&quot;File successfully copied to &#39;{}&#39;.&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">destination</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-96\"><a id=\"__codelineno-1-96\" name=\"__codelineno-1-96\" href=\"#__codelineno-1-96\"></a><span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-97\"><a id=\"__codelineno-1-97\" name=\"__codelineno-1-97\" href=\"#__codelineno-1-97\"></a><span class=\"w\">        </span><span class=\"fm\">println!</span><span class=\"p\">(</span><span class=\"s\">&quot;Operation canceled.&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-98\"><a id=\"__codelineno-1-98\" name=\"__codelineno-1-98\" href=\"#__codelineno-1-98\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-99\"><a id=\"__codelineno-1-99\" name=\"__codelineno-1-99\" href=\"#__codelineno-1-99\"></a>\n</span><span id=\"__span-1-100\"><a id=\"__codelineno-1-100\" name=\"__codelineno-1-100\" href=\"#__codelineno-1-100\"></a><span class=\"w\">    </span><span class=\"nb\">Ok</span><span class=\"p\">(())</span>\n</span><span id=\"__span-1-101\"><a id=\"__codelineno-1-101\" name=\"__codelineno-1-101\" href=\"#__codelineno-1-101\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-1-102\"><a id=\"__codelineno-1-102\" name=\"__codelineno-1-102\" href=\"#__codelineno-1-102\"></a>\n</span><span id=\"__span-1-103\"><a id=\"__codelineno-1-103\" name=\"__codelineno-1-103\" href=\"#__codelineno-1-103\"></a>\n</span><span id=\"__span-1-104\"><a id=\"__codelineno-1-104\" name=\"__codelineno-1-104\" href=\"#__codelineno-1-104\"></a><span class=\"c1\">// Parse LOG_LEVEL from .env to LevelFilter or default to INFO</span>\n</span><span id=\"__span-1-105\"><a id=\"__codelineno-1-105\" name=\"__codelineno-1-105\" href=\"#__codelineno-1-105\"></a><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">parse_log_level</span><span class=\"p\">(</span><span class=\"n\">log_level</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">String</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">LevelFilter</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-106\"><a id=\"__codelineno-1-106\" name=\"__codelineno-1-106\" href=\"#__codelineno-1-106\"></a><span class=\"w\">    </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">log_level</span><span class=\"p\">.</span><span class=\"n\">to_lowercase</span><span class=\"p\">().</span><span class=\"n\">as_str</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-107\"><a id=\"__codelineno-1-107\" name=\"__codelineno-1-107\" href=\"#__codelineno-1-107\"></a><span class=\"w\">        </span><span class=\"s\">&quot;off&quot;</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">LevelFilter</span><span class=\"p\">::</span><span class=\"n\">Off</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-108\"><a id=\"__codelineno-1-108\" name=\"__codelineno-1-108\" href=\"#__codelineno-1-108\"></a><span class=\"w\">        </span><span class=\"s\">&quot;error&quot;</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">LevelFilter</span><span class=\"p\">::</span><span class=\"n\">Error</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-109\"><a id=\"__codelineno-1-109\" name=\"__codelineno-1-109\" href=\"#__codelineno-1-109\"></a><span class=\"w\">        </span><span class=\"s\">&quot;warn&quot;</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">LevelFilter</span><span class=\"p\">::</span><span class=\"n\">Warn</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-110\"><a id=\"__codelineno-1-110\" name=\"__codelineno-1-110\" href=\"#__codelineno-1-110\"></a><span class=\"w\">        </span><span class=\"s\">&quot;info&quot;</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">LevelFilter</span><span class=\"p\">::</span><span class=\"n\">Info</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-111\"><a id=\"__codelineno-1-111\" name=\"__codelineno-1-111\" href=\"#__codelineno-1-111\"></a><span class=\"w\">        </span><span class=\"s\">&quot;debug&quot;</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">LevelFilter</span><span class=\"p\">::</span><span class=\"n\">Debug</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-112\"><a id=\"__codelineno-1-112\" name=\"__codelineno-1-112\" href=\"#__codelineno-1-112\"></a><span class=\"w\">        </span><span class=\"s\">&quot;trace&quot;</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">LevelFilter</span><span class=\"p\">::</span><span class=\"n\">Trace</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-113\"><a id=\"__codelineno-1-113\" name=\"__codelineno-1-113\" href=\"#__codelineno-1-113\"></a><span class=\"w\">        </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">LevelFilter</span><span class=\"p\">::</span><span class=\"n\">Info</span><span class=\"w\"> </span><span class=\"c1\">// defaults to info, if wrong loglevel given</span>\n</span><span id=\"__span-1-114\"><a id=\"__codelineno-1-114\" name=\"__codelineno-1-114\" href=\"#__codelineno-1-114\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-115\"><a id=\"__codelineno-1-115\" name=\"__codelineno-1-115\" href=\"#__codelineno-1-115\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Inside Utils/src/env/env.rs we added this new method inside impl:</p>\n</div>\n<p><div class=\"language-rust highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">setup_logger</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-2-2\"><a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">EnvBuilder</span><span class=\"p\">::</span><span class=\"n\">default</span><span class=\"p\">();</span>\n</span><span id=\"__span-2-3\"><a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"w\">         </span><span class=\"n\">Builder</span><span class=\"p\">::</span><span class=\"n\">from_env</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">)</span>\n</span><span id=\"__span-2-4\"><a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"w\">            </span><span class=\"p\">.</span><span class=\"n\">filter_level</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">loglevel</span><span class=\"p\">)</span>\n</span><span id=\"__span-2-5\"><a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"w\">            </span><span class=\"p\">.</span><span class=\"n\">format_level</span><span class=\"p\">(</span><span class=\"kc\">false</span><span class=\"p\">)</span>\n</span><span id=\"__span-2-6\"><a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"w\">            </span><span class=\"p\">.</span><span class=\"n\">format_timestamp_millis</span><span class=\"p\">()</span>\n</span><span id=\"__span-2-7\"><a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a><span class=\"w\">            </span><span class=\"p\">.</span><span class=\"n\">init</span><span class=\"p\">();</span>\n</span><span id=\"__span-2-8\"><a id=\"__codelineno-2-8\" name=\"__codelineno-2-8\" href=\"#__codelineno-2-8\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\nHere, we simply initialize the <code>env_logger</code>, set the log level from our <code>.env</code> file, and configure it to display timestamps in milliseconds. For other ways to customize the standard logging format, refer to the `env_logger <a href=\"https://docs.rs/env_logger/latest/env_logger/#tweaking-the-default-format\">documentation here</a>.</p>\n<p>The <code>&amp;self</code> keyword indicates that this is now a callable method within our <code>env</code> struct.</p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Finally update main.rs in sniper/srv/mains.rs to:</p>\n</div>\n<div class=\"language-rust highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">utils</span><span class=\"p\">::</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">Env</span><span class=\"p\">;</span>\n</span><span id=\"__span-3-2\"><a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a>\n</span><span id=\"__span-3-3\"><a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a><span class=\"cp\">#[tokio::main]</span>\n</span><span id=\"__span-3-4\"><a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-5\"><a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\" href=\"#__codelineno-3-5\"></a><span class=\"w\">    </span><span class=\"cm\">/* Load in ENV from .env, or suggest creating from .env.dist */</span>\n</span><span id=\"__span-3-6\"><a id=\"__codelineno-3-6\" name=\"__codelineno-3-6\" href=\"#__codelineno-3-6\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Env</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">().</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n</span><span id=\"__span-3-7\"><a id=\"__codelineno-3-7\" name=\"__codelineno-3-7\" href=\"#__codelineno-3-7\"></a><span class=\"w\">    </span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">setup_logger</span><span class=\"p\">();</span>\n</span><span id=\"__span-3-8\"><a id=\"__codelineno-3-8\" name=\"__codelineno-3-8\" href=\"#__codelineno-3-8\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>With that in place, we call <code>setup_logger</code> to change the standard logging format, and we will now see logs with millisecond precision. We can use the <code>debug!</code>, <code>info!</code>, <code>warn!</code>, and <code>error!</code> macros to specify log levels when logging events or the state of parts of our program.</p>\n<h2 id=\"subscribing-to-raydium-events\">Subscribing to Raydium events</h2>\n<p>To listen for all new tokens created on Raydium, we first need to understand a few concepts.</p>\n<h2 id=\"amm\">AMM</h2>\n<p>When we refer to a new token on Raydium, we are actually talking about a new liquidity AMM (Automated Market Maker) pool. For regular token swapping on Raydium, it is common practice to use their comprehensive main JSON file, which contains account addresses for all tokens. This file is updated several times a day and exceeds 500 MB in size. However, for sniping, this approach is not viable due to its size and update frequency. Instead, we need to find an alternative way to collect token addresses within the first few ms after a new token is released.</p>\n<p>An AMM pool is paired with either SOL or USDC for trading. This is why new tokens often appear as <code>&lt;token&gt;/WSOL</code> or <code>&lt;token&gt;/USDC</code> on platforms like Dexscreener. `WSOL refers to wrapped SOL, which is necessary for using SOL in swaps. This wrapping process allows SOL to be compatible with the SPL token standard used by Solana. However, this logic is often abstracted away, so users may not need to handle wrapping directly.</p>\n<h2 id=\"transactions\">Transactions</h2>\n<p>In Solana, transactions are the process of transferring tokens or interacting with smart contracts on the blockchain. Each transaction consists of one or more instructions that are executed on the network. Solana\u2019s high throughput is achieved through its Proof of History (PoH) consensus mechanism, which timestamps and orders transactions. Transactions are processed in parallel, allowing for faster confirmation times. A typical transaction includes a fee paid to validators, a signature from the sender, and updates to accounts or smart contracts. Solana\u2019s scalability ensures transactions are processed quickly and efficiently.</p>\n<p>For our sniper, this is essential knowlede as we listen for interactions with Raydium\u2019s smart contract, specifically the <code>initialize2</code> event, which is triggered when a new liquidity pool is created.</p>\n<h2 id=\"commitment-levels\">Commitment Levels</h2>\n<p>In Solana, commitment levels represent different stages in the transaction lifecycle. At the \u2018processed\u2019 level, a transaction is received by the network and the leader is proposing that given transaction along with others in a block, which typically takes from 10 ms to 3 seconds, depending on network congestion. Then, if the transaction matches the smart contract(s) it\u2019s interacting with and has the required funds for its actions, it will be confirmed. Finally, the transaction reaches the \u2018finalized\u2019 stage once the leader and corresponding voters have processed the block containing the transaction.</p>\n<h2 id=\"websocket-subscriber\">Websocket subscriber</h2>\n<p>Now with a few basics under our belt, lets go ahead and create our websocket subscriber.</p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Create the file sniper/src/oracle/websocket.rs</p>\n</div>\n<div class=\"language-rust highlight\"><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">sync</span><span class=\"p\">::</span><span class=\"n\">Arc</span><span class=\"p\">;</span>\n</span><span id=\"__span-4-2\"><a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">solana_client</span><span class=\"p\">::{</span>\n</span><span id=\"__span-4-3\"><a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a><span class=\"w\">    </span><span class=\"n\">nonblocking</span><span class=\"p\">::</span><span class=\"n\">pubsub_client</span><span class=\"p\">::</span><span class=\"n\">PubsubClient</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-4\"><a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a><span class=\"w\">    </span><span class=\"n\">rpc_config</span><span class=\"p\">::{</span><span class=\"n\">RpcTransactionLogsConfig</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RpcTransactionLogsFilter</span><span class=\"p\">},</span>\n</span><span id=\"__span-4-5\"><a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\" href=\"#__codelineno-4-5\"></a><span class=\"p\">};</span>\n</span><span id=\"__span-4-6\"><a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\" href=\"#__codelineno-4-6\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">solana_sdk</span><span class=\"p\">::</span><span class=\"n\">commitment_config</span><span class=\"p\">::{</span><span class=\"n\">CommitmentConfig</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">CommitmentLevel</span><span class=\"p\">};</span>\n</span><span id=\"__span-4-7\"><a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\" href=\"#__codelineno-4-7\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">futures</span><span class=\"p\">::</span><span class=\"n\">StreamExt</span><span class=\"p\">;</span>\n</span><span id=\"__span-4-8\"><a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\" href=\"#__codelineno-4-8\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"p\">::</span><span class=\"n\">info</span><span class=\"p\">;</span>\n</span><span id=\"__span-4-9\"><a id=\"__codelineno-4-9\" name=\"__codelineno-4-9\" href=\"#__codelineno-4-9\"></a>\n</span><span id=\"__span-4-10\"><a id=\"__codelineno-4-10\" name=\"__codelineno-4-10\" href=\"#__codelineno-4-10\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">SolanaSubscriber</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-11\"><a id=\"__codelineno-4-11\" name=\"__codelineno-4-11\" href=\"#__codelineno-4-11\"></a><span class=\"w\">    </span><span class=\"n\">client</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">PubsubClient</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-12\"><a id=\"__codelineno-4-12\" name=\"__codelineno-4-12\" href=\"#__codelineno-4-12\"></a><span class=\"w\">    </span><span class=\"n\">config_level</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">CommitmentConfig</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-13\"><a id=\"__codelineno-4-13\" name=\"__codelineno-4-13\" href=\"#__codelineno-4-13\"></a><span class=\"w\">    </span><span class=\"n\">subscribe_to</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"nb\">String</span><span class=\"o\">&gt;</span>\n</span><span id=\"__span-4-14\"><a id=\"__codelineno-4-14\" name=\"__codelineno-4-14\" href=\"#__codelineno-4-14\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-4-15\"><a id=\"__codelineno-4-15\" name=\"__codelineno-4-15\" href=\"#__codelineno-4-15\"></a>\n</span><span id=\"__span-4-16\"><a id=\"__codelineno-4-16\" name=\"__codelineno-4-16\" href=\"#__codelineno-4-16\"></a>\n</span><span id=\"__span-4-17\"><a id=\"__codelineno-4-17\" name=\"__codelineno-4-17\" href=\"#__codelineno-4-17\"></a><span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">SolanaSubscriber</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-18\"><a id=\"__codelineno-4-18\" name=\"__codelineno-4-18\" href=\"#__codelineno-4-18\"></a><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">new</span><span class=\"p\">(</span><span class=\"n\">ws_url</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Arc</span><span class=\"o\">&lt;</span><span class=\"nb\">String</span><span class=\"o\">&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">config_level</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">CommitmentConfig</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">subscribe_to</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"nb\">String</span><span class=\"o\">&gt;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">Self</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-19\"><a id=\"__codelineno-4-19\" name=\"__codelineno-4-19\" href=\"#__codelineno-4-19\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">PubsubClient</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">ws_url</span><span class=\"p\">.</span><span class=\"n\">clone</span><span class=\"p\">().</span><span class=\"n\">as_str</span><span class=\"p\">())</span>\n</span><span id=\"__span-4-20\"><a id=\"__codelineno-4-20\" name=\"__codelineno-4-20\" href=\"#__codelineno-4-20\"></a><span class=\"w\">            </span><span class=\"p\">.</span><span class=\"k\">await</span>\n</span><span id=\"__span-4-21\"><a id=\"__codelineno-4-21\" name=\"__codelineno-4-21\" href=\"#__codelineno-4-21\"></a><span class=\"w\">            </span><span class=\"p\">.</span><span class=\"n\">expect</span><span class=\"p\">(</span><span class=\"fm\">format!</span><span class=\"p\">(</span><span class=\"s\">&quot;Failed to connect to {}&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ws_url</span><span class=\"p\">).</span><span class=\"n\">as_str</span><span class=\"p\">());</span>\n</span><span id=\"__span-4-22\"><a id=\"__codelineno-4-22\" name=\"__codelineno-4-22\" href=\"#__codelineno-4-22\"></a>\n</span><span id=\"__span-4-23\"><a id=\"__codelineno-4-23\" name=\"__codelineno-4-23\" href=\"#__codelineno-4-23\"></a><span class=\"w\">        </span><span class=\"n\">SolanaSubscriber</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-24\"><a id=\"__codelineno-4-24\" name=\"__codelineno-4-24\" href=\"#__codelineno-4-24\"></a><span class=\"w\">            </span><span class=\"n\">client</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-25\"><a id=\"__codelineno-4-25\" name=\"__codelineno-4-25\" href=\"#__codelineno-4-25\"></a><span class=\"w\">            </span><span class=\"n\">config_level</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-26\"><a id=\"__codelineno-4-26\" name=\"__codelineno-4-26\" href=\"#__codelineno-4-26\"></a><span class=\"w\">            </span><span class=\"n\">subscribe_to</span>\n</span><span id=\"__span-4-27\"><a id=\"__codelineno-4-27\" name=\"__codelineno-4-27\" href=\"#__codelineno-4-27\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n</span><span id=\"__span-4-28\"><a id=\"__codelineno-4-28\" name=\"__codelineno-4-28\" href=\"#__codelineno-4-28\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-4-29\"><a id=\"__codelineno-4-29\" name=\"__codelineno-4-29\" href=\"#__codelineno-4-29\"></a>\n</span><span id=\"__span-4-30\"><a id=\"__codelineno-4-30\" name=\"__codelineno-4-30\" href=\"#__codelineno-4-30\"></a><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">start_thread</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-31\"><a id=\"__codelineno-4-31\" name=\"__codelineno-4-31\" href=\"#__codelineno-4-31\"></a><span class=\"w\">        </span><span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">&quot;Starting Solana websocket subscriber&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-32\"><a id=\"__codelineno-4-32\" name=\"__codelineno-4-32\" href=\"#__codelineno-4-32\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">subscribe_to</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">subscribe_to</span><span class=\"p\">.</span><span class=\"n\">clone</span><span class=\"p\">();</span>\n</span><span id=\"__span-4-33\"><a id=\"__codelineno-4-33\" name=\"__codelineno-4-33\" href=\"#__codelineno-4-33\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">config_level</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">config_level</span><span class=\"p\">.</span><span class=\"n\">clone</span><span class=\"p\">();</span>\n</span><span id=\"__span-4-34\"><a id=\"__codelineno-4-34\" name=\"__codelineno-4-34\" href=\"#__codelineno-4-34\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">stream</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">client</span><span class=\"p\">.</span><span class=\"n\">logs_subscribe</span><span class=\"p\">(</span>\n</span><span id=\"__span-4-35\"><a id=\"__codelineno-4-35\" name=\"__codelineno-4-35\" href=\"#__codelineno-4-35\"></a><span class=\"w\">            </span><span class=\"n\">RpcTransactionLogsFilter</span><span class=\"p\">::</span><span class=\"n\">Mentions</span><span class=\"p\">(</span>\n</span><span id=\"__span-4-36\"><a id=\"__codelineno-4-36\" name=\"__codelineno-4-36\" href=\"#__codelineno-4-36\"></a><span class=\"w\">                </span><span class=\"n\">subscribe_to</span>\n</span><span id=\"__span-4-37\"><a id=\"__codelineno-4-37\" name=\"__codelineno-4-37\" href=\"#__codelineno-4-37\"></a><span class=\"w\">            </span><span class=\"p\">),</span>\n</span><span id=\"__span-4-38\"><a id=\"__codelineno-4-38\" name=\"__codelineno-4-38\" href=\"#__codelineno-4-38\"></a><span class=\"w\">            </span><span class=\"n\">RpcTransactionLogsConfig</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-39\"><a id=\"__codelineno-4-39\" name=\"__codelineno-4-39\" href=\"#__codelineno-4-39\"></a><span class=\"w\">                </span><span class=\"n\">commitment</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"n\">config_level</span><span class=\"p\">),</span>\n</span><span id=\"__span-4-40\"><a id=\"__codelineno-4-40\" name=\"__codelineno-4-40\" href=\"#__codelineno-4-40\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n</span><span id=\"__span-4-41\"><a id=\"__codelineno-4-41\" name=\"__codelineno-4-41\" href=\"#__codelineno-4-41\"></a><span class=\"w\">        </span><span class=\"p\">).</span><span class=\"k\">await</span><span class=\"p\">.</span><span class=\"n\">expect</span><span class=\"p\">(</span><span class=\"s\">&quot;Failed to subscribe to Logs!&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-42\"><a id=\"__codelineno-4-42\" name=\"__codelineno-4-42\" href=\"#__codelineno-4-42\"></a>\n</span><span id=\"__span-4-43\"><a id=\"__codelineno-4-43\" name=\"__codelineno-4-43\" href=\"#__codelineno-4-43\"></a><span class=\"w\">        </span><span class=\"k\">loop</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-44\"><a id=\"__codelineno-4-44\" name=\"__codelineno-4-44\" href=\"#__codelineno-4-44\"></a><span class=\"w\">            </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">stream</span><span class=\"p\">.</span><span class=\"n\">next</span><span class=\"p\">().</span><span class=\"k\">await</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-45\"><a id=\"__codelineno-4-45\" name=\"__codelineno-4-45\" href=\"#__codelineno-4-45\"></a>\n</span><span id=\"__span-4-46\"><a id=\"__codelineno-4-46\" name=\"__codelineno-4-46\" href=\"#__codelineno-4-46\"></a><span class=\"w\">                </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">response</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">.</span><span class=\"n\">logs</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-47\"><a id=\"__codelineno-4-47\" name=\"__codelineno-4-47\" href=\"#__codelineno-4-47\"></a><span class=\"w\">                    </span><span class=\"cm\">/* skip all events that does not contain initialize2 eg token create */</span>\n</span><span id=\"__span-4-48\"><a id=\"__codelineno-4-48\" name=\"__codelineno-4-48\" href=\"#__codelineno-4-48\"></a><span class=\"w\">                    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">!</span><span class=\"n\">log</span><span class=\"p\">.</span><span class=\"n\">contains</span><span class=\"p\">(</span><span class=\"s\">&quot;initialize2&quot;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-49\"><a id=\"__codelineno-4-49\" name=\"__codelineno-4-49\" href=\"#__codelineno-4-49\"></a><span class=\"w\">                        </span><span class=\"k\">continue</span>\n</span><span id=\"__span-4-50\"><a id=\"__codelineno-4-50\" name=\"__codelineno-4-50\" href=\"#__codelineno-4-50\"></a><span class=\"w\">                    </span><span class=\"p\">}</span>\n</span><span id=\"__span-4-51\"><a id=\"__codelineno-4-51\" name=\"__codelineno-4-51\" href=\"#__codelineno-4-51\"></a><span class=\"w\">                    </span><span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">&quot;Received tx https://solscan.io/tx/{}&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">response</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">.</span><span class=\"n\">signature</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-52\"><a id=\"__codelineno-4-52\" name=\"__codelineno-4-52\" href=\"#__codelineno-4-52\"></a><span class=\"w\">                </span><span class=\"p\">}</span>\n</span><span id=\"__span-4-53\"><a id=\"__codelineno-4-53\" name=\"__codelineno-4-53\" href=\"#__codelineno-4-53\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n</span><span id=\"__span-4-54\"><a id=\"__codelineno-4-54\" name=\"__codelineno-4-54\" href=\"#__codelineno-4-54\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n</span><span id=\"__span-4-55\"><a id=\"__codelineno-4-55\" name=\"__codelineno-4-55\" href=\"#__codelineno-4-55\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-4-56\"><a id=\"__codelineno-4-56\" name=\"__codelineno-4-56\" href=\"#__codelineno-4-56\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Update sniper/src/main.rs</p>\n</div>\n<div class=\"language-rust highlight\"><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"k\">mod</span><span class=\"w\"> </span><span class=\"nn\">oracle</span><span class=\"p\">;</span>\n</span><span id=\"__span-5-2\"><a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">solana_sdk</span><span class=\"p\">::</span><span class=\"n\">commitment_config</span><span class=\"p\">::</span><span class=\"n\">CommitmentConfig</span><span class=\"p\">;</span>\n</span><span id=\"__span-5-3\"><a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">utils</span><span class=\"p\">::</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">Env</span><span class=\"p\">;</span>\n</span><span id=\"__span-5-4\"><a id=\"__codelineno-5-4\" name=\"__codelineno-5-4\" href=\"#__codelineno-5-4\"></a>\n</span><span id=\"__span-5-5\"><a id=\"__codelineno-5-5\" name=\"__codelineno-5-5\" href=\"#__codelineno-5-5\"></a><span class=\"cp\">#[tokio::main]</span>\n</span><span id=\"__span-5-6\"><a id=\"__codelineno-5-6\" name=\"__codelineno-5-6\" href=\"#__codelineno-5-6\"></a><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-5-7\"><a id=\"__codelineno-5-7\" name=\"__codelineno-5-7\" href=\"#__codelineno-5-7\"></a><span class=\"w\">    </span><span class=\"cm\">/* Load in ENV from .env, or suggest creating from .env.dist */</span>\n</span><span id=\"__span-5-8\"><a id=\"__codelineno-5-8\" name=\"__codelineno-5-8\" href=\"#__codelineno-5-8\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Env</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">().</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n</span><span id=\"__span-5-9\"><a id=\"__codelineno-5-9\" name=\"__codelineno-5-9\" href=\"#__codelineno-5-9\"></a><span class=\"w\">    </span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">setup_logger</span><span class=\"p\">();</span>\n</span><span id=\"__span-5-10\"><a id=\"__codelineno-5-10\" name=\"__codelineno-5-10\" href=\"#__codelineno-5-10\"></a>\n</span><span id=\"__span-5-11\"><a id=\"__codelineno-5-11\" name=\"__codelineno-5-11\" href=\"#__codelineno-5-11\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">subscribe_to_raydium</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"fm\">vec!</span><span class=\"p\">[</span>\n</span><span id=\"__span-5-12\"><a id=\"__codelineno-5-12\" name=\"__codelineno-5-12\" href=\"#__codelineno-5-12\"></a><span class=\"w\">        </span><span class=\"s\">&quot;675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8&quot;</span><span class=\"p\">.</span><span class=\"n\">to_string</span><span class=\"p\">()</span>\n</span><span id=\"__span-5-13\"><a id=\"__codelineno-5-13\" name=\"__codelineno-5-13\" href=\"#__codelineno-5-13\"></a><span class=\"w\">    </span><span class=\"p\">];</span>\n</span><span id=\"__span-5-14\"><a id=\"__codelineno-5-14\" name=\"__codelineno-5-14\" href=\"#__codelineno-5-14\"></a>\n</span><span id=\"__span-5-15\"><a id=\"__codelineno-5-15\" name=\"__codelineno-5-15\" href=\"#__codelineno-5-15\"></a><span class=\"w\">    </span><span class=\"cm\">/* Listen for all events regarding Raydium */</span>\n</span><span id=\"__span-5-16\"><a id=\"__codelineno-5-16\" name=\"__codelineno-5-16\" href=\"#__codelineno-5-16\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">subscriber</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">oracle</span><span class=\"p\">::</span><span class=\"n\">websocket</span><span class=\"p\">::</span><span class=\"n\">SolanaSubscriber</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span>\n</span><span id=\"__span-5-17\"><a id=\"__codelineno-5-17\" name=\"__codelineno-5-17\" href=\"#__codelineno-5-17\"></a><span class=\"w\">        </span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">websocket_endpoint</span><span class=\"p\">.</span><span class=\"n\">clone</span><span class=\"p\">(),</span>\n</span><span id=\"__span-5-18\"><a id=\"__codelineno-5-18\" name=\"__codelineno-5-18\" href=\"#__codelineno-5-18\"></a><span class=\"w\">        </span><span class=\"n\">CommitmentConfig</span><span class=\"p\">::</span><span class=\"n\">processed</span><span class=\"p\">(),</span>\n</span><span id=\"__span-5-19\"><a id=\"__codelineno-5-19\" name=\"__codelineno-5-19\" href=\"#__codelineno-5-19\"></a><span class=\"w\">        </span><span class=\"n\">subscribe_to_raydium</span>\n</span><span id=\"__span-5-20\"><a id=\"__codelineno-5-20\" name=\"__codelineno-5-20\" href=\"#__codelineno-5-20\"></a><span class=\"w\">    </span><span class=\"p\">).</span><span class=\"k\">await</span><span class=\"p\">;</span>\n</span><span id=\"__span-5-21\"><a id=\"__codelineno-5-21\" name=\"__codelineno-5-21\" href=\"#__codelineno-5-21\"></a>\n</span><span id=\"__span-5-22\"><a id=\"__codelineno-5-22\" name=\"__codelineno-5-22\" href=\"#__codelineno-5-22\"></a><span class=\"w\">    </span><span class=\"n\">subscriber</span><span class=\"p\">.</span><span class=\"n\">start_thread</span><span class=\"p\">().</span><span class=\"k\">await</span><span class=\"p\">;</span>\n</span><span id=\"__span-5-23\"><a id=\"__codelineno-5-23\" name=\"__codelineno-5-23\" href=\"#__codelineno-5-23\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">create sniper/src/oracle/mod.rs</p>\n</div>\n<div class=\"language-rust highlight\"><pre><span></span><code><span id=\"__span-6-1\"><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">mod</span><span class=\"w\"> </span><span class=\"nn\">websocket</span><span class=\"p\">;</span>\n</span></code></pre></div>\n<p>A lot happened here, so let\u2019s break it down and go over it bit by bit.</p>\n<p>In <code>sniper/src/oracle/websocket.rs</code>, we created a new struct called <code>SolanaSubscriber</code>. In the <code>new</code> method, we simply check whether we can connect to the WSS endpoint from the <code>.env</code> file, or throw an error if that\u2019s not the case. Also, note that in <code>new</code>, we use <code>solana_client::nonblocking::pubsub_client::PubsubClient</code>, where <code>nonblocking</code> is crucial. To maintain speed with many moving parts in our software, we avoid any render-blocking code that could compromise performance and introduce unnecessary delays. Sniping is most efficient down to the millisecond.</p>\n<p>If we make it past <code>::new</code>, we are good to go and ready to boot up our WebSocket subscriber.</p>\n<p>Inside the <code>start_thread</code> method, we create a new stream inside a loop that runs indefinitely, keeping our program active until we send an exit signal, such as pressing <code>Ctrl + C</code>. This stream is initialized with <code>subscribe_to</code>, where we provide it the address <code>675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8</code>, the AMM v4 (OpenBook) smart contract address, along with the commitment level 'processed'. This is the earliest stage at which we can discover a new token, but it\u2019s also the most unstable. We might attempt to swap against a token that never actually exists due to issues like an incorrectly filled smart contract, a missing Serum order book, insufficient funds, timeouts, or other problems. We also parse each log received from our subscriber and check if it contains <code>initialize2</code>. While <code>675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8</code> is a legacy address, it is still widely used. Towards the end of this series, we will explore how to use the newest contract to make the sniper future-compatible.</p>\n<figure>\n<p><img alt=\"Terminal output of a running Solana websocket in our program\" src=\"/static/raydium_sniper_part_2/Screenshot 2025-01-09 at 02.30.16.png\" /></p>\n<figcaption>\n<p>Terminal output of a running Solana websocket in our program</p>\n</figcaption>\n</figure>\n<p><a href=\"https://solscan.io/tx/7RKF411YTojKv51Yq25ivqnj3HYz2MriNj47bFy73B83RSxrwoUupjWptntf7XKpQSBsGYLrQxcefnBEKsfpoRj\">https://solscan.io/tx/7RKF411YTojKv51Yq25ivqnj3HYz2MriNj47bFy73B83RSxrwoUupjWptntf7XKpQSBsGYLrQxcefnBEKsfpoRj</a>\n<a href=\"https://solscan.io/tx/5JCD9rtXWiHsRCKbNReBcaA7nFVvaaELXkdcSrb6j1U4jYyarG8akVSqPjErq6dGRwmx2USD4zGESrPf7a6dh2R\">https://solscan.io/tx/5JCD9rtXWiHsRCKbNReBcaA7nFVvaaELXkdcSrb6j1U4jYyarG8akVSqPjErq6dGRwmx2USD4zGESrPf7a6dh2R</a>\n<a href=\"https://solscan.io/tx/4R4vFQAKPapyWUF2khE8Wwe3q75LiyCipa1tJVtshFvVpMWiFjhNmZa9QYribAgRd9zetYnv4zzLvmUACfg4efQf\">https://solscan.io/tx/4R4vFQAKPapyWUF2khE8Wwe3q75LiyCipa1tJVtshFvVpMWiFjhNmZa9QYribAgRd9zetYnv4zzLvmUACfg4efQf</a>\n<a href=\"https://solscan.io/tx/Xb2VHwfmHRANsNzsSWXsDyVKw2rdUyg1owvSLGN9GfHNZJZ4VzFWfQEqKt7LD2e2JS5gsuNafNDzNtYkJpPSmG5\">https://solscan.io/tx/Xb2VHwfmHRANsNzsSWXsDyVKw2rdUyg1owvSLGN9GfHNZJZ4VzFWfQEqKt7LD2e2JS5gsuNafNDzNtYkJpPSmG5</a></p>\n<h2 id=\"setting-up-on-a-linode-server\">Setting up on a Linode server</h2>\n<p>Note that the setup script provided below is not production-ready. You should, at the very least, restrict access to the server to only your own IP address and use an ECDSA or RSA key for security. If you do not have experience with server operations, you should consult an expert. The script provided is intended only as a quick starting point for testing in an environment that is close to optimized.</p>\n<p>I choose Linode because they offer 30GPS internet speed and competitive priced cloud resources, you can also get started with Linode at $100 credit, to try it out.</p>\n<figure>\n<p><img alt=\"Linode starting a VPS\" src=\"/static/raydium_sniper_part_2/Screenshot 2025-01-09 at 03.00.43.png\" /></p>\n<figcaption>\n<p>Linode starting a VPS</p>\n</figcaption>\n</figure>\n<figure>\n<p><img alt=\"Linode starting a VPS\" src=\"/static/raydium_sniper_part_2/Screenshot 2025-01-09 at 03.02.56.png\" /></p>\n<figcaption>\n<p>Linode starting a VPS</p>\n</figcaption>\n</figure>\n<figure>\n<p><img alt=\"Linode starting a VPS\" src=\"/static/raydium_sniper_part_2/Screenshot 2025-01-09 at 03.03.30.png\" /></p>\n<figcaption>\n<p>Linode starting a VPS</p>\n</figcaption>\n</figure>\n<p>Choose a premium CPU; you do not want to share CPU cores with other instances, as this can degrade performance, especially when sniping. As for the location, I chose it because it is close to Helius.dev\u2019s staked validator, which we will use later on with a staked connection. Other considerations include proximity to a Cloudflare endpoint, as most providers set up their WSS and RPC endpoints to proxy through Cloudflare for better security.</p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">ssh into your server and run the prepare_linode.sh</p>\n</div>\n<div class=\"language-bash highlight\"><pre><span></span><code><span id=\"__span-7-1\"><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a><span class=\"c1\"># Clone the project to get started</span>\n</span><span id=\"__span-7-2\"><a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a>git<span class=\"w\"> </span>clone<span class=\"w\"> </span>https://github.com/weestack/Solana-Sniper.git\n</span><span id=\"__span-7-3\"><a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a><span class=\"nb\">cd</span><span class=\"w\"> </span>Solana-Sniper\n</span><span id=\"__span-7-4\"><a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a>bash<span class=\"w\"> </span>prepare_linode.sh\n</span><span id=\"__span-7-5\"><a id=\"__codelineno-7-5\" name=\"__codelineno-7-5\" href=\"#__codelineno-7-5\"></a><span class=\"nb\">source</span><span class=\"w\"> </span>~/.bashrc\n</span></code></pre></div>\n<p>Running <code>bash prepare_linode.sh</code> will install Rust and <code>protoc</code>, which are required. It also replaces the nameserver in <code>resolv.conf</code> with Cloudflare's for lower network latency.</p>\n<p>when asked which installation type, as the screenshot below, use 1 eg default:</p>\n<figure>\n<p><img alt=\"Accepting default rust installation\" src=\"/static/raydium_sniper_part_2/Screenshot 2025-01-09 at 03.22.25.png\" /></p>\n<figcaption>\n<p>Accepting default rust installation</p>\n</figcaption>\n</figure>\n<p>Now run the below to build the sniper and run it:</p>\n<div class=\"language-bash highlight\"><pre><span></span><code><span id=\"__span-8-1\"><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a><span class=\"c1\"># note if you meet an issue about cargo not existing, run source ~/.bashrc</span>\n</span><span id=\"__span-8-2\"><a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a>cargo<span class=\"w\"> </span>build<span class=\"w\"> </span>--release\n</span><span id=\"__span-8-3\"><a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a><span class=\"c1\"># Run the sniper</span>\n</span><span id=\"__span-8-4\"><a id=\"__codelineno-8-4\" name=\"__codelineno-8-4\" href=\"#__codelineno-8-4\"></a>./target/release/sniper\n</span></code></pre></div>\n<h2 id=\"websocket-comparison\">Websocket comparison</h2>\n<p>For this series, I have compared <a href=\"https://refer.quicknode.com/?via=alexander-hogh\">QuickNode</a> against <a href=\"https://helius.dev\">Helius.dev</a>, both efficient providers in Solana RPC and WSS.</p>\n<figure>\n<p><img alt=\"Helius.dev results\" src=\"/static/raydium_sniper_part_2/Screenshot 2025-01-09 at 03.48.23.png\" /></p>\n<figcaption>\n<p>Helius.dev results</p>\n</figcaption>\n</figure>\n<p>[2025\u201301\u201309T02:38:40.223Z sniper::oracle::websocket]\n[2025\u201301\u201309T02:39:59.082Z sniper::oracle::websocket]\n[2025\u201301\u201309T02:40:12.299Z sniper::oracle::websocket]</p>\n<figure>\n<p><img alt=\"Quicknode results\" src=\"/static/raydium_sniper_part_2/Screenshot 2025-01-09 at 03.49.08.png\" /></p>\n<figcaption>\n<p>Quicknode results</p>\n</figcaption>\n</figure>\n<p>[2025\u201301\u201309T02:38:40.546Z sniper::oracle::websocket]\n[2025\u201301\u201309T02:39:59.333Z sniper::oracle::websocket]\n[2025\u201301\u201309T02:40:12.424Z sniper::oracle::websocket]</p>\n<p>In the first transaction, Helius was 323ms faster than Quicknode.\nIn the second transaction, Helius was 251ms faster than Quicknode.\nIn the third transaction, Helius was 125ms faster than Quicknode.</p>\n<p>For the purpose of building an efficient sniper, we will use Helius. However, this is not because their WSS endpoint is faster. To gain a top position, we won\u2019t even be using helius.dev\u2019s WSS endpoint; instead, we will only use their staked RPC endpoint, which costs $49 a month with the developer plan. More about that later.</p>\n<p>Does the above result mean that Helius.dev is superior to QuickNode? Absolutely not. This was just a quick comparison. Staying ahead of the network is not an easy task, and both providers excel at it. In addition to simple WSS and RPC endpoints, QuickNode also offers a wide range of different API endpoints and services for Solana that would definitely be handy for any Solana developer. Both providers excel in different areas of providing Solana services.</p>\n<h2 id=\"up-next\">Up next</h2>\n<p>In the next article, we\u2019ll dive deeper into Solana transactions and extract the necessary accounts to perform swapping. Thanks for reading this tutorial! Don\u2019t forget to subscribe so you won\u2019t miss the next part of the series.</p>\n<h2 id=\"disclaimer\">Disclaimer</h2>\n<p>The information provided in this series of articles is for educational purposes only and should not be considered financial or investment advice. Trading, including sniping tokens, carries significant risks, and there is no guarantee of profit.</p>\n<p>Any decisions you make based on the content shared here are solely your responsibility. I am not liable for any financial losses incurred as a result of implementing the strategies, code, or techniques discussed in these articles.</p>\n<p>Always trade responsibly. Never risk more money than you can afford to lose. It is essential to conduct your own research and consult with a professional financial advisor if necessary before engaging in any trading activities.</p>", "image": null, "date_modified": "2025-02-06T13:06:57+00:00", "authors": [{"name": "Alexander H\u00f8gh"}], "tags": ["Solana", "Solana Sniper"]}, {"id": "https://helius.dk/blog/2025/01/20/writing-a-raydium-sniper-in-rust-part-3/", "url": "https://helius.dk/blog/2025/01/20/writing-a-raydium-sniper-in-rust-part-3/", "title": "Writing a Raydium sniper in Rust part 3", "content_html": "<p><img alt=\"AI generated image of a friendly humanoid bot\" src=\"/static/raydium_sniper_part_3/solana_scanner.png\" /></p>\n<h1 id=\"writing-a-raydium-sniper-in-rust-part-3\">Writing a Raydium sniper in Rust part 3</h1>\n<p>This is part three of this series, where we are creating a Solana sniper bot for Raydium from scratch in Rust. See the first post here which includes an introduction about why we use a compiled language instead of JavaScript, as well as prerequisites and a brief introduction about me. You can find the latest <a href=\"https://github.com/weestack/Solana-Sniper\">GitHub source here</a>, which will be updated with each new post.</p>\n<!-- more -->\n\n<h2 id=\"disclaimer\">Disclaimer</h2>\n<p>The information provided in this series of articles is for educational purposes only and should not be considered financial or investment advice. Trading, including sniping tokens, carries significant risks, and there is no guarantee of profit.</p>\n<p>Any decisions you make based on the content shared here are solely your responsibility. I am not liable for any financial losses incurred as a result of implementing the strategies, code, or techniques discussed in these articles.</p>\n<p>Always trade responsibly. Never risk more money than you can afford to lose. It is essential to conduct your own research and consult with a professional financial advisor if necessary before engaging in any trading activities.</p>\n<h2 id=\"what-to-expect-today\">What to expect today</h2>\n<p>Last time, we implemented a websocket watcher that monitors any Raydium `initialize2 transactions. These transactions occur when a new token is minted, making them suitable for sniping.</p>\n<p>Today, we will explore swap transactions, initialize transactions, and how to extract the information necessary for sniping a token.</p>\n<p>Apologies for the lengthy explanation \u2014 I know you\u2019re eager to dive into the code. Don\u2019t worry; we\u2019ll get to it later in the article. However, understanding the concepts outlined below is a crucial part of building a sniper.</p>\n<p>Sure, you can copy-paste the code I provide in the <a href=\"https://github.com/weestack/Solana-Sniper\">GitHub repo</a>, but the moment something unexpected happens, you probably won\u2019t have a clue how to recover from it.</p>\n<h2 id=\"transactions\">Transactions</h2>\n<p>Now, let\u2019s start digging into transactions and get a brief overview of how smart contracts work.</p>\n<p>As you read this, you are probably familiar with sites such as Dexscreener, which monitors on-chain activity. The image below is from Dexscreener, where we will analyze a swap transaction.</p>\n<figure>\n<p><img alt=\"Dexscreener with arrows marking how to see latest meme coins in Raydium\" src=\"/static/raydium_sniper_part_3/dex_screener with arrows.webp\" /></p>\n<figcaption>\n<p>Dexscreener with arrows marking how to see latest meme coins in Raydium</p>\n</figcaption>\n</figure>\n<p>I have added a few arrows to demonstrate how I locate the latest Raydium tokens.</p>\n<p>For example I have chosen the <a href=\"https://dexscreener.com/solana/Gyd7ZymwPv7hosgzr46biJYMC6tq65LG3v5SLaApump\">A/SOL token</a>, just a random token:</p>\n<figure>\n<p><img alt=\"Dexscreener A/SOL token graph\" src=\"/static/raydium_sniper_part_3/dexscreener_token_graph.webp\" /></p>\n<figcaption>\n<p>Dexscreener A/SOL token graph</p>\n</figcaption>\n</figure>\n<p>A lot is happening here, so let\u2019s list the most obvious points:</p>\n<ul>\n<li>The market is crazy volatile</li>\n<li>The first record shows 79 SOL added as liquidity.</li>\n<li>The second and third transactions are swaps where the token was bought the moment it hit the market.</li>\n<li>The fourth and fifth transactions seem unusual.<br />\n  Two users are selling their A tokens, but they are not the same individuals who bought in transactions two and three. What might be happening here?</li>\n</ul>\n<p>The market is extremely volatile, and this behavior is best described as a game. For ~99% of all fresh tokens, it\u2019s a quick in-and-out process, as these tokens typically crash within 2 to 20 minutes of launch.</p>\n<p>To understand what\u2019s happening here, you need to be aware of something called <a href=\"https://pump.fun/coin/FMzbxgGBQp2DTqzBE5KCpb3srd7oo4sUQLLoV3kzpump\">pump.fun. The A/SOL token</a> was not originally launched on Raydium \u2014 it was relaunched there. Raydium allows anyone to create a new token, and if a token gains enough traction, it is relaunched on Raydium. This relaunch uses liquidity generated during the pump.fun phase, which occurs when the bonding curve reaches 100%.</p>\n<p>There\u2019s much more to learn about this process, but for sniping tokens on Raydium, the specifics of pump.fun are not particularly relevant. I encourage users to explore pump.fun in more depth if they wish to fully understand the entire lifecycle of a token.</p>\n<h2 id=\"breaking-down-swap-transactions\">Breaking down swap transactions</h2>\n<p>Back to transaction two and three, lets see whats happening there:</p>\n<ul>\n<li><a href=\"https://solscan.io/tx/3pdVGeG5zLPAEYZwsKgbrb9pSp6F6NuQC49apHDhkZWsBE1mdtA3Kem56VeDFocrDUy8RtTLKiPwtjgxAaxMaDfn\">Transaction two</a></li>\n<li><a href=\"https://solscan.io/tx/2rxJtG7BAdaigqM9PTJBHryRRegQXAF7YGqs3PKc6obrixFzTJuwQpxnArg9bRMG1cYseQDkbXHUWSkZpKmayHik\">Transaction three</a></li>\n</ul>\n<p>Lets take transaction two, and break it down into bits, for a deeper understand of whats going on.</p>\n<figure>\n<p><img alt=\"Solana raydium swap transaction upper part\" src=\"/static/raydium_sniper_part_3/Screenshot 2025-01-19 at 00.34.01.png\" /></p>\n<figcaption>\n<p>Solana Raydium swap transaction</p>\n</figcaption>\n</figure>\n<p>Note: The following might bore the average reader, but understanding the basics of Solana transactions is crucial and the bare minimum for both developing and maintaining a sniper bot. Apart from the points below, every eager sniper developer should thoroughly read <a href=\"https://solana.com/docs\">Solana\u2019s documentation</a> from start to finish, at least once.</p>\n<h3 id=\"result\">Result</h3>\n<p>The result covers both the stages and the result itself (Failed/Finalized). We touched on this concept in the previous post, where we discussed the stages: Processed, Confirmed, and Finalized.</p>\n<h3 id=\"signer\">Signer</h3>\n<p>A signer is the public key associated with your wallet. If you perform a swap transaction through any platform, your public key serves as the signer.</p>\n<p>There are also cases where smart contracts act as signers. For example, when a token on pump.fun reaches the bonding curve threshold and gets relaunched on Raydium, it is actually a smart contract that signs and moves the funds. This happens because a specific condition has been met.</p>\n<h3 id=\"fee\">Fee</h3>\n<p>The fee you choose to pay for a transaction is based on the number of compute units consumed. When performing swaps, you will specify a maximum compute unit limit.</p>\n<p><a href=\"https://solana.com/docs/core/fees\">I encourage you to read the Solana Docs</a>, especially the core sections, as they contain vital information. For example, the lower the compute unit limit you set, the higher the chance your transaction will be processed faster than those with a higher limit. This is because transactions with higher limits might not fit into the current block being proposed.</p>\n<p>This is critical information for sniping, as it means we should aim to set the smallest possible compute unit limit. However, it\u2019s important not to make it too small, as that would void the transaction. Validators need enough compute units to execute the smart contract and handle the overall instructions in the transaction.</p>\n<h3 id=\"priority-fee\">Priority Fee</h3>\n<p>This is a fee you can set to increase the chances of your transaction being picked sooner, essentially by tipping your friendly validator. Set it about 5% above the market average. Anything higher is just wasting money, as the effect tends to flatline around 5% to 8%, at least according to my test cases.</p>\n<h3 id=\"compute-units-consumed\">Compute Units Consumed</h3>\n<p>This is the actual number of compute units consumed by your transaction. Note that there is a limit to how high you can set the compute unit limit: 1.4 million per transaction and 200,000 per instruction. We won\u2019t be working anywhere near those numbers, but anything above those limits will result in an error.</p>\n<h3 id=\"swap-instruction\">Swap instruction</h3>\n<p>Now lets dig into the swap instruction:</p>\n<figure>\n<p><img alt=\"Solana raydium swap transaction swap part\" src=\"/static/raydium_sniper_part_3/Screenshot 2025-01-19 at 01.00.14.png\" /></p>\n<figcaption>\n<p>Solana Raydium swap transaction</p>\n</figcaption>\n</figure>\n<p>Note i skipped a lot of instructions such as creating Account with seed, initialize Account, transfers and so on, majority of these will be covered when we learn how to wrap sol. Instead we will focus on</p>\n<p><code>#6 - Raydium Liquidity Pool V4: raydium:swap</code></p>\n<p>The source code to the smart contract can be found here:<br />\n<a href=\"https://github.com/raydium-io/raydium-amm/tree/master\">https://github.com/raydium-io/raydium-amm/tree/master</a></p>\n<p>A <strong>Solana smart contract</strong> is an on-chain program written in Rust, (Less common C, or C++) that executes specific logic based on predefined rules. They are stateless and handle only the logic, while the data is managed through accounts.</p>\n<p>In other words, accounts and an instruction go in, the smart contract works behind the scenes, and in our case \u2014 voil\u00e0! \u2014 we\u2019ve made a swap of a brand-new token released only seconds ago.</p>\n<p>Now, let\u2019s break the swap transaction into chunks:</p>\n<ul>\n<li><strong>Input Account 1</strong><br />\n  This is simply the Solana token program, which is used to create most new tokens. Regarding meme coins, I\u2019ve never seen any other program used, so it\u2019s safe to say this is always static.</li>\n<li><strong>Input Accounts 2\u20137</strong> <br />\n  These are Raydium-specific accounts. I encourage readers to read up on and understand what each account does. For the purpose of swapping, we just need to know these accounts exist and match them, as the smart contract handles all the heavy lifting.</li>\n<li><strong>Input Accounts 10\u201315</strong><br />\n  These represent the order books, essentially detailing the inflow and outflow. One such order book could be Openbook.</li>\n<li><strong>Accounts 8 and 9</strong><br />\n  Are particularly important, while the rest are PDA (Program Derived Addresses), which can be quickly derived.</li>\n<li><strong>Input Accounts 16\u201318</strong><br />\n  These are our accounts: </li>\n<li>\n<ul>\n<li><strong>#16</strong>: The token account we\u2019re using to input funds for buying A/SOL.</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><strong>#17</strong>: The address where we will receive the A tokens.</li>\n</ul>\n</li>\n<li>\n<ul>\n<li><strong>#18</strong>: Our public key, which identifies our wallet.</li>\n</ul>\n</li>\n</ul>\n<p>Our wallet\u2019s private key holds authority over both <strong>#16</strong> and <strong>#17</strong>.</p>\n<figure>\n<p><img alt=\"Solana A/SOl swap transaction input\" src=\"/static/raydium_sniper_part_3/Screenshot 2025-01-19 at 13.52.10.png\" /></p>\n<figcaption>\n<p>Solana A/SOl swap transaction input</p>\n</figcaption>\n</figure>\n<p>The smart contract processes specific inputs to execute the swap:</p>\n<ul>\n<li><strong>Discriminator</strong>: This determines which part of the program to run. In this case, the number 9 is input to trigger a swap. If we input 7, the swap wouldn\u2019t occur. To understand what would happen, you could analyze the smart <a href=\"https://github.com/raydium-io/raydium-amm\">contact source code</a></li>\n<li><strong>amountIn</strong>: The amount of the payment token we are providing.</li>\n<li><strong>minimumAmountOut</strong>: This translates to our slippage tolerance. We can take the lazy route and set it to 0, essentially allowing any slippage. Alternatively, we can calculate the expected output and set this value to be 5% lower, effectively allowing a 5% slippage.</li>\n</ul>\n<h2 id=\"initialize2-transaction\">Initialize2 transaction</h2>\n<p>Now let\u2019s take a look at the <strong>initialize2 transaction</strong> for A to see what information we can extract for our swap instruction and what we still need.</p>\n<ul>\n<li><a href=\"https://solscan.io/tx/4UpnVxZJoSuTz1qefjBLX6Y1pS2krKY6xym9UrHEyqKiNXbDcxTGLoGDd6YxWqWH85K6PFwnpywgKN1tx97cabCb\">Initialize2 instruction for A/SOL</a></li>\n</ul>\n<figure>\n<p><img alt=\"Solana A/SOl Initialize2 instruction\" src=\"/static/raydium_sniper_part_3/Screenshot 2025-01-19 at 14.08.19.png\" /></p>\n<figcaption>\n<p>Solana A/SOl Initialize2 instruction</p>\n</figcaption>\n</figure>\n<p>Does that look familiar? It should! Here\u2019s a breakdown of the input accounts:</p>\n<ul>\n<li><strong>Input Accounts 5\u20138 + 11\u201314</strong>: These correspond to the Raydium AMM accounts.</li>\n<li><strong>Input Accounts 9 + 10</strong>: These represent the input token and output token (e.g., SOL and A).</li>\n<li><strong>Input Accounts 16\u201317</strong>: These correspond to the Serum program and market.\nThat\u2019s all we need to execute a swap. Yay!</li>\n</ul>\n<h2 id=\"lets-get-coding\">Lets get coding</h2>\n<p>Last time, we obtained the signature for the initialize2 transactions from our WebSocket stream. Now, after that long (but crucial!) schooling session of text, let\u2019s use RPC to fetch the transaction and parse the accounts.</p>\n<p>First, let\u2019s update utils/Cargo.toml with the latest requirements for nonblocking RPC, public key handling, and Solana's built-in transaction structures and implementations. Add the following dependencies to your project:</p>\n<ul>\n<li><code>solana-transaction-status</code></li>\n<li><code>solana-client</code></li>\n<li><code>solana-sdk</code></li>\n<li><code>tokio</code></li>\n</ul>\n<div class=\"language-toml highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a><span class=\"k\">[dependencies]</span>\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"n\">dotenv</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-0-3\"><a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a><span class=\"n\">thiserror</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-0-4\"><a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a><span class=\"n\">solana-transaction-status</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"p\">}</span>\n</span><span id=\"__span-0-5\"><a id=\"__codelineno-0-5\" name=\"__codelineno-0-5\" href=\"#__codelineno-0-5\"></a><span class=\"n\">solana-client</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-0-6\"><a id=\"__codelineno-0-6\" name=\"__codelineno-0-6\" href=\"#__codelineno-0-6\"></a><span class=\"n\">solana-program</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-0-7\"><a id=\"__codelineno-0-7\" name=\"__codelineno-0-7\" href=\"#__codelineno-0-7\"></a><span class=\"n\">solana-sdk</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-0-8\"><a id=\"__codelineno-0-8\" name=\"__codelineno-0-8\" href=\"#__codelineno-0-8\"></a><span class=\"n\">env_logger</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-0-9\"><a id=\"__codelineno-0-9\" name=\"__codelineno-0-9\" href=\"#__codelineno-0-9\"></a><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-0-10\"><a id=\"__codelineno-0-10\" name=\"__codelineno-0-10\" href=\"#__codelineno-0-10\"></a><span class=\"n\">tokio</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span></code></pre></div>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Create the file utils/src/raydium/initialize2.rs and add the following content</p>\n</div>\n<div class=\"language-rust highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">solana_sdk</span><span class=\"p\">::</span><span class=\"n\">pubkey</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-2\"><a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">solana_sdk</span><span class=\"p\">::</span><span class=\"n\">pubkey</span><span class=\"p\">::</span><span class=\"n\">Pubkey</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-3\"><a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">solana_sdk</span><span class=\"p\">::</span><span class=\"n\">transaction</span><span class=\"p\">::</span><span class=\"n\">VersionedTransaction</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-4\"><a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">fmt</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-5\"><a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"p\">::</span><span class=\"n\">info</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-6\"><a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">solana_client</span><span class=\"p\">::</span><span class=\"n\">nonblocking</span><span class=\"p\">::</span><span class=\"n\">rpc_client</span><span class=\"p\">::</span><span class=\"n\">RpcClient</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-7\"><a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">solana_client</span><span class=\"p\">::</span><span class=\"n\">rpc_config</span><span class=\"p\">::</span><span class=\"n\">RpcTransactionConfig</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-8\"><a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">solana_sdk</span><span class=\"p\">::</span><span class=\"n\">commitment_config</span><span class=\"p\">::</span><span class=\"n\">CommitmentConfig</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-9\"><a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">solana_sdk</span><span class=\"p\">::</span><span class=\"n\">signature</span><span class=\"p\">::</span><span class=\"n\">Signature</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-10\"><a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">solana_transaction_status</span><span class=\"p\">::</span><span class=\"n\">UiTransactionEncoding</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-11\"><a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a>\n</span><span id=\"__span-1-12\"><a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">RaydiumInitialize2Transaction</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-13\"><a id=\"__codelineno-1-13\" name=\"__codelineno-1-13\" href=\"#__codelineno-1-13\"></a><span class=\"w\">    </span><span class=\"n\">token_program</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-14\"><a id=\"__codelineno-1-14\" name=\"__codelineno-1-14\" href=\"#__codelineno-1-14\"></a><span class=\"w\">    </span><span class=\"n\">spl_associated_token_account</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-15\"><a id=\"__codelineno-1-15\" name=\"__codelineno-1-15\" href=\"#__codelineno-1-15\"></a><span class=\"w\">    </span><span class=\"n\">system_program</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-16\"><a id=\"__codelineno-1-16\" name=\"__codelineno-1-16\" href=\"#__codelineno-1-16\"></a><span class=\"w\">    </span><span class=\"n\">rent_program</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-17\"><a id=\"__codelineno-1-17\" name=\"__codelineno-1-17\" href=\"#__codelineno-1-17\"></a><span class=\"w\">    </span><span class=\"n\">amm</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-18\"><a id=\"__codelineno-1-18\" name=\"__codelineno-1-18\" href=\"#__codelineno-1-18\"></a><span class=\"w\">    </span><span class=\"n\">amm_authority</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-19\"><a id=\"__codelineno-1-19\" name=\"__codelineno-1-19\" href=\"#__codelineno-1-19\"></a><span class=\"w\">    </span><span class=\"n\">amm_open_orders</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-20\"><a id=\"__codelineno-1-20\" name=\"__codelineno-1-20\" href=\"#__codelineno-1-20\"></a><span class=\"w\">    </span><span class=\"n\">lp_mint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-21\"><a id=\"__codelineno-1-21\" name=\"__codelineno-1-21\" href=\"#__codelineno-1-21\"></a><span class=\"w\">    </span><span class=\"n\">coin_mint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-22\"><a id=\"__codelineno-1-22\" name=\"__codelineno-1-22\" href=\"#__codelineno-1-22\"></a><span class=\"w\">    </span><span class=\"n\">pc_mint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-23\"><a id=\"__codelineno-1-23\" name=\"__codelineno-1-23\" href=\"#__codelineno-1-23\"></a><span class=\"w\">    </span><span class=\"n\">pool_coin_token_account</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-24\"><a id=\"__codelineno-1-24\" name=\"__codelineno-1-24\" href=\"#__codelineno-1-24\"></a><span class=\"w\">    </span><span class=\"n\">pool_pc_token_account</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-25\"><a id=\"__codelineno-1-25\" name=\"__codelineno-1-25\" href=\"#__codelineno-1-25\"></a><span class=\"w\">    </span><span class=\"n\">pool_withdraw_queue</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-26\"><a id=\"__codelineno-1-26\" name=\"__codelineno-1-26\" href=\"#__codelineno-1-26\"></a><span class=\"w\">    </span><span class=\"n\">amm_target_orders</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-27\"><a id=\"__codelineno-1-27\" name=\"__codelineno-1-27\" href=\"#__codelineno-1-27\"></a><span class=\"w\">    </span><span class=\"n\">pool_temp_lp</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-28\"><a id=\"__codelineno-1-28\" name=\"__codelineno-1-28\" href=\"#__codelineno-1-28\"></a><span class=\"w\">    </span><span class=\"n\">serum_program</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-29\"><a id=\"__codelineno-1-29\" name=\"__codelineno-1-29\" href=\"#__codelineno-1-29\"></a><span class=\"w\">    </span><span class=\"n\">serum_market</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-30\"><a id=\"__codelineno-1-30\" name=\"__codelineno-1-30\" href=\"#__codelineno-1-30\"></a><span class=\"w\">    </span><span class=\"n\">user_wallet</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-31\"><a id=\"__codelineno-1-31\" name=\"__codelineno-1-31\" href=\"#__codelineno-1-31\"></a><span class=\"w\">    </span><span class=\"n\">user_token_coin</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-32\"><a id=\"__codelineno-1-32\" name=\"__codelineno-1-32\" href=\"#__codelineno-1-32\"></a><span class=\"w\">    </span><span class=\"n\">user_token_pc</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-33\"><a id=\"__codelineno-1-33\" name=\"__codelineno-1-33\" href=\"#__codelineno-1-33\"></a><span class=\"w\">    </span><span class=\"n\">user_lp_token_account</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-34\"><a id=\"__codelineno-1-34\" name=\"__codelineno-1-34\" href=\"#__codelineno-1-34\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-1-35\"><a id=\"__codelineno-1-35\" name=\"__codelineno-1-35\" href=\"#__codelineno-1-35\"></a>\n</span><span id=\"__span-1-36\"><a id=\"__codelineno-1-36\" name=\"__codelineno-1-36\" href=\"#__codelineno-1-36\"></a><span class=\"cp\">#[derive(Debug)]</span>\n</span><span id=\"__span-1-37\"><a id=\"__codelineno-1-37\" name=\"__codelineno-1-37\" href=\"#__codelineno-1-37\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">RaydiumTransactionError</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-38\"><a id=\"__codelineno-1-38\" name=\"__codelineno-1-38\" href=\"#__codelineno-1-38\"></a><span class=\"w\">    </span><span class=\"n\">NotEnoughKeys</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-39\"><a id=\"__codelineno-1-39\" name=\"__codelineno-1-39\" href=\"#__codelineno-1-39\"></a><span class=\"w\">    </span><span class=\"n\">CantFindTokenAddress</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-40\"><a id=\"__codelineno-1-40\" name=\"__codelineno-1-40\" href=\"#__codelineno-1-40\"></a><span class=\"w\">    </span><span class=\"n\">NoTransactionFound</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-41\"><a id=\"__codelineno-1-41\" name=\"__codelineno-1-41\" href=\"#__codelineno-1-41\"></a><span class=\"w\">    </span><span class=\"n\">CouldNotParseTransaction</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-42\"><a id=\"__codelineno-1-42\" name=\"__codelineno-1-42\" href=\"#__codelineno-1-42\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-1-43\"><a id=\"__codelineno-1-43\" name=\"__codelineno-1-43\" href=\"#__codelineno-1-43\"></a>\n</span><span id=\"__span-1-44\"><a id=\"__codelineno-1-44\" name=\"__codelineno-1-44\" href=\"#__codelineno-1-44\"></a><span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">RaydiumInitialize2Transaction</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-45\"><a id=\"__codelineno-1-45\" name=\"__codelineno-1-45\" href=\"#__codelineno-1-45\"></a>\n</span><span id=\"__span-1-46\"><a id=\"__codelineno-1-46\" name=\"__codelineno-1-46\" href=\"#__codelineno-1-46\"></a><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">get_transaction</span><span class=\"p\">(</span><span class=\"n\">tx</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Signature</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rpc_endpoint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">String</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"n\">RaydiumInitialize2Transaction</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RaydiumTransactionError</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-47\"><a id=\"__codelineno-1-47\" name=\"__codelineno-1-47\" href=\"#__codelineno-1-47\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</span><span id=\"__span-1-48\"><a id=\"__codelineno-1-48\" name=\"__codelineno-1-48\" href=\"#__codelineno-1-48\"></a><span class=\"w\">            </span><span class=\"n\">RpcClient</span><span class=\"p\">::</span><span class=\"n\">new_with_commitment</span><span class=\"p\">(</span><span class=\"n\">rpc_endpoint</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">CommitmentConfig</span><span class=\"p\">::</span><span class=\"n\">processed</span><span class=\"p\">());</span>\n</span><span id=\"__span-1-49\"><a id=\"__codelineno-1-49\" name=\"__codelineno-1-49\" href=\"#__codelineno-1-49\"></a>\n</span><span id=\"__span-1-50\"><a id=\"__codelineno-1-50\" name=\"__codelineno-1-50\" href=\"#__codelineno-1-50\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">config</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">RpcTransactionConfig</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-51\"><a id=\"__codelineno-1-51\" name=\"__codelineno-1-51\" href=\"#__codelineno-1-51\"></a><span class=\"w\">            </span><span class=\"n\">encoding</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"n\">UiTransactionEncoding</span><span class=\"p\">::</span><span class=\"n\">Binary</span><span class=\"p\">),</span>\n</span><span id=\"__span-1-52\"><a id=\"__codelineno-1-52\" name=\"__codelineno-1-52\" href=\"#__codelineno-1-52\"></a><span class=\"w\">            </span><span class=\"n\">commitment</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"n\">CommitmentConfig</span><span class=\"p\">::</span><span class=\"n\">confirmed</span><span class=\"p\">()),</span>\n</span><span id=\"__span-1-53\"><a id=\"__codelineno-1-53\" name=\"__codelineno-1-53\" href=\"#__codelineno-1-53\"></a><span class=\"w\">            </span><span class=\"n\">max_supported_transaction_version</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">),</span>\n</span><span id=\"__span-1-54\"><a id=\"__codelineno-1-54\" name=\"__codelineno-1-54\" href=\"#__codelineno-1-54\"></a><span class=\"w\">        </span><span class=\"p\">};</span>\n</span><span id=\"__span-1-55\"><a id=\"__codelineno-1-55\" name=\"__codelineno-1-55\" href=\"#__codelineno-1-55\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">transaction</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">client</span>\n</span><span id=\"__span-1-56\"><a id=\"__codelineno-1-56\" name=\"__codelineno-1-56\" href=\"#__codelineno-1-56\"></a><span class=\"w\">            </span><span class=\"p\">.</span><span class=\"n\">get_transaction_with_config</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">tx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">config</span><span class=\"p\">)</span>\n</span><span id=\"__span-1-57\"><a id=\"__codelineno-1-57\" name=\"__codelineno-1-57\" href=\"#__codelineno-1-57\"></a><span class=\"w\">            </span><span class=\"p\">.</span><span class=\"k\">await</span>\n</span><span id=\"__span-1-58\"><a id=\"__codelineno-1-58\" name=\"__codelineno-1-58\" href=\"#__codelineno-1-58\"></a><span class=\"w\">            </span><span class=\"p\">.</span><span class=\"n\">map_err</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"n\">_</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">RaydiumTransactionError</span><span class=\"p\">::</span><span class=\"n\">NoTransactionFound</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-59\"><a id=\"__codelineno-1-59\" name=\"__codelineno-1-59\" href=\"#__codelineno-1-59\"></a>\n</span><span id=\"__span-1-60\"><a id=\"__codelineno-1-60\" name=\"__codelineno-1-60\" href=\"#__codelineno-1-60\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"n\">versioned_transaction</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">transaction</span><span class=\"p\">.</span><span class=\"n\">transaction</span><span class=\"p\">.</span><span class=\"n\">transaction</span><span class=\"p\">.</span><span class=\"n\">decode</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-61\"><a id=\"__codelineno-1-61\" name=\"__codelineno-1-61\" href=\"#__codelineno-1-61\"></a><span class=\"w\">            </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">RaydiumInitialize2Transaction</span><span class=\"p\">::</span><span class=\"n\">parse</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">versioned_transaction</span><span class=\"p\">)</span>\n</span><span id=\"__span-1-62\"><a id=\"__codelineno-1-62\" name=\"__codelineno-1-62\" href=\"#__codelineno-1-62\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-63\"><a id=\"__codelineno-1-63\" name=\"__codelineno-1-63\" href=\"#__codelineno-1-63\"></a>\n</span><span id=\"__span-1-64\"><a id=\"__codelineno-1-64\" name=\"__codelineno-1-64\" href=\"#__codelineno-1-64\"></a><span class=\"w\">        </span><span class=\"nb\">Err</span><span class=\"p\">(</span><span class=\"n\">RaydiumTransactionError</span><span class=\"p\">::</span><span class=\"n\">CouldNotParseTransaction</span><span class=\"p\">)</span>\n</span><span id=\"__span-1-65\"><a id=\"__codelineno-1-65\" name=\"__codelineno-1-65\" href=\"#__codelineno-1-65\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-66\"><a id=\"__codelineno-1-66\" name=\"__codelineno-1-66\" href=\"#__codelineno-1-66\"></a><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">parse</span><span class=\"p\">(</span><span class=\"n\">transaction</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kp\">&amp;</span><span class=\"nc\">VersionedTransaction</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"bp\">Self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RaydiumTransactionError</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-67\"><a id=\"__codelineno-1-67\" name=\"__codelineno-1-67\" href=\"#__codelineno-1-67\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">keys</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">transaction</span><span class=\"p\">.</span><span class=\"n\">message</span><span class=\"p\">.</span><span class=\"n\">static_account_keys</span><span class=\"p\">();</span>\n</span><span id=\"__span-1-68\"><a id=\"__codelineno-1-68\" name=\"__codelineno-1-68\" href=\"#__codelineno-1-68\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">keys</span><span class=\"p\">.</span><span class=\"n\">len</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"mi\">22</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-69\"><a id=\"__codelineno-1-69\" name=\"__codelineno-1-69\" href=\"#__codelineno-1-69\"></a><span class=\"w\">            </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"nb\">Err</span><span class=\"p\">(</span><span class=\"n\">RaydiumTransactionError</span><span class=\"p\">::</span><span class=\"n\">NotEnoughKeys</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-70\"><a id=\"__codelineno-1-70\" name=\"__codelineno-1-70\" href=\"#__codelineno-1-70\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-71\"><a id=\"__codelineno-1-71\" name=\"__codelineno-1-71\" href=\"#__codelineno-1-71\"></a>\n</span><span id=\"__span-1-72\"><a id=\"__codelineno-1-72\" name=\"__codelineno-1-72\" href=\"#__codelineno-1-72\"></a><span class=\"w\">        </span><span class=\"c1\">// Use to debug the order of the keys inputted, if something seems off</span>\n</span><span id=\"__span-1-73\"><a id=\"__codelineno-1-73\" name=\"__codelineno-1-73\" href=\"#__codelineno-1-73\"></a><span class=\"w\">        </span><span class=\"cm\">/* for (index, solana_address) in keys.iter().enumerate() {</span>\n</span><span id=\"__span-1-74\"><a id=\"__codelineno-1-74\" name=\"__codelineno-1-74\" href=\"#__codelineno-1-74\"></a><span class=\"cm\">            debug!(&quot;{}: {}&quot;, index, solana_address);</span>\n</span><span id=\"__span-1-75\"><a id=\"__codelineno-1-75\" name=\"__codelineno-1-75\" href=\"#__codelineno-1-75\"></a><span class=\"cm\">        } */</span>\n</span><span id=\"__span-1-76\"><a id=\"__codelineno-1-76\" name=\"__codelineno-1-76\" href=\"#__codelineno-1-76\"></a>\n</span><span id=\"__span-1-77\"><a id=\"__codelineno-1-77\" name=\"__codelineno-1-77\" href=\"#__codelineno-1-77\"></a><span class=\"w\">        </span><span class=\"cm\">/* eval token addresses */</span>\n</span><span id=\"__span-1-78\"><a id=\"__codelineno-1-78\" name=\"__codelineno-1-78\" href=\"#__codelineno-1-78\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">base_coin</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-79\"><a id=\"__codelineno-1-79\" name=\"__codelineno-1-79\" href=\"#__codelineno-1-79\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">token_coin</span><span class=\"p\">;</span>\n</span><span id=\"__span-1-80\"><a id=\"__codelineno-1-80\" name=\"__codelineno-1-80\" href=\"#__codelineno-1-80\"></a>\n</span><span id=\"__span-1-81\"><a id=\"__codelineno-1-81\" name=\"__codelineno-1-81\" href=\"#__codelineno-1-81\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">keys</span><span class=\"p\">[</span><span class=\"mi\">13</span><span class=\"p\">].</span><span class=\"n\">to_string</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"s\">&quot;So11111111111111111111111111111111111111112&quot;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-82\"><a id=\"__codelineno-1-82\" name=\"__codelineno-1-82\" href=\"#__codelineno-1-82\"></a><span class=\"w\">            </span><span class=\"n\">base_coin</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">pubkey</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">&quot;So11111111111111111111111111111111111111112&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-83\"><a id=\"__codelineno-1-83\" name=\"__codelineno-1-83\" href=\"#__codelineno-1-83\"></a><span class=\"w\">            </span><span class=\"n\">token_coin</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">keys</span><span class=\"p\">[</span><span class=\"mi\">18</span><span class=\"p\">];</span>\n</span><span id=\"__span-1-84\"><a id=\"__codelineno-1-84\" name=\"__codelineno-1-84\" href=\"#__codelineno-1-84\"></a><span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">keys</span><span class=\"p\">[</span><span class=\"mi\">18</span><span class=\"p\">].</span><span class=\"n\">to_string</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"s\">&quot;So111111111111111111111111111111111111111111&quot;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-85\"><a id=\"__codelineno-1-85\" name=\"__codelineno-1-85\" href=\"#__codelineno-1-85\"></a><span class=\"w\">            </span><span class=\"n\">base_coin</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">pubkey</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">&quot;So11111111111111111111111111111111111111112&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-86\"><a id=\"__codelineno-1-86\" name=\"__codelineno-1-86\" href=\"#__codelineno-1-86\"></a><span class=\"w\">            </span><span class=\"n\">token_coin</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">keys</span><span class=\"p\">[</span><span class=\"mi\">13</span><span class=\"p\">];</span>\n</span><span id=\"__span-1-87\"><a id=\"__codelineno-1-87\" name=\"__codelineno-1-87\" href=\"#__codelineno-1-87\"></a><span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-88\"><a id=\"__codelineno-1-88\" name=\"__codelineno-1-88\" href=\"#__codelineno-1-88\"></a><span class=\"w\">            </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"nb\">Err</span><span class=\"p\">(</span><span class=\"n\">RaydiumTransactionError</span><span class=\"p\">::</span><span class=\"n\">CantFindTokenAddress</span><span class=\"p\">);</span>\n</span><span id=\"__span-1-89\"><a id=\"__codelineno-1-89\" name=\"__codelineno-1-89\" href=\"#__codelineno-1-89\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-90\"><a id=\"__codelineno-1-90\" name=\"__codelineno-1-90\" href=\"#__codelineno-1-90\"></a>\n</span><span id=\"__span-1-91\"><a id=\"__codelineno-1-91\" name=\"__codelineno-1-91\" href=\"#__codelineno-1-91\"></a><span class=\"w\">        </span><span class=\"nb\">Ok</span><span class=\"p\">(</span><span class=\"n\">RaydiumInitialize2Transaction</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-92\"><a id=\"__codelineno-1-92\" name=\"__codelineno-1-92\" href=\"#__codelineno-1-92\"></a><span class=\"w\">            </span><span class=\"n\">token_program</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">12</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-93\"><a id=\"__codelineno-1-93\" name=\"__codelineno-1-93\" href=\"#__codelineno-1-93\"></a><span class=\"w\">            </span><span class=\"n\">spl_associated_token_account</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">16</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-94\"><a id=\"__codelineno-1-94\" name=\"__codelineno-1-94\" href=\"#__codelineno-1-94\"></a><span class=\"w\">            </span><span class=\"n\">system_program</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">11</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-95\"><a id=\"__codelineno-1-95\" name=\"__codelineno-1-95\" href=\"#__codelineno-1-95\"></a><span class=\"w\">            </span><span class=\"n\">rent_program</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">14</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-96\"><a id=\"__codelineno-1-96\" name=\"__codelineno-1-96\" href=\"#__codelineno-1-96\"></a><span class=\"w\">            </span><span class=\"n\">amm</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-97\"><a id=\"__codelineno-1-97\" name=\"__codelineno-1-97\" href=\"#__codelineno-1-97\"></a><span class=\"w\">            </span><span class=\"n\">amm_authority</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">17</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-98\"><a id=\"__codelineno-1-98\" name=\"__codelineno-1-98\" href=\"#__codelineno-1-98\"></a><span class=\"w\">            </span><span class=\"n\">amm_open_orders</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-99\"><a id=\"__codelineno-1-99\" name=\"__codelineno-1-99\" href=\"#__codelineno-1-99\"></a><span class=\"w\">            </span><span class=\"n\">lp_mint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-100\"><a id=\"__codelineno-1-100\" name=\"__codelineno-1-100\" href=\"#__codelineno-1-100\"></a><span class=\"w\">            </span><span class=\"n\">coin_mint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">base_coin</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-101\"><a id=\"__codelineno-1-101\" name=\"__codelineno-1-101\" href=\"#__codelineno-1-101\"></a><span class=\"w\">            </span><span class=\"n\">pc_mint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">token_coin</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-102\"><a id=\"__codelineno-1-102\" name=\"__codelineno-1-102\" href=\"#__codelineno-1-102\"></a><span class=\"w\">            </span><span class=\"n\">pool_coin_token_account</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">5</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-103\"><a id=\"__codelineno-1-103\" name=\"__codelineno-1-103\" href=\"#__codelineno-1-103\"></a><span class=\"w\">            </span><span class=\"n\">pool_pc_token_account</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">6</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-104\"><a id=\"__codelineno-1-104\" name=\"__codelineno-1-104\" href=\"#__codelineno-1-104\"></a><span class=\"w\">            </span><span class=\"n\">pool_withdraw_queue</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">7</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-105\"><a id=\"__codelineno-1-105\" name=\"__codelineno-1-105\" href=\"#__codelineno-1-105\"></a><span class=\"w\">            </span><span class=\"n\">amm_target_orders</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">19</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-106\"><a id=\"__codelineno-1-106\" name=\"__codelineno-1-106\" href=\"#__codelineno-1-106\"></a><span class=\"w\">            </span><span class=\"n\">pool_temp_lp</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">8</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-107\"><a id=\"__codelineno-1-107\" name=\"__codelineno-1-107\" href=\"#__codelineno-1-107\"></a><span class=\"w\">            </span><span class=\"n\">serum_program</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">20</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-108\"><a id=\"__codelineno-1-108\" name=\"__codelineno-1-108\" href=\"#__codelineno-1-108\"></a><span class=\"w\">            </span><span class=\"n\">serum_market</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">21</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-109\"><a id=\"__codelineno-1-109\" name=\"__codelineno-1-109\" href=\"#__codelineno-1-109\"></a><span class=\"w\">            </span><span class=\"n\">user_wallet</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-110\"><a id=\"__codelineno-1-110\" name=\"__codelineno-1-110\" href=\"#__codelineno-1-110\"></a><span class=\"w\">            </span><span class=\"n\">user_token_coin</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-111\"><a id=\"__codelineno-1-111\" name=\"__codelineno-1-111\" href=\"#__codelineno-1-111\"></a><span class=\"w\">            </span><span class=\"n\">user_token_pc</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">9</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-112\"><a id=\"__codelineno-1-112\" name=\"__codelineno-1-112\" href=\"#__codelineno-1-112\"></a><span class=\"w\">            </span><span class=\"n\">user_lp_token_account</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">10</span><span class=\"p\">],</span>\n</span><span id=\"__span-1-113\"><a id=\"__codelineno-1-113\" name=\"__codelineno-1-113\" href=\"#__codelineno-1-113\"></a><span class=\"w\">        </span><span class=\"p\">})</span>\n</span><span id=\"__span-1-114\"><a id=\"__codelineno-1-114\" name=\"__codelineno-1-114\" href=\"#__codelineno-1-114\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-115\"><a id=\"__codelineno-1-115\" name=\"__codelineno-1-115\" href=\"#__codelineno-1-115\"></a>\n</span><span id=\"__span-1-116\"><a id=\"__codelineno-1-116\" name=\"__codelineno-1-116\" href=\"#__codelineno-1-116\"></a><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">get_mint</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-117\"><a id=\"__codelineno-1-117\" name=\"__codelineno-1-117\" href=\"#__codelineno-1-117\"></a><span class=\"w\">        </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">pc_mint</span>\n</span><span id=\"__span-1-118\"><a id=\"__codelineno-1-118\" name=\"__codelineno-1-118\" href=\"#__codelineno-1-118\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-119\"><a id=\"__codelineno-1-119\" name=\"__codelineno-1-119\" href=\"#__codelineno-1-119\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-1-120\"><a id=\"__codelineno-1-120\" name=\"__codelineno-1-120\" href=\"#__codelineno-1-120\"></a>\n</span><span id=\"__span-1-121\"><a id=\"__codelineno-1-121\" name=\"__codelineno-1-121\" href=\"#__codelineno-1-121\"></a><span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">fmt</span><span class=\"p\">::</span><span class=\"n\">Display</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">RaydiumInitialize2Transaction</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-122\"><a id=\"__codelineno-1-122\" name=\"__codelineno-1-122\" href=\"#__codelineno-1-122\"></a><span class=\"w\">    </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">fmt</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"bp\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kp\">&amp;</span><span class=\"nc\">mut</span><span class=\"w\"> </span><span class=\"n\">fmt</span><span class=\"p\">::</span><span class=\"n\">Formatter</span><span class=\"o\">&lt;&#39;</span><span class=\"nb\">_</span><span class=\"o\">&gt;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">fmt</span><span class=\"p\">::</span><span class=\"nb\">Result</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-1-123\"><a id=\"__codelineno-1-123\" name=\"__codelineno-1-123\" href=\"#__codelineno-1-123\"></a><span class=\"w\">        </span><span class=\"fm\">write!</span><span class=\"p\">(</span>\n</span><span id=\"__span-1-124\"><a id=\"__codelineno-1-124\" name=\"__codelineno-1-124\" href=\"#__codelineno-1-124\"></a><span class=\"w\">            </span><span class=\"n\">f</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-125\"><a id=\"__codelineno-1-125\" name=\"__codelineno-1-125\" href=\"#__codelineno-1-125\"></a><span class=\"w\">            </span><span class=\"s\">&quot;token_program:                {}</span>\n</span><span id=\"__span-1-126\"><a id=\"__codelineno-1-126\" name=\"__codelineno-1-126\" href=\"#__codelineno-1-126\"></a><span class=\"s\">spl_associated_token_account: {}</span>\n</span><span id=\"__span-1-127\"><a id=\"__codelineno-1-127\" name=\"__codelineno-1-127\" href=\"#__codelineno-1-127\"></a><span class=\"s\">system_program:               {}</span>\n</span><span id=\"__span-1-128\"><a id=\"__codelineno-1-128\" name=\"__codelineno-1-128\" href=\"#__codelineno-1-128\"></a><span class=\"s\">rent_program:                 {}</span>\n</span><span id=\"__span-1-129\"><a id=\"__codelineno-1-129\" name=\"__codelineno-1-129\" href=\"#__codelineno-1-129\"></a><span class=\"s\">amm:                          {}</span>\n</span><span id=\"__span-1-130\"><a id=\"__codelineno-1-130\" name=\"__codelineno-1-130\" href=\"#__codelineno-1-130\"></a><span class=\"s\">amm_authority:                {}</span>\n</span><span id=\"__span-1-131\"><a id=\"__codelineno-1-131\" name=\"__codelineno-1-131\" href=\"#__codelineno-1-131\"></a><span class=\"s\">amm_open_orders:              {}</span>\n</span><span id=\"__span-1-132\"><a id=\"__codelineno-1-132\" name=\"__codelineno-1-132\" href=\"#__codelineno-1-132\"></a><span class=\"s\">lp_mint:                      {}</span>\n</span><span id=\"__span-1-133\"><a id=\"__codelineno-1-133\" name=\"__codelineno-1-133\" href=\"#__codelineno-1-133\"></a><span class=\"s\">coin_mint:                    {}</span>\n</span><span id=\"__span-1-134\"><a id=\"__codelineno-1-134\" name=\"__codelineno-1-134\" href=\"#__codelineno-1-134\"></a><span class=\"s\">pc_mint:                      {}</span>\n</span><span id=\"__span-1-135\"><a id=\"__codelineno-1-135\" name=\"__codelineno-1-135\" href=\"#__codelineno-1-135\"></a><span class=\"s\">pool_coin_token_account:      {}</span>\n</span><span id=\"__span-1-136\"><a id=\"__codelineno-1-136\" name=\"__codelineno-1-136\" href=\"#__codelineno-1-136\"></a><span class=\"s\">pool_pc_token_account:        {}</span>\n</span><span id=\"__span-1-137\"><a id=\"__codelineno-1-137\" name=\"__codelineno-1-137\" href=\"#__codelineno-1-137\"></a><span class=\"s\">pool_withdraw_queue:          {}</span>\n</span><span id=\"__span-1-138\"><a id=\"__codelineno-1-138\" name=\"__codelineno-1-138\" href=\"#__codelineno-1-138\"></a><span class=\"s\">amm_target_orders:            {}</span>\n</span><span id=\"__span-1-139\"><a id=\"__codelineno-1-139\" name=\"__codelineno-1-139\" href=\"#__codelineno-1-139\"></a><span class=\"s\">pool_temp_lp:                 {}</span>\n</span><span id=\"__span-1-140\"><a id=\"__codelineno-1-140\" name=\"__codelineno-1-140\" href=\"#__codelineno-1-140\"></a><span class=\"s\">serum_program:                {}</span>\n</span><span id=\"__span-1-141\"><a id=\"__codelineno-1-141\" name=\"__codelineno-1-141\" href=\"#__codelineno-1-141\"></a><span class=\"s\">serum_market:                 {}</span>\n</span><span id=\"__span-1-142\"><a id=\"__codelineno-1-142\" name=\"__codelineno-1-142\" href=\"#__codelineno-1-142\"></a><span class=\"s\">user_wallet:                  {}</span>\n</span><span id=\"__span-1-143\"><a id=\"__codelineno-1-143\" name=\"__codelineno-1-143\" href=\"#__codelineno-1-143\"></a><span class=\"s\">user_token_coin:              {}</span>\n</span><span id=\"__span-1-144\"><a id=\"__codelineno-1-144\" name=\"__codelineno-1-144\" href=\"#__codelineno-1-144\"></a><span class=\"s\">user_token_pc:                {}</span>\n</span><span id=\"__span-1-145\"><a id=\"__codelineno-1-145\" name=\"__codelineno-1-145\" href=\"#__codelineno-1-145\"></a><span class=\"s\">user_lp_token_account:        {}&quot;</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-146\"><a id=\"__codelineno-1-146\" name=\"__codelineno-1-146\" href=\"#__codelineno-1-146\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">token_program</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-147\"><a id=\"__codelineno-1-147\" name=\"__codelineno-1-147\" href=\"#__codelineno-1-147\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">spl_associated_token_account</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-148\"><a id=\"__codelineno-1-148\" name=\"__codelineno-1-148\" href=\"#__codelineno-1-148\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">system_program</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-149\"><a id=\"__codelineno-1-149\" name=\"__codelineno-1-149\" href=\"#__codelineno-1-149\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">rent_program</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-150\"><a id=\"__codelineno-1-150\" name=\"__codelineno-1-150\" href=\"#__codelineno-1-150\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">amm</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-151\"><a id=\"__codelineno-1-151\" name=\"__codelineno-1-151\" href=\"#__codelineno-1-151\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">amm_authority</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-152\"><a id=\"__codelineno-1-152\" name=\"__codelineno-1-152\" href=\"#__codelineno-1-152\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">amm_open_orders</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-153\"><a id=\"__codelineno-1-153\" name=\"__codelineno-1-153\" href=\"#__codelineno-1-153\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">lp_mint</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-154\"><a id=\"__codelineno-1-154\" name=\"__codelineno-1-154\" href=\"#__codelineno-1-154\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">coin_mint</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-155\"><a id=\"__codelineno-1-155\" name=\"__codelineno-1-155\" href=\"#__codelineno-1-155\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">pc_mint</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-156\"><a id=\"__codelineno-1-156\" name=\"__codelineno-1-156\" href=\"#__codelineno-1-156\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">pool_coin_token_account</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-157\"><a id=\"__codelineno-1-157\" name=\"__codelineno-1-157\" href=\"#__codelineno-1-157\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">pool_pc_token_account</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-158\"><a id=\"__codelineno-1-158\" name=\"__codelineno-1-158\" href=\"#__codelineno-1-158\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">pool_withdraw_queue</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-159\"><a id=\"__codelineno-1-159\" name=\"__codelineno-1-159\" href=\"#__codelineno-1-159\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">amm_target_orders</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-160\"><a id=\"__codelineno-1-160\" name=\"__codelineno-1-160\" href=\"#__codelineno-1-160\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">pool_temp_lp</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-161\"><a id=\"__codelineno-1-161\" name=\"__codelineno-1-161\" href=\"#__codelineno-1-161\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">serum_program</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-162\"><a id=\"__codelineno-1-162\" name=\"__codelineno-1-162\" href=\"#__codelineno-1-162\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">serum_market</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-163\"><a id=\"__codelineno-1-163\" name=\"__codelineno-1-163\" href=\"#__codelineno-1-163\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">user_wallet</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-164\"><a id=\"__codelineno-1-164\" name=\"__codelineno-1-164\" href=\"#__codelineno-1-164\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">user_token_coin</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-165\"><a id=\"__codelineno-1-165\" name=\"__codelineno-1-165\" href=\"#__codelineno-1-165\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">user_token_pc</span><span class=\"p\">,</span>\n</span><span id=\"__span-1-166\"><a id=\"__codelineno-1-166\" name=\"__codelineno-1-166\" href=\"#__codelineno-1-166\"></a><span class=\"w\">            </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">user_lp_token_account</span>\n</span><span id=\"__span-1-167\"><a id=\"__codelineno-1-167\" name=\"__codelineno-1-167\" href=\"#__codelineno-1-167\"></a><span class=\"w\">        </span><span class=\"p\">)</span>\n</span><span id=\"__span-1-168\"><a id=\"__codelineno-1-168\" name=\"__codelineno-1-168\" href=\"#__codelineno-1-168\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-1-169\"><a id=\"__codelineno-1-169\" name=\"__codelineno-1-169\" href=\"#__codelineno-1-169\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>Whew, that\u2019s a lot of code! Let\u2019s break it down into chunks to thoroughly understand each part.</p>\n<div class=\"language-rust highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">RaydiumInitialize2Transaction</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-2-2\"><a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a><span class=\"w\">    </span><span class=\"n\">token_program</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-3\"><a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a><span class=\"w\">    </span><span class=\"n\">spl_associated_token_account</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-4\"><a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a><span class=\"w\">    </span><span class=\"n\">system_program</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-5\"><a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a><span class=\"w\">    </span><span class=\"n\">rent_program</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-6\"><a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a><span class=\"w\">    </span><span class=\"n\">amm</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-7\"><a id=\"__codelineno-2-7\" name=\"__codelineno-2-7\" href=\"#__codelineno-2-7\"></a><span class=\"w\">    </span><span class=\"n\">amm_authority</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-8\"><a id=\"__codelineno-2-8\" name=\"__codelineno-2-8\" href=\"#__codelineno-2-8\"></a><span class=\"w\">    </span><span class=\"n\">amm_open_orders</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-9\"><a id=\"__codelineno-2-9\" name=\"__codelineno-2-9\" href=\"#__codelineno-2-9\"></a><span class=\"w\">    </span><span class=\"n\">lp_mint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-10\"><a id=\"__codelineno-2-10\" name=\"__codelineno-2-10\" href=\"#__codelineno-2-10\"></a><span class=\"w\">    </span><span class=\"n\">coin_mint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-11\"><a id=\"__codelineno-2-11\" name=\"__codelineno-2-11\" href=\"#__codelineno-2-11\"></a><span class=\"w\">    </span><span class=\"n\">pc_mint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-12\"><a id=\"__codelineno-2-12\" name=\"__codelineno-2-12\" href=\"#__codelineno-2-12\"></a><span class=\"w\">    </span><span class=\"n\">pool_coin_token_account</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-13\"><a id=\"__codelineno-2-13\" name=\"__codelineno-2-13\" href=\"#__codelineno-2-13\"></a><span class=\"w\">    </span><span class=\"n\">pool_pc_token_account</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-14\"><a id=\"__codelineno-2-14\" name=\"__codelineno-2-14\" href=\"#__codelineno-2-14\"></a><span class=\"w\">    </span><span class=\"n\">pool_withdraw_queue</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-15\"><a id=\"__codelineno-2-15\" name=\"__codelineno-2-15\" href=\"#__codelineno-2-15\"></a><span class=\"w\">    </span><span class=\"n\">amm_target_orders</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-16\"><a id=\"__codelineno-2-16\" name=\"__codelineno-2-16\" href=\"#__codelineno-2-16\"></a><span class=\"w\">    </span><span class=\"n\">pool_temp_lp</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-17\"><a id=\"__codelineno-2-17\" name=\"__codelineno-2-17\" href=\"#__codelineno-2-17\"></a><span class=\"w\">    </span><span class=\"n\">serum_program</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-18\"><a id=\"__codelineno-2-18\" name=\"__codelineno-2-18\" href=\"#__codelineno-2-18\"></a><span class=\"w\">    </span><span class=\"n\">serum_market</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-19\"><a id=\"__codelineno-2-19\" name=\"__codelineno-2-19\" href=\"#__codelineno-2-19\"></a><span class=\"w\">    </span><span class=\"n\">user_wallet</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-20\"><a id=\"__codelineno-2-20\" name=\"__codelineno-2-20\" href=\"#__codelineno-2-20\"></a><span class=\"w\">    </span><span class=\"n\">user_token_coin</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-21\"><a id=\"__codelineno-2-21\" name=\"__codelineno-2-21\" href=\"#__codelineno-2-21\"></a><span class=\"w\">    </span><span class=\"n\">user_token_pc</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-22\"><a id=\"__codelineno-2-22\" name=\"__codelineno-2-22\" href=\"#__codelineno-2-22\"></a><span class=\"w\">    </span><span class=\"n\">user_lp_token_account</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Pubkey</span><span class=\"p\">,</span>\n</span><span id=\"__span-2-23\"><a id=\"__codelineno-2-23\" name=\"__codelineno-2-23\" href=\"#__codelineno-2-23\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>We create a new struct to hold the accounts in the <code>Initialize2</code> transaction. Not all accounts are necessary for swapping, but if you want to expand the functionality later, the <code>user_wallet</code> could be important for features like copy trading. The same goes for the standard programs used. I\u2019ve included them here to provide easier flexibility for future development.</p>\n<p>After that we implement two new functions for our struct get_transaction, and parse,</p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\"><code>get_transaction</code></p>\n</div>\n<div class=\"language-rust highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">get_transaction</span><span class=\"p\">(</span><span class=\"n\">tx</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Signature</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rpc_endpoint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">String</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"n\">RaydiumInitialize2Transaction</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RaydiumTransactionError</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-2\"><a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">client</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</span><span id=\"__span-3-3\"><a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a><span class=\"w\">        </span><span class=\"n\">RpcClient</span><span class=\"p\">::</span><span class=\"n\">new_with_commitment</span><span class=\"p\">(</span><span class=\"n\">rpc_endpoint</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">CommitmentConfig</span><span class=\"p\">::</span><span class=\"n\">processed</span><span class=\"p\">());</span>\n</span><span id=\"__span-3-4\"><a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a>\n</span><span id=\"__span-3-5\"><a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\" href=\"#__codelineno-3-5\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">config</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">RpcTransactionConfig</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-6\"><a id=\"__codelineno-3-6\" name=\"__codelineno-3-6\" href=\"#__codelineno-3-6\"></a><span class=\"w\">        </span><span class=\"n\">encoding</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"n\">UiTransactionEncoding</span><span class=\"p\">::</span><span class=\"n\">Binary</span><span class=\"p\">),</span>\n</span><span id=\"__span-3-7\"><a id=\"__codelineno-3-7\" name=\"__codelineno-3-7\" href=\"#__codelineno-3-7\"></a><span class=\"w\">        </span><span class=\"n\">commitment</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"n\">CommitmentConfig</span><span class=\"p\">::</span><span class=\"n\">processed</span><span class=\"p\">()),</span>\n</span><span id=\"__span-3-8\"><a id=\"__codelineno-3-8\" name=\"__codelineno-3-8\" href=\"#__codelineno-3-8\"></a><span class=\"w\">        </span><span class=\"n\">max_supported_transaction_version</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">),</span>\n</span><span id=\"__span-3-9\"><a id=\"__codelineno-3-9\" name=\"__codelineno-3-9\" href=\"#__codelineno-3-9\"></a><span class=\"w\">    </span><span class=\"p\">};</span>\n</span><span id=\"__span-3-10\"><a id=\"__codelineno-3-10\" name=\"__codelineno-3-10\" href=\"#__codelineno-3-10\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">transaction</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">client</span>\n</span><span id=\"__span-3-11\"><a id=\"__codelineno-3-11\" name=\"__codelineno-3-11\" href=\"#__codelineno-3-11\"></a><span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">get_transaction_with_config</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">tx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">config</span><span class=\"p\">)</span>\n</span><span id=\"__span-3-12\"><a id=\"__codelineno-3-12\" name=\"__codelineno-3-12\" href=\"#__codelineno-3-12\"></a><span class=\"w\">        </span><span class=\"p\">.</span><span class=\"k\">await</span>\n</span><span id=\"__span-3-13\"><a id=\"__codelineno-3-13\" name=\"__codelineno-3-13\" href=\"#__codelineno-3-13\"></a><span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">map_err</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"n\">_</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">RaydiumTransactionError</span><span class=\"p\">::</span><span class=\"n\">NoTransactionFound</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">;</span>\n</span><span id=\"__span-3-14\"><a id=\"__codelineno-3-14\" name=\"__codelineno-3-14\" href=\"#__codelineno-3-14\"></a>\n</span><span id=\"__span-3-15\"><a id=\"__codelineno-3-15\" name=\"__codelineno-3-15\" href=\"#__codelineno-3-15\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"n\">versioned_transaction</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">transaction</span><span class=\"p\">.</span><span class=\"n\">transaction</span><span class=\"p\">.</span><span class=\"n\">transaction</span><span class=\"p\">.</span><span class=\"n\">decode</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-3-16\"><a id=\"__codelineno-3-16\" name=\"__codelineno-3-16\" href=\"#__codelineno-3-16\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">RaydiumInitialize2Transaction</span><span class=\"p\">::</span><span class=\"n\">parse</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">versioned_transaction</span><span class=\"p\">)</span>\n</span><span id=\"__span-3-17\"><a id=\"__codelineno-3-17\" name=\"__codelineno-3-17\" href=\"#__codelineno-3-17\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-3-18\"><a id=\"__codelineno-3-18\" name=\"__codelineno-3-18\" href=\"#__codelineno-3-18\"></a>\n</span><span id=\"__span-3-19\"><a id=\"__codelineno-3-19\" name=\"__codelineno-3-19\" href=\"#__codelineno-3-19\"></a><span class=\"w\">    </span><span class=\"nb\">Err</span><span class=\"p\">(</span><span class=\"n\">RaydiumTransactionError</span><span class=\"p\">::</span><span class=\"n\">CouldNotParseTransaction</span><span class=\"p\">)</span>\n</span><span id=\"__span-3-20\"><a id=\"__codelineno-3-20\" name=\"__codelineno-3-20\" href=\"#__codelineno-3-20\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>We use Solana\u2019s <code>RpcClient</code>, specifically the non-blocking version. This is crucial because, later on, we will delve deeper into async behavior to decouple certain processes and distribute them across multiple CPU cores.</p>\n<p>Next, we create an <code>RpcTransactionConfig</code>, where we request binary encoding and a processed commitment. If we successfully find the transaction, we retrieve it using <code>client.get_transaction_with_config</code>. If the transaction is not found, the function will simply halt and return control back to the WebSocket stream, which will continue looking for new <code>initialize2</code> transactions.</p>\n<p>Finally, we decode the transaction into a <code>versioned_transaction</code> and pass it to our <code>parse</code> function.</p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\"><code>Parse</code></p>\n</div>\n<div class=\"language-rust highlight\"><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">parse</span><span class=\"p\">(</span><span class=\"n\">transaction</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kp\">&amp;</span><span class=\"nc\">VersionedTransaction</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"bp\">Self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RaydiumTransactionError</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-2\"><a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">keys</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">transaction</span><span class=\"p\">.</span><span class=\"n\">message</span><span class=\"p\">.</span><span class=\"n\">static_account_keys</span><span class=\"p\">();</span>\n</span><span id=\"__span-4-3\"><a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">keys</span><span class=\"p\">.</span><span class=\"n\">len</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"mi\">22</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-4\"><a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"nb\">Err</span><span class=\"p\">(</span><span class=\"n\">RaydiumTransactionError</span><span class=\"p\">::</span><span class=\"n\">NotEnoughKeys</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-5\"><a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\" href=\"#__codelineno-4-5\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-4-6\"><a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\" href=\"#__codelineno-4-6\"></a>\n</span><span id=\"__span-4-7\"><a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\" href=\"#__codelineno-4-7\"></a><span class=\"w\">    </span><span class=\"c1\">// Use to debug the order of the keys inputted, if something seems off</span>\n</span><span id=\"__span-4-8\"><a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\" href=\"#__codelineno-4-8\"></a><span class=\"w\">    </span><span class=\"cm\">/* for (index, solana_address) in keys.iter().enumerate() {</span>\n</span><span id=\"__span-4-9\"><a id=\"__codelineno-4-9\" name=\"__codelineno-4-9\" href=\"#__codelineno-4-9\"></a><span class=\"cm\">        debug!(&quot;{}: {}&quot;, index, solana_address);</span>\n</span><span id=\"__span-4-10\"><a id=\"__codelineno-4-10\" name=\"__codelineno-4-10\" href=\"#__codelineno-4-10\"></a><span class=\"cm\">    } */</span>\n</span><span id=\"__span-4-11\"><a id=\"__codelineno-4-11\" name=\"__codelineno-4-11\" href=\"#__codelineno-4-11\"></a>\n</span><span id=\"__span-4-12\"><a id=\"__codelineno-4-12\" name=\"__codelineno-4-12\" href=\"#__codelineno-4-12\"></a><span class=\"w\">    </span><span class=\"cm\">/* eval token addresses */</span>\n</span><span id=\"__span-4-13\"><a id=\"__codelineno-4-13\" name=\"__codelineno-4-13\" href=\"#__codelineno-4-13\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">base_coin</span><span class=\"p\">;</span>\n</span><span id=\"__span-4-14\"><a id=\"__codelineno-4-14\" name=\"__codelineno-4-14\" href=\"#__codelineno-4-14\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">token_coin</span><span class=\"p\">;</span>\n</span><span id=\"__span-4-15\"><a id=\"__codelineno-4-15\" name=\"__codelineno-4-15\" href=\"#__codelineno-4-15\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">keys</span><span class=\"p\">[</span><span class=\"mi\">13</span><span class=\"p\">].</span><span class=\"n\">to_string</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"s\">&quot;So11111111111111111111111111111111111111112&quot;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-16\"><a id=\"__codelineno-4-16\" name=\"__codelineno-4-16\" href=\"#__codelineno-4-16\"></a><span class=\"w\">        </span><span class=\"n\">base_coin</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">pubkey</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">&quot;So11111111111111111111111111111111111111112&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-17\"><a id=\"__codelineno-4-17\" name=\"__codelineno-4-17\" href=\"#__codelineno-4-17\"></a><span class=\"w\">        </span><span class=\"n\">token_coin</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">keys</span><span class=\"p\">[</span><span class=\"mi\">18</span><span class=\"p\">];</span>\n</span><span id=\"__span-4-18\"><a id=\"__codelineno-4-18\" name=\"__codelineno-4-18\" href=\"#__codelineno-4-18\"></a><span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">keys</span><span class=\"p\">[</span><span class=\"mi\">18</span><span class=\"p\">].</span><span class=\"n\">to_string</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"s\">&quot;So111111111111111111111111111111111111111111&quot;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-19\"><a id=\"__codelineno-4-19\" name=\"__codelineno-4-19\" href=\"#__codelineno-4-19\"></a><span class=\"w\">        </span><span class=\"n\">base_coin</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">pubkey</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">&quot;So11111111111111111111111111111111111111112&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-20\"><a id=\"__codelineno-4-20\" name=\"__codelineno-4-20\" href=\"#__codelineno-4-20\"></a><span class=\"w\">        </span><span class=\"n\">token_coin</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">keys</span><span class=\"p\">[</span><span class=\"mi\">13</span><span class=\"p\">];</span>\n</span><span id=\"__span-4-21\"><a id=\"__codelineno-4-21\" name=\"__codelineno-4-21\" href=\"#__codelineno-4-21\"></a><span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-22\"><a id=\"__codelineno-4-22\" name=\"__codelineno-4-22\" href=\"#__codelineno-4-22\"></a><span class=\"w\">        </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"nb\">Err</span><span class=\"p\">(</span><span class=\"n\">RaydiumTransactionError</span><span class=\"p\">::</span><span class=\"n\">CantFindTokenAddress</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-23\"><a id=\"__codelineno-4-23\" name=\"__codelineno-4-23\" href=\"#__codelineno-4-23\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-4-24\"><a id=\"__codelineno-4-24\" name=\"__codelineno-4-24\" href=\"#__codelineno-4-24\"></a>\n</span><span id=\"__span-4-25\"><a id=\"__codelineno-4-25\" name=\"__codelineno-4-25\" href=\"#__codelineno-4-25\"></a><span class=\"w\">    </span><span class=\"nb\">Ok</span><span class=\"p\">(</span><span class=\"n\">RaydiumInitialize2Transaction</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-26\"><a id=\"__codelineno-4-26\" name=\"__codelineno-4-26\" href=\"#__codelineno-4-26\"></a><span class=\"w\">        </span><span class=\"n\">token_program</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">12</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-27\"><a id=\"__codelineno-4-27\" name=\"__codelineno-4-27\" href=\"#__codelineno-4-27\"></a><span class=\"w\">        </span><span class=\"n\">spl_associated_token_account</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">16</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-28\"><a id=\"__codelineno-4-28\" name=\"__codelineno-4-28\" href=\"#__codelineno-4-28\"></a><span class=\"w\">        </span><span class=\"n\">system_program</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">11</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-29\"><a id=\"__codelineno-4-29\" name=\"__codelineno-4-29\" href=\"#__codelineno-4-29\"></a><span class=\"w\">        </span><span class=\"n\">rent_program</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">14</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-30\"><a id=\"__codelineno-4-30\" name=\"__codelineno-4-30\" href=\"#__codelineno-4-30\"></a><span class=\"w\">        </span><span class=\"n\">amm</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-31\"><a id=\"__codelineno-4-31\" name=\"__codelineno-4-31\" href=\"#__codelineno-4-31\"></a><span class=\"w\">        </span><span class=\"n\">amm_authority</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">17</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-32\"><a id=\"__codelineno-4-32\" name=\"__codelineno-4-32\" href=\"#__codelineno-4-32\"></a><span class=\"w\">        </span><span class=\"n\">amm_open_orders</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-33\"><a id=\"__codelineno-4-33\" name=\"__codelineno-4-33\" href=\"#__codelineno-4-33\"></a><span class=\"w\">        </span><span class=\"n\">lp_mint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-34\"><a id=\"__codelineno-4-34\" name=\"__codelineno-4-34\" href=\"#__codelineno-4-34\"></a><span class=\"w\">        </span><span class=\"n\">coin_mint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">base_coin</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-35\"><a id=\"__codelineno-4-35\" name=\"__codelineno-4-35\" href=\"#__codelineno-4-35\"></a><span class=\"w\">        </span><span class=\"n\">pc_mint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">token_coin</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-36\"><a id=\"__codelineno-4-36\" name=\"__codelineno-4-36\" href=\"#__codelineno-4-36\"></a><span class=\"w\">        </span><span class=\"n\">pool_coin_token_account</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">5</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-37\"><a id=\"__codelineno-4-37\" name=\"__codelineno-4-37\" href=\"#__codelineno-4-37\"></a><span class=\"w\">        </span><span class=\"n\">pool_pc_token_account</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">6</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-38\"><a id=\"__codelineno-4-38\" name=\"__codelineno-4-38\" href=\"#__codelineno-4-38\"></a><span class=\"w\">        </span><span class=\"n\">pool_withdraw_queue</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">7</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-39\"><a id=\"__codelineno-4-39\" name=\"__codelineno-4-39\" href=\"#__codelineno-4-39\"></a><span class=\"w\">        </span><span class=\"n\">amm_target_orders</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">19</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-40\"><a id=\"__codelineno-4-40\" name=\"__codelineno-4-40\" href=\"#__codelineno-4-40\"></a><span class=\"w\">        </span><span class=\"n\">pool_temp_lp</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">8</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-41\"><a id=\"__codelineno-4-41\" name=\"__codelineno-4-41\" href=\"#__codelineno-4-41\"></a><span class=\"w\">        </span><span class=\"n\">serum_program</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">20</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-42\"><a id=\"__codelineno-4-42\" name=\"__codelineno-4-42\" href=\"#__codelineno-4-42\"></a><span class=\"w\">        </span><span class=\"n\">serum_market</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">21</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-43\"><a id=\"__codelineno-4-43\" name=\"__codelineno-4-43\" href=\"#__codelineno-4-43\"></a><span class=\"w\">        </span><span class=\"n\">user_wallet</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-44\"><a id=\"__codelineno-4-44\" name=\"__codelineno-4-44\" href=\"#__codelineno-4-44\"></a><span class=\"w\">        </span><span class=\"n\">user_token_coin</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-45\"><a id=\"__codelineno-4-45\" name=\"__codelineno-4-45\" href=\"#__codelineno-4-45\"></a><span class=\"w\">        </span><span class=\"n\">user_token_pc</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">9</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-46\"><a id=\"__codelineno-4-46\" name=\"__codelineno-4-46\" href=\"#__codelineno-4-46\"></a><span class=\"w\">        </span><span class=\"n\">user_lp_token_account</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">keys</span><span class=\"p\">[</span><span class=\"mi\">10</span><span class=\"p\">],</span>\n</span><span id=\"__span-4-47\"><a id=\"__codelineno-4-47\" name=\"__codelineno-4-47\" href=\"#__codelineno-4-47\"></a><span class=\"w\">    </span><span class=\"p\">})</span>\n</span><span id=\"__span-4-48\"><a id=\"__codelineno-4-48\" name=\"__codelineno-4-48\" href=\"#__codelineno-4-48\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>We extract the accounts from the transaction and verify that it contains exactly 22 accounts. We also check that an SPL token, such as WSOL, is used. There are different ways to create a token on Raydium, so we perform minimal validation to ensure the input matches the expected format. While more extensive validation could (and probably should) be implemented, every millisecond counts, so we keep it minimal\u2014especially since this is a core route from discovering to sniping a token.Finally we also implement fmt::Display, this is simply to control the output when we print or log our initialize2 struct.</p>\n<figure>\n<p><img alt=\"CLI output of token addresses\" src=\"/static/raydium_sniper_part_3/Screenshot 2025-01-19 at 14.48.10.png\" /></p>\n<figcaption>\n<p>CLI output of token addresses</p>\n</figcaption>\n</figure>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Create the file utils/src/raydium/mod.rs with the below line</p>\n</div>\n<div class=\"language-rust highlight\"><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">mod</span><span class=\"w\"> </span><span class=\"nn\">initialize2</span><span class=\"p\">;</span>\n</span></code></pre></div>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Add the new module raydium to utils/src/lib.rs</p>\n</div>\n<div class=\"language-rust highlight\"><pre><span></span><code><span id=\"__span-6-1\"><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">mod</span><span class=\"w\"> </span><span class=\"nn\">raydium</span><span class=\"p\">;</span>\n</span></code></pre></div>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Let\u2019s update the <code>start_thread</code> function in <code>sniper/src/oracle/websocket.rs</code> to use the new transaction parser. We will modify the function as follows:</p>\n</div>\n<div class=\"language-rust highlight\"><pre><span></span><code><span id=\"__span-7-1\"><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">start_thread</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-7-2\"><a id=\"__codelineno-7-2\" name=\"__codelineno-7-2\" href=\"#__codelineno-7-2\"></a><span class=\"w\">        </span><span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">&quot;Starting Solana websocket subscriber&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-7-3\"><a id=\"__codelineno-7-3\" name=\"__codelineno-7-3\" href=\"#__codelineno-7-3\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">subscribe_to</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">subscribe_to</span><span class=\"p\">.</span><span class=\"n\">clone</span><span class=\"p\">();</span>\n</span><span id=\"__span-7-4\"><a id=\"__codelineno-7-4\" name=\"__codelineno-7-4\" href=\"#__codelineno-7-4\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">config_level</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">config_level</span><span class=\"p\">.</span><span class=\"n\">clone</span><span class=\"p\">();</span>\n</span><span id=\"__span-7-5\"><a id=\"__codelineno-7-5\" name=\"__codelineno-7-5\" href=\"#__codelineno-7-5\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">rpc_endpoint</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">rpc_endpoint</span><span class=\"p\">.</span><span class=\"n\">clone</span><span class=\"p\">();</span>\n</span><span id=\"__span-7-6\"><a id=\"__codelineno-7-6\" name=\"__codelineno-7-6\" href=\"#__codelineno-7-6\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">stream</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">client</span><span class=\"p\">.</span><span class=\"n\">logs_subscribe</span><span class=\"p\">(</span>\n</span><span id=\"__span-7-7\"><a id=\"__codelineno-7-7\" name=\"__codelineno-7-7\" href=\"#__codelineno-7-7\"></a><span class=\"w\">            </span><span class=\"n\">RpcTransactionLogsFilter</span><span class=\"p\">::</span><span class=\"n\">Mentions</span><span class=\"p\">(</span>\n</span><span id=\"__span-7-8\"><a id=\"__codelineno-7-8\" name=\"__codelineno-7-8\" href=\"#__codelineno-7-8\"></a><span class=\"w\">                </span><span class=\"n\">subscribe_to</span>\n</span><span id=\"__span-7-9\"><a id=\"__codelineno-7-9\" name=\"__codelineno-7-9\" href=\"#__codelineno-7-9\"></a><span class=\"w\">            </span><span class=\"p\">),</span>\n</span><span id=\"__span-7-10\"><a id=\"__codelineno-7-10\" name=\"__codelineno-7-10\" href=\"#__codelineno-7-10\"></a><span class=\"w\">            </span><span class=\"n\">RpcTransactionLogsConfig</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-7-11\"><a id=\"__codelineno-7-11\" name=\"__codelineno-7-11\" href=\"#__codelineno-7-11\"></a><span class=\"w\">                </span><span class=\"n\">commitment</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"n\">config_level</span><span class=\"p\">),</span>\n</span><span id=\"__span-7-12\"><a id=\"__codelineno-7-12\" name=\"__codelineno-7-12\" href=\"#__codelineno-7-12\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n</span><span id=\"__span-7-13\"><a id=\"__codelineno-7-13\" name=\"__codelineno-7-13\" href=\"#__codelineno-7-13\"></a><span class=\"w\">        </span><span class=\"p\">).</span><span class=\"k\">await</span><span class=\"p\">.</span><span class=\"n\">expect</span><span class=\"p\">(</span><span class=\"s\">&quot;Failed to subscribe to Logs!&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-7-14\"><a id=\"__codelineno-7-14\" name=\"__codelineno-7-14\" href=\"#__codelineno-7-14\"></a>\n</span><span id=\"__span-7-15\"><a id=\"__codelineno-7-15\" name=\"__codelineno-7-15\" href=\"#__codelineno-7-15\"></a><span class=\"w\">        </span><span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">&quot;Waiting for next event&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-7-16\"><a id=\"__codelineno-7-16\" name=\"__codelineno-7-16\" href=\"#__codelineno-7-16\"></a><span class=\"w\">        </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">stream</span><span class=\"p\">.</span><span class=\"n\">next</span><span class=\"p\">().</span><span class=\"k\">await</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-7-17\"><a id=\"__codelineno-7-17\" name=\"__codelineno-7-17\" href=\"#__codelineno-7-17\"></a>\n</span><span id=\"__span-7-18\"><a id=\"__codelineno-7-18\" name=\"__codelineno-7-18\" href=\"#__codelineno-7-18\"></a><span class=\"w\">            </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">response</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">.</span><span class=\"n\">logs</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-7-19\"><a id=\"__codelineno-7-19\" name=\"__codelineno-7-19\" href=\"#__codelineno-7-19\"></a><span class=\"w\">                </span><span class=\"cm\">/* skip all events that does not contain initialize2 eg token create */</span>\n</span><span id=\"__span-7-20\"><a id=\"__codelineno-7-20\" name=\"__codelineno-7-20\" href=\"#__codelineno-7-20\"></a><span class=\"w\">                </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">!</span><span class=\"n\">log</span><span class=\"p\">.</span><span class=\"n\">contains</span><span class=\"p\">(</span><span class=\"s\">&quot;initialize2&quot;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-7-21\"><a id=\"__codelineno-7-21\" name=\"__codelineno-7-21\" href=\"#__codelineno-7-21\"></a><span class=\"w\">                    </span><span class=\"k\">continue</span>\n</span><span id=\"__span-7-22\"><a id=\"__codelineno-7-22\" name=\"__codelineno-7-22\" href=\"#__codelineno-7-22\"></a><span class=\"w\">                </span><span class=\"p\">}</span>\n</span><span id=\"__span-7-23\"><a id=\"__codelineno-7-23\" name=\"__codelineno-7-23\" href=\"#__codelineno-7-23\"></a><span class=\"w\">                </span><span class=\"p\">{</span>\n</span><span id=\"__span-7-24\"><a id=\"__codelineno-7-24\" name=\"__codelineno-7-24\" href=\"#__codelineno-7-24\"></a><span class=\"w\">                    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">tx</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Signature</span><span class=\"p\">::</span><span class=\"n\">from_str</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">.</span><span class=\"n\">value</span><span class=\"p\">.</span><span class=\"n\">signature</span><span class=\"p\">.</span><span class=\"n\">as_str</span><span class=\"p\">()).</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n</span><span id=\"__span-7-25\"><a id=\"__codelineno-7-25\" name=\"__codelineno-7-25\" href=\"#__codelineno-7-25\"></a><span class=\"w\">                    </span><span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">&quot;Received tx https://solscan.io/tx/{}&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">tx</span><span class=\"p\">);</span>\n</span><span id=\"__span-7-26\"><a id=\"__codelineno-7-26\" name=\"__codelineno-7-26\" href=\"#__codelineno-7-26\"></a><span class=\"w\">                    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">transaction</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">RaydiumInitialize2Transaction</span><span class=\"p\">::</span><span class=\"n\">get_transaction</span><span class=\"p\">(</span><span class=\"n\">tx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rpc_endpoint</span><span class=\"p\">.</span><span class=\"n\">clone</span><span class=\"p\">()).</span><span class=\"k\">await</span><span class=\"p\">;</span>\n</span><span id=\"__span-7-27\"><a id=\"__codelineno-7-27\" name=\"__codelineno-7-27\" href=\"#__codelineno-7-27\"></a>\n</span><span id=\"__span-7-28\"><a id=\"__codelineno-7-28\" name=\"__codelineno-7-28\" href=\"#__codelineno-7-28\"></a><span class=\"w\">                    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">transaction</span><span class=\"p\">.</span><span class=\"n\">is_err</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-7-29\"><a id=\"__codelineno-7-29\" name=\"__codelineno-7-29\" href=\"#__codelineno-7-29\"></a><span class=\"w\">                        </span><span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">&quot;Failed to get transaction&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-7-30\"><a id=\"__codelineno-7-30\" name=\"__codelineno-7-30\" href=\"#__codelineno-7-30\"></a><span class=\"w\">                    </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-7-31\"><a id=\"__codelineno-7-31\" name=\"__codelineno-7-31\" href=\"#__codelineno-7-31\"></a><span class=\"w\">                        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">initialize2_transaction</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">transaction</span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n</span><span id=\"__span-7-32\"><a id=\"__codelineno-7-32\" name=\"__codelineno-7-32\" href=\"#__codelineno-7-32\"></a><span class=\"w\">                        </span><span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">&quot;====={}=====</span><span class=\"se\">\\r\\n</span><span class=\"s\">{}&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">initialize2_transaction</span><span class=\"p\">.</span><span class=\"n\">get_mint</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">initialize2_transaction</span><span class=\"p\">);</span>\n</span><span id=\"__span-7-33\"><a id=\"__codelineno-7-33\" name=\"__codelineno-7-33\" href=\"#__codelineno-7-33\"></a><span class=\"w\">                    </span><span class=\"p\">}</span>\n</span><span id=\"__span-7-34\"><a id=\"__codelineno-7-34\" name=\"__codelineno-7-34\" href=\"#__codelineno-7-34\"></a><span class=\"w\">                </span><span class=\"p\">}</span>\n</span><span id=\"__span-7-35\"><a id=\"__codelineno-7-35\" name=\"__codelineno-7-35\" href=\"#__codelineno-7-35\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n</span><span id=\"__span-7-36\"><a id=\"__codelineno-7-36\" name=\"__codelineno-7-36\" href=\"#__codelineno-7-36\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n</span></code></pre></div>\n<div class=\"admonition warning\">\n<p class=\"admonition-title\">Notice the</p>\n</div>\n<div class=\"language-rust highlight\"><pre><span></span><code><span id=\"__span-8-1\"><a id=\"__codelineno-8-1\" name=\"__codelineno-8-1\" href=\"#__codelineno-8-1\"></a><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">transaction</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">RaydiumInitialize2Transaction</span><span class=\"p\">::</span><span class=\"n\">get_transaction</span><span class=\"p\">(</span><span class=\"n\">tx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rpc_endpoint</span><span class=\"p\">.</span><span class=\"n\">clone</span><span class=\"p\">()).</span><span class=\"k\">await</span><span class=\"p\">;</span>\n</span><span id=\"__span-8-2\"><a id=\"__codelineno-8-2\" name=\"__codelineno-8-2\" href=\"#__codelineno-8-2\"></a>\n</span><span id=\"__span-8-3\"><a id=\"__codelineno-8-3\" name=\"__codelineno-8-3\" href=\"#__codelineno-8-3\"></a><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">transaction</span><span class=\"p\">.</span><span class=\"n\">is_err</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-8-4\"><a id=\"__codelineno-8-4\" name=\"__codelineno-8-4\" href=\"#__codelineno-8-4\"></a><span class=\"w\">    </span><span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">&quot;Failed to get transaction&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-8-5\"><a id=\"__codelineno-8-5\" name=\"__codelineno-8-5\" href=\"#__codelineno-8-5\"></a><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-8-6\"><a id=\"__codelineno-8-6\" name=\"__codelineno-8-6\" href=\"#__codelineno-8-6\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">initialize2_transaction</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">transaction</span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">();</span>\n</span><span id=\"__span-8-7\"><a id=\"__codelineno-8-7\" name=\"__codelineno-8-7\" href=\"#__codelineno-8-7\"></a><span class=\"w\">    </span><span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">&quot;====={}=====</span><span class=\"se\">\\r\\n</span><span class=\"s\">{}&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">initialize2_transaction</span><span class=\"p\">.</span><span class=\"n\">get_mint</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">initialize2_transaction</span><span class=\"p\">);</span>\n</span><span id=\"__span-8-8\"><a id=\"__codelineno-8-8\" name=\"__codelineno-8-8\" href=\"#__codelineno-8-8\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>Here, we simply call our new <code>get_transaction</code> method. If the transaction is ready, we print it to ensure that we have everything needed for the swap transaction.</p>\n<p>Update sniper/Cargo.toml with <code>solana-sdk</code> and <code>solana-transaction-status</code> dependencies</p>\n<div class=\"language-toml highlight\"><pre><span></span><code><span id=\"__span-9-1\"><a id=\"__codelineno-9-1\" name=\"__codelineno-9-1\" href=\"#__codelineno-9-1\"></a><span class=\"k\">[...]</span>\n</span><span id=\"__span-9-2\"><a id=\"__codelineno-9-2\" name=\"__codelineno-9-2\" href=\"#__codelineno-9-2\"></a><span class=\"k\">[dependencies]</span>\n</span><span id=\"__span-9-3\"><a id=\"__codelineno-9-3\" name=\"__codelineno-9-3\" href=\"#__codelineno-9-3\"></a><span class=\"n\">utils</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-9-4\"><a id=\"__codelineno-9-4\" name=\"__codelineno-9-4\" href=\"#__codelineno-9-4\"></a><span class=\"n\">solana-client</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-9-5\"><a id=\"__codelineno-9-5\" name=\"__codelineno-9-5\" href=\"#__codelineno-9-5\"></a><span class=\"n\">solana-sdk</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"p\">}</span>\n</span><span id=\"__span-9-6\"><a id=\"__codelineno-9-6\" name=\"__codelineno-9-6\" href=\"#__codelineno-9-6\"></a><span class=\"n\">tokio</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-9-7\"><a id=\"__codelineno-9-7\" name=\"__codelineno-9-7\" href=\"#__codelineno-9-7\"></a><span class=\"n\">futures</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-9-8\"><a id=\"__codelineno-9-8\" name=\"__codelineno-9-8\" href=\"#__codelineno-9-8\"></a><span class=\"n\">log</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>Thats it, lets take it for at test run!</p>\n<figure>\n<p><img alt=\"CLI output of token addresses with ms timings\" src=\"/static/raydium_sniper_part_3/Screenshot 2025-01-19 at 15.10.12.png\" /></p>\n<figcaption>\n<p>CLI output of token addresses with ms timings</p>\n</figcaption>\n</figure>\n<h3 id=\"stability\">Stability</h3>\n<p>Is the current method stable? Not quite. We use \u201cProcessed\u201d in both the WebSocket stream and RPC transaction fetch, but the RPC often lags behind the WebSocket stream, causing the program to fail. There are several ways to mitigate this, though none are covered in this article. You could set the commitment status to \u201cConfirmed\u201d and discover it a second later, or retry for a few seconds before aborting.</p>\n<h2 id=\"up-next\">Up next</h2>\n<p>In the next article, we will look into how to change our SOL to WSOL, which is needed for swapping, we will do this with a command line layer.</p>", "image": null, "date_modified": "2025-02-06T13:06:57+00:00", "authors": [{"name": "Alexander H\u00f8gh"}], "tags": ["Solana", "Solana Sniper"]}, {"id": "https://helius.dk/blog/2025/01/06/writing-a-raydium-sniper-in-rust/", "url": "https://helius.dk/blog/2025/01/06/writing-a-raydium-sniper-in-rust/", "title": "Writing a Raydium sniper in Rust", "content_html": "<p><img alt=\"AI generated image of a Robot doing graph analysis\" src=\"/static/raydium_sniper_part_1/robot_analysis.png\" /></p>\n<h1 id=\"writing-a-solana-raydium-sniper-in-rust\">Writing a Solana Raydium sniper in Rust</h1>\n<p>If sniping positions are important to you, Rust or any compiled language is essential for peeling off every possible millisecond. This stands in contrast to the more traditional sniping language, JavaScript, which is interpreted and therefore inherently slower than a compiled language.</p>\n<p>This is a story about how I discovered sites like Dexscreener, stayed up all night trying to turn a profit on those impressive +10,000% gain tokens through manual trades, and eventually ended up coding my own sniper. Starting with Python and later transitioning to Rust, I was able to consistently rank among the top 10 snipes for any new AMM token on Raydium.</p>\n<!-- more -->\n\n<h2 id=\"what-to-expect\">What to expect</h2>\n<p>This series of articles will be released as I find time to write them. After each release, I will update the associated <a href=\"https://github.com/weestack/Solana-Sniper\">GitHub repository here</a>, with the latest code. This also means, the sniper will be released in small chunks.</p>\n<p>So, when will it all be available? Honestly, I don\u2019t know yet. Ideas often evolve over time, and while I already have the final code in a private repository, I might come up with improvements or ways to make it more user-friendly as this series progresses.</p>\n<p>I\u2019m not a Rust expert, I\u2019ve only been working with the language for a little over six months. I initially learned Rust with the goal of building my Solana sniper bot. Since then, I\u2019ve developed a passion for the language and have started using it for various other projects.</p>\n<h2 id=\"about-me\">About me</h2>\n<p>By now, you might be wondering about my experience as a programmer, so here\u2019s a brief (and maybe slightly boring) overview. \ud83d\ude09</p>\n<p>I am a Senior DevOps Engineer in my early thirties. I started with Linux hosting at the age of 15 and, by 25, had freelanced for over 80 companies across Denmark, Norway, and the USA, specializing in e-commerce and operations. Today, I work full-time as a Senior DevOps Engineer, contributing to some of Denmark\u2019s largest e-commerce ventures. My responsibilities include serving as a tech lead on large projects, mentoring new developers, and managing operations and security for over 100 dedicated servers and numerous cloud instances.</p>\n<p>In 2024, I became captivated by the world of crypto and quickly immersed myself in quantitative trading. I turned a profit using strategies like RSI, Top and Bottom patterns, Harmonic patterns, and more. Midway through 2024, I delved deeper into blockchain technologies. When I discovered DexScreener with its incredible +10,000% gains, I was determined to compete with the veterans and snipe faster than anyone else. Three months later, I succeeded in consistently ranking among the top 10, and often the top 5, in snipes.</p>\n<p>This article will chronicle my amazing adventure and the lessons I learned along the way.</p>\n<h2 id=\"prerequisites\">Prerequisites</h2>\n<p>To follow along with this series, you should have some experience in Rust or at least a few years of programming experience in any language. The explanations will assume familiarity with basic programming concepts, as well as the ability to compile and use Rust programs.</p>\n<p>If you have suggestions for improvements, feel free to reach out to me at <a href=\"https://t.me/weestack\">https://t.me/weestack</a>.</p>\n<h2 id=\"disclaimer\">Disclaimer</h2>\n<p>The information provided in this series of articles is for educational purposes only and should not be considered financial or investment advice. Trading, including sniping tokens, carries significant risks, and there is no guarantee of profit.</p>\n<p>Any decisions you make based on the content shared here are solely your responsibility. I am not liable for any financial losses incurred as a result of implementing the strategies, code, or techniques discussed in these articles.</p>\n<p>Always trade responsibly. Never risk more money than you can afford to lose. It is essential to conduct your own research and consult with a professional financial advisor if necessary before engaging in any trading activities.</p>\n<h2 id=\"getting-our-hands-dirty\">Getting our hands dirty</h2>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Creating the base structure</p>\n</div>\n<div class=\"language-bash highlight\"><pre><span></span><code><span id=\"__span-0-1\"><a id=\"__codelineno-0-1\" name=\"__codelineno-0-1\" href=\"#__codelineno-0-1\"></a>mkdir<span class=\"w\"> </span>Solana-Sniper\n</span><span id=\"__span-0-2\"><a id=\"__codelineno-0-2\" name=\"__codelineno-0-2\" href=\"#__codelineno-0-2\"></a><span class=\"nb\">cd</span><span class=\"w\"> </span>Solana-Sniper\n</span><span id=\"__span-0-3\"><a id=\"__codelineno-0-3\" name=\"__codelineno-0-3\" href=\"#__codelineno-0-3\"></a>touch<span class=\"w\"> </span>Cargo.toml\n</span><span id=\"__span-0-4\"><a id=\"__codelineno-0-4\" name=\"__codelineno-0-4\" href=\"#__codelineno-0-4\"></a>cargo<span class=\"w\"> </span>new<span class=\"w\"> </span>sniper\n</span></code></pre></div>\n<p>For those familiar with Rust, we\u2019re not just creating a single binary. Instead, we\u2019ll be building multiple binaries along with a shared library that connects them. I chose this structure for its flexibility and ease of use. In my case, it allowed me to manage a command suite, sniper, algorithmic trader, and a shared library, all working seamlessly together. This modular approach makes it easier to maintain and expand the project in the future.</p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Adding the root <code>Cargo.toml</code></p>\n</div>\n<div class=\"language-toml highlight\"><pre><span></span><code><span id=\"__span-1-1\"><a id=\"__codelineno-1-1\" name=\"__codelineno-1-1\" href=\"#__codelineno-1-1\"></a><span class=\"k\">[workspace]</span>\n</span><span id=\"__span-1-2\"><a id=\"__codelineno-1-2\" name=\"__codelineno-1-2\" href=\"#__codelineno-1-2\"></a><span class=\"n\">resolver</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;2&quot;</span>\n</span><span id=\"__span-1-3\"><a id=\"__codelineno-1-3\" name=\"__codelineno-1-3\" href=\"#__codelineno-1-3\"></a><span class=\"n\">members</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span>\n</span><span id=\"__span-1-4\"><a id=\"__codelineno-1-4\" name=\"__codelineno-1-4\" href=\"#__codelineno-1-4\"></a><span class=\"w\">    </span><span class=\"s2\">&quot;sniper&quot;</span>\n</span><span id=\"__span-1-5\"><a id=\"__codelineno-1-5\" name=\"__codelineno-1-5\" href=\"#__codelineno-1-5\"></a><span class=\"p\">]</span>\n</span><span id=\"__span-1-6\"><a id=\"__codelineno-1-6\" name=\"__codelineno-1-6\" href=\"#__codelineno-1-6\"></a>\n</span><span id=\"__span-1-7\"><a id=\"__codelineno-1-7\" name=\"__codelineno-1-7\" href=\"#__codelineno-1-7\"></a><span class=\"k\">[workspace.package]</span>\n</span><span id=\"__span-1-8\"><a id=\"__codelineno-1-8\" name=\"__codelineno-1-8\" href=\"#__codelineno-1-8\"></a><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;Solana-Sniper&quot;</span>\n</span><span id=\"__span-1-9\"><a id=\"__codelineno-1-9\" name=\"__codelineno-1-9\" href=\"#__codelineno-1-9\"></a><span class=\"n\">authors</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">&quot;Alexander H\u00f8gh&quot;</span><span class=\"p\">]</span>\n</span><span id=\"__span-1-10\"><a id=\"__codelineno-1-10\" name=\"__codelineno-1-10\" href=\"#__codelineno-1-10\"></a><span class=\"n\">edition</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;2021&quot;</span>\n</span><span id=\"__span-1-11\"><a id=\"__codelineno-1-11\" name=\"__codelineno-1-11\" href=\"#__codelineno-1-11\"></a><span class=\"n\">homepage</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;&quot;</span>\n</span><span id=\"__span-1-12\"><a id=\"__codelineno-1-12\" name=\"__codelineno-1-12\" href=\"#__codelineno-1-12\"></a><span class=\"n\">repository</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;https://github.com/weestack/Solana-Sniper&quot;</span>\n</span><span id=\"__span-1-13\"><a id=\"__codelineno-1-13\" name=\"__codelineno-1-13\" href=\"#__codelineno-1-13\"></a><span class=\"n\">license</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;MIT&quot;</span>\n</span><span id=\"__span-1-14\"><a id=\"__codelineno-1-14\" name=\"__codelineno-1-14\" href=\"#__codelineno-1-14\"></a><span class=\"n\">keywords</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">&quot;solana&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">&quot;sniper&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">&quot;wsol&quot;</span><span class=\"p\">]</span>\n</span><span id=\"__span-1-15\"><a id=\"__codelineno-1-15\" name=\"__codelineno-1-15\" href=\"#__codelineno-1-15\"></a><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;0.1.0&quot;</span>\n</span><span id=\"__span-1-16\"><a id=\"__codelineno-1-16\" name=\"__codelineno-1-16\" href=\"#__codelineno-1-16\"></a><span class=\"n\">readme</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;README.md&quot;</span>\n</span><span id=\"__span-1-17\"><a id=\"__codelineno-1-17\" name=\"__codelineno-1-17\" href=\"#__codelineno-1-17\"></a><span class=\"n\">categories</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">&quot;science&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">&quot;algorithms&quot;</span><span class=\"p\">]</span>\n</span><span id=\"__span-1-18\"><a id=\"__codelineno-1-18\" name=\"__codelineno-1-18\" href=\"#__codelineno-1-18\"></a><span class=\"n\">publish</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span>\n</span><span id=\"__span-1-19\"><a id=\"__codelineno-1-19\" name=\"__codelineno-1-19\" href=\"#__codelineno-1-19\"></a>\n</span><span id=\"__span-1-20\"><a id=\"__codelineno-1-20\" name=\"__codelineno-1-20\" href=\"#__codelineno-1-20\"></a><span class=\"k\">[workspace.lints.clippy]</span>\n</span><span id=\"__span-1-21\"><a id=\"__codelineno-1-21\" name=\"__codelineno-1-21\" href=\"#__codelineno-1-21\"></a><span class=\"n\">clone_on_ref_ptr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;deny&quot;</span>\n</span><span id=\"__span-1-22\"><a id=\"__codelineno-1-22\" name=\"__codelineno-1-22\" href=\"#__codelineno-1-22\"></a><span class=\"n\">missing_const_for_fn</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;deny&quot;</span>\n</span><span id=\"__span-1-23\"><a id=\"__codelineno-1-23\" name=\"__codelineno-1-23\" href=\"#__codelineno-1-23\"></a><span class=\"n\">trivially_copy_pass_by_ref</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;deny&quot;</span>\n</span><span id=\"__span-1-24\"><a id=\"__codelineno-1-24\" name=\"__codelineno-1-24\" href=\"#__codelineno-1-24\"></a>\n</span><span id=\"__span-1-25\"><a id=\"__codelineno-1-25\" name=\"__codelineno-1-25\" href=\"#__codelineno-1-25\"></a><span class=\"k\">[profile.release]</span>\n</span><span id=\"__span-1-26\"><a id=\"__codelineno-1-26\" name=\"__codelineno-1-26\" href=\"#__codelineno-1-26\"></a><span class=\"n\">lto</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span>\n</span><span id=\"__span-1-27\"><a id=\"__codelineno-1-27\" name=\"__codelineno-1-27\" href=\"#__codelineno-1-27\"></a><span class=\"n\">codegen-units</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n</span></code></pre></div>\n<p>In the <code>Cargo.toml</code>, we will define all the required dependencies. These dependencies will be inherited on a per-need basis in the different binaries, ensuring each component only includes the necessary libraries and modules for optimal performance and maintainability.</p>\n<p>You should now have a project that matches structure in the image below(Minus the .gitignore, LICENSE and README.md)</p>\n<figure>\n<p><img alt=\"Picture of worktree after cargo new sniper command\" src=\"/static/raydium_sniper_part_1/Screenshot 2025-01-05 at 22.19.01.png\" /></p>\n<figcaption>\n<p>Our worktree after <code>cargo new sniper</code></p>\n</figcaption>\n</figure>\n<h2 id=\"accepting-variables-from-a-env-file\">Accepting variables from a .env file</h2>\n<p>The first step is to create a secure and convenient way to store important variables for our sniper, such as paid RPC and WSS connections, private keys, snipe amounts, fee amounts, and other data. For security reasons, we should avoid adding this information to Git. This will be handled in the shared library mentioned earlier.</p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">Creating files for our library</p>\n</div>\n<div class=\"language-bash highlight\"><pre><span></span><code><span id=\"__span-2-1\"><a id=\"__codelineno-2-1\" name=\"__codelineno-2-1\" href=\"#__codelineno-2-1\"></a>cargo<span class=\"w\"> </span>new<span class=\"w\"> </span>--lib<span class=\"w\"> </span>utils\n</span><span id=\"__span-2-2\"><a id=\"__codelineno-2-2\" name=\"__codelineno-2-2\" href=\"#__codelineno-2-2\"></a>sed<span class=\"w\"> </span>-i<span class=\"w\"> </span>-e<span class=\"w\"> </span><span class=\"s1\">&#39;s/name.workspace = true/name = &quot;utils&quot;/g&#39;</span><span class=\"w\"> </span>utils/Cargo.toml\n</span><span id=\"__span-2-3\"><a id=\"__codelineno-2-3\" name=\"__codelineno-2-3\" href=\"#__codelineno-2-3\"></a>mkdir<span class=\"w\"> </span>-p<span class=\"w\"> </span>utils/src/env<span class=\"w\"> </span>\n</span><span id=\"__span-2-4\"><a id=\"__codelineno-2-4\" name=\"__codelineno-2-4\" href=\"#__codelineno-2-4\"></a>touch<span class=\"w\"> </span>utils/src/env/mod.rs\n</span><span id=\"__span-2-5\"><a id=\"__codelineno-2-5\" name=\"__codelineno-2-5\" href=\"#__codelineno-2-5\"></a>touch<span class=\"w\"> </span>utils/src/env/env.rs\n</span><span id=\"__span-2-6\"><a id=\"__codelineno-2-6\" name=\"__codelineno-2-6\" href=\"#__codelineno-2-6\"></a>touch<span class=\"w\"> </span>utils/src/env/errors.rs\n</span></code></pre></div>\n<p>Using the above steps, we create a new library package, rename it to \u201cutils,\u201d and add a folder named <code>env</code>. Inside the folder, we include <code>mod.rs</code>, <code>env.rs</code>, and <code>errors.rs</code> files.</p>\n<p>Before proceeding with any coding, add the following dependencies to the respective <code>Cargo.toml</code> files to ensure everything is set up.</p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">root <code>Cargo.toml</code></p>\n</div>\n<p>Inside the root folders Cargo.toml, make these updates\n<div class=\"language-toml highlight\"><pre><span></span><code><span id=\"__span-3-1\"><a id=\"__codelineno-3-1\" name=\"__codelineno-3-1\" href=\"#__codelineno-3-1\"></a><span class=\"c1\">#Cargo.toml (root Cargo.toml)</span>\n</span><span id=\"__span-3-2\"><a id=\"__codelineno-3-2\" name=\"__codelineno-3-2\" href=\"#__codelineno-3-2\"></a><span class=\"k\">[...]</span>\n</span><span id=\"__span-3-3\"><a id=\"__codelineno-3-3\" name=\"__codelineno-3-3\" href=\"#__codelineno-3-3\"></a><span class=\"k\">[workspace.dependencies]</span>\n</span><span id=\"__span-3-4\"><a id=\"__codelineno-3-4\" name=\"__codelineno-3-4\" href=\"#__codelineno-3-4\"></a><span class=\"n\">utils</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;utils&quot;</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-3-5\"><a id=\"__codelineno-3-5\" name=\"__codelineno-3-5\" href=\"#__codelineno-3-5\"></a><span class=\"n\">dotenv</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;0.15.0&quot;</span>\n</span><span id=\"__span-3-6\"><a id=\"__codelineno-3-6\" name=\"__codelineno-3-6\" href=\"#__codelineno-3-6\"></a><span class=\"n\">thiserror</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;2.0.9&quot;</span>\n</span><span id=\"__span-3-7\"><a id=\"__codelineno-3-7\" name=\"__codelineno-3-7\" href=\"#__codelineno-3-7\"></a><span class=\"n\">solana-client</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;2.1.7&quot;</span>\n</span><span id=\"__span-3-8\"><a id=\"__codelineno-3-8\" name=\"__codelineno-3-8\" href=\"#__codelineno-3-8\"></a><span class=\"n\">solana-program</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;2.1.7&quot;</span>\n</span><span id=\"__span-3-9\"><a id=\"__codelineno-3-9\" name=\"__codelineno-3-9\" href=\"#__codelineno-3-9\"></a><span class=\"n\">solana-sdk</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;2.1.7&quot;</span>\n</span><span id=\"__span-3-10\"><a id=\"__codelineno-3-10\" name=\"__codelineno-3-10\" href=\"#__codelineno-3-10\"></a><span class=\"n\">tokio</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">&quot;1.42.0&quot;</span>\n</span><span id=\"__span-3-11\"><a id=\"__codelineno-3-11\" name=\"__codelineno-3-11\" href=\"#__codelineno-3-11\"></a><span class=\"k\">[...]</span>\n</span><span id=\"__span-3-12\"><a id=\"__codelineno-3-12\" name=\"__codelineno-3-12\" href=\"#__codelineno-3-12\"></a>\n</span><span id=\"__span-3-13\"><a id=\"__codelineno-3-13\" name=\"__codelineno-3-13\" href=\"#__codelineno-3-13\"></a>\n</span><span id=\"__span-3-14\"><a id=\"__codelineno-3-14\" name=\"__codelineno-3-14\" href=\"#__codelineno-3-14\"></a><span class=\"c1\">#sniper/cargo.toml</span>\n</span><span id=\"__span-3-15\"><a id=\"__codelineno-3-15\" name=\"__codelineno-3-15\" href=\"#__codelineno-3-15\"></a><span class=\"k\">[...]</span>\n</span><span id=\"__span-3-16\"><a id=\"__codelineno-3-16\" name=\"__codelineno-3-16\" href=\"#__codelineno-3-16\"></a><span class=\"k\">[dependencies]</span>\n</span><span id=\"__span-3-17\"><a id=\"__codelineno-3-17\" name=\"__codelineno-3-17\" href=\"#__codelineno-3-17\"></a><span class=\"n\">utils</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-3-18\"><a id=\"__codelineno-3-18\" name=\"__codelineno-3-18\" href=\"#__codelineno-3-18\"></a><span class=\"k\">[...]</span>\n</span><span id=\"__span-3-19\"><a id=\"__codelineno-3-19\" name=\"__codelineno-3-19\" href=\"#__codelineno-3-19\"></a>\n</span><span id=\"__span-3-20\"><a id=\"__codelineno-3-20\" name=\"__codelineno-3-20\" href=\"#__codelineno-3-20\"></a>\n</span><span id=\"__span-3-21\"><a id=\"__codelineno-3-21\" name=\"__codelineno-3-21\" href=\"#__codelineno-3-21\"></a><span class=\"c1\">#utils/Cargo.toml</span>\n</span><span id=\"__span-3-22\"><a id=\"__codelineno-3-22\" name=\"__codelineno-3-22\" href=\"#__codelineno-3-22\"></a><span class=\"k\">[...]</span>\n</span><span id=\"__span-3-23\"><a id=\"__codelineno-3-23\" name=\"__codelineno-3-23\" href=\"#__codelineno-3-23\"></a><span class=\"k\">[dependencies]</span>\n</span><span id=\"__span-3-24\"><a id=\"__codelineno-3-24\" name=\"__codelineno-3-24\" href=\"#__codelineno-3-24\"></a><span class=\"n\">dotenv</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-3-25\"><a id=\"__codelineno-3-25\" name=\"__codelineno-3-25\" href=\"#__codelineno-3-25\"></a><span class=\"n\">thiserror</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-3-26\"><a id=\"__codelineno-3-26\" name=\"__codelineno-3-26\" href=\"#__codelineno-3-26\"></a><span class=\"n\">solana-program</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">workspace</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</span><span id=\"__span-3-27\"><a id=\"__codelineno-3-27\" name=\"__codelineno-3-27\" href=\"#__codelineno-3-27\"></a><span class=\"k\">[...]</span>\n</span></code></pre></div></p>\n<p>Now that the dependencies are sorted, let\u2019s proceed with parsing the environment.</p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">utils/src/env/env.rs</p>\n</div>\n<div class=\"language-rust highlight\"><pre><span></span><code><span id=\"__span-4-1\"><a id=\"__codelineno-4-1\" name=\"__codelineno-4-1\" href=\"#__codelineno-4-1\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::{</span><span class=\"n\">env</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fmt</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fs</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">io</span><span class=\"p\">};</span>\n</span><span id=\"__span-4-2\"><a id=\"__codelineno-4-2\" name=\"__codelineno-4-2\" href=\"#__codelineno-4-2\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">path</span><span class=\"p\">::</span><span class=\"n\">Path</span><span class=\"p\">;</span>\n</span><span id=\"__span-4-3\"><a id=\"__codelineno-4-3\" name=\"__codelineno-4-3\" href=\"#__codelineno-4-3\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">sync</span><span class=\"p\">::</span><span class=\"n\">Arc</span><span class=\"p\">;</span>\n</span><span id=\"__span-4-4\"><a id=\"__codelineno-4-4\" name=\"__codelineno-4-4\" href=\"#__codelineno-4-4\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">solana_program</span><span class=\"p\">::</span><span class=\"n\">native_token</span><span class=\"p\">::</span><span class=\"n\">lamports_to_sol</span><span class=\"p\">;</span>\n</span><span id=\"__span-4-5\"><a id=\"__codelineno-4-5\" name=\"__codelineno-4-5\" href=\"#__codelineno-4-5\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"k\">crate</span><span class=\"p\">::</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">errors</span><span class=\"p\">::</span><span class=\"n\">EnvErrors</span><span class=\"p\">;</span>\n</span><span id=\"__span-4-6\"><a id=\"__codelineno-4-6\" name=\"__codelineno-4-6\" href=\"#__codelineno-4-6\"></a>\n</span><span id=\"__span-4-7\"><a id=\"__codelineno-4-7\" name=\"__codelineno-4-7\" href=\"#__codelineno-4-7\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">Env</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-8\"><a id=\"__codelineno-4-8\" name=\"__codelineno-4-8\" href=\"#__codelineno-4-8\"></a><span class=\"w\">    </span><span class=\"n\">websocket_endpoint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Arc</span><span class=\"o\">&lt;</span><span class=\"nb\">String</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-9\"><a id=\"__codelineno-4-9\" name=\"__codelineno-4-9\" href=\"#__codelineno-4-9\"></a><span class=\"w\">    </span><span class=\"n\">rpc_endpoint</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Arc</span><span class=\"o\">&lt;</span><span class=\"nb\">String</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-10\"><a id=\"__codelineno-4-10\" name=\"__codelineno-4-10\" href=\"#__codelineno-4-10\"></a><span class=\"w\">    </span><span class=\"n\">private_key</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Arc</span><span class=\"o\">&lt;</span><span class=\"nb\">String</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-11\"><a id=\"__codelineno-4-11\" name=\"__codelineno-4-11\" href=\"#__codelineno-4-11\"></a>\n</span><span id=\"__span-4-12\"><a id=\"__codelineno-4-12\" name=\"__codelineno-4-12\" href=\"#__codelineno-4-12\"></a><span class=\"w\">    </span><span class=\"n\">swap_amount</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Arc</span><span class=\"o\">&lt;</span><span class=\"kt\">u64</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-13\"><a id=\"__codelineno-4-13\" name=\"__codelineno-4-13\" href=\"#__codelineno-4-13\"></a><span class=\"w\">    </span><span class=\"n\">swap_priority_fee</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nc\">Arc</span><span class=\"o\">&lt;</span><span class=\"kt\">u64</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-14\"><a id=\"__codelineno-4-14\" name=\"__codelineno-4-14\" href=\"#__codelineno-4-14\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-4-15\"><a id=\"__codelineno-4-15\" name=\"__codelineno-4-15\" href=\"#__codelineno-4-15\"></a>\n</span><span id=\"__span-4-16\"><a id=\"__codelineno-4-16\" name=\"__codelineno-4-16\" href=\"#__codelineno-4-16\"></a><span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">Env</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-17\"><a id=\"__codelineno-4-17\" name=\"__codelineno-4-17\" href=\"#__codelineno-4-17\"></a><span class=\"w\">    </span><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">new</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"bp\">Self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">EnvErrors</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-18\"><a id=\"__codelineno-4-18\" name=\"__codelineno-4-18\" href=\"#__codelineno-4-18\"></a><span class=\"w\">        </span><span class=\"c1\">// Test if .env exists or give the option to create one from .env.dist</span>\n</span><span id=\"__span-4-19\"><a id=\"__codelineno-4-19\" name=\"__codelineno-4-19\" href=\"#__codelineno-4-19\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Path</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"s\">&quot;.env&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-20\"><a id=\"__codelineno-4-20\" name=\"__codelineno-4-20\" href=\"#__codelineno-4-20\"></a><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">!</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"p\">.</span><span class=\"n\">exists</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-21\"><a id=\"__codelineno-4-21\" name=\"__codelineno-4-21\" href=\"#__codelineno-4-21\"></a><span class=\"w\">            </span><span class=\"fm\">println!</span><span class=\"p\">(</span><span class=\"s\">&quot;Could not find .env, would you like to use .env.dist as a template instead? (y/n)&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-22\"><a id=\"__codelineno-4-22\" name=\"__codelineno-4-22\" href=\"#__codelineno-4-22\"></a><span class=\"w\">            </span><span class=\"n\">create_env</span><span class=\"p\">().</span><span class=\"n\">expect</span><span class=\"p\">(</span><span class=\"s\">&quot;Failed creating .env file&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-23\"><a id=\"__codelineno-4-23\" name=\"__codelineno-4-23\" href=\"#__codelineno-4-23\"></a><span class=\"w\">        </span><span class=\"p\">}</span>\n</span><span id=\"__span-4-24\"><a id=\"__codelineno-4-24\" name=\"__codelineno-4-24\" href=\"#__codelineno-4-24\"></a><span class=\"w\">        </span><span class=\"n\">dotenv</span><span class=\"p\">::</span><span class=\"n\">from_path</span><span class=\"p\">(</span><span class=\"s\">&quot;.env&quot;</span><span class=\"p\">).</span><span class=\"n\">ok</span><span class=\"p\">();</span>\n</span><span id=\"__span-4-25\"><a id=\"__codelineno-4-25\" name=\"__codelineno-4-25\" href=\"#__codelineno-4-25\"></a>\n</span><span id=\"__span-4-26\"><a id=\"__codelineno-4-26\" name=\"__codelineno-4-26\" href=\"#__codelineno-4-26\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">websocket_endpoint</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">&quot;WEBSOCKET_ENDPOINT&quot;</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-27\"><a id=\"__codelineno-4-27\" name=\"__codelineno-4-27\" href=\"#__codelineno-4-27\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">rpc_endpoint</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">&quot;RPC_ENDPOINT&quot;</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-28\"><a id=\"__codelineno-4-28\" name=\"__codelineno-4-28\" href=\"#__codelineno-4-28\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">private_key</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">&quot;PRIVATE_KEYPAIR&quot;</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-29\"><a id=\"__codelineno-4-29\" name=\"__codelineno-4-29\" href=\"#__codelineno-4-29\"></a>\n</span><span id=\"__span-4-30\"><a id=\"__codelineno-4-30\" name=\"__codelineno-4-30\" href=\"#__codelineno-4-30\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">swap_amount</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">&quot;SWAP_AMOUNT&quot;</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">.</span><span class=\"n\">parse</span><span class=\"p\">::</span><span class=\"o\">&lt;</span><span class=\"kt\">u64</span><span class=\"o\">&gt;</span><span class=\"p\">().</span><span class=\"n\">unwrap</span><span class=\"p\">());</span>\n</span><span id=\"__span-4-31\"><a id=\"__codelineno-4-31\" name=\"__codelineno-4-31\" href=\"#__codelineno-4-31\"></a><span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">swap_priority_fee</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Arc</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"s\">&quot;SWAP_PRIORITY_FEE&quot;</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">.</span><span class=\"n\">parse</span><span class=\"p\">::</span><span class=\"o\">&lt;</span><span class=\"kt\">u64</span><span class=\"o\">&gt;</span><span class=\"p\">().</span><span class=\"n\">unwrap</span><span class=\"p\">());</span>\n</span><span id=\"__span-4-32\"><a id=\"__codelineno-4-32\" name=\"__codelineno-4-32\" href=\"#__codelineno-4-32\"></a>\n</span><span id=\"__span-4-33\"><a id=\"__codelineno-4-33\" name=\"__codelineno-4-33\" href=\"#__codelineno-4-33\"></a><span class=\"w\">        </span><span class=\"nb\">Ok</span><span class=\"p\">(</span>\n</span><span id=\"__span-4-34\"><a id=\"__codelineno-4-34\" name=\"__codelineno-4-34\" href=\"#__codelineno-4-34\"></a><span class=\"w\">            </span><span class=\"bp\">Self</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-35\"><a id=\"__codelineno-4-35\" name=\"__codelineno-4-35\" href=\"#__codelineno-4-35\"></a><span class=\"w\">                </span><span class=\"n\">websocket_endpoint</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-36\"><a id=\"__codelineno-4-36\" name=\"__codelineno-4-36\" href=\"#__codelineno-4-36\"></a><span class=\"w\">                </span><span class=\"n\">rpc_endpoint</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-37\"><a id=\"__codelineno-4-37\" name=\"__codelineno-4-37\" href=\"#__codelineno-4-37\"></a><span class=\"w\">                </span><span class=\"n\">private_key</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-38\"><a id=\"__codelineno-4-38\" name=\"__codelineno-4-38\" href=\"#__codelineno-4-38\"></a><span class=\"w\">                </span><span class=\"n\">swap_amount</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-39\"><a id=\"__codelineno-4-39\" name=\"__codelineno-4-39\" href=\"#__codelineno-4-39\"></a><span class=\"w\">                </span><span class=\"n\">swap_priority_fee</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-40\"><a id=\"__codelineno-4-40\" name=\"__codelineno-4-40\" href=\"#__codelineno-4-40\"></a><span class=\"w\">            </span><span class=\"p\">}</span>\n</span><span id=\"__span-4-41\"><a id=\"__codelineno-4-41\" name=\"__codelineno-4-41\" href=\"#__codelineno-4-41\"></a><span class=\"w\">        </span><span class=\"p\">)</span>\n</span><span id=\"__span-4-42\"><a id=\"__codelineno-4-42\" name=\"__codelineno-4-42\" href=\"#__codelineno-4-42\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-4-43\"><a id=\"__codelineno-4-43\" name=\"__codelineno-4-43\" href=\"#__codelineno-4-43\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-4-44\"><a id=\"__codelineno-4-44\" name=\"__codelineno-4-44\" href=\"#__codelineno-4-44\"></a>\n</span><span id=\"__span-4-45\"><a id=\"__codelineno-4-45\" name=\"__codelineno-4-45\" href=\"#__codelineno-4-45\"></a><span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">fmt</span><span class=\"p\">::</span><span class=\"n\">Display</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Env</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-46\"><a id=\"__codelineno-4-46\" name=\"__codelineno-4-46\" href=\"#__codelineno-4-46\"></a><span class=\"w\">    </span><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">fmt</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"bp\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kp\">&amp;</span><span class=\"nc\">mut</span><span class=\"w\"> </span><span class=\"n\">fmt</span><span class=\"p\">::</span><span class=\"n\">Formatter</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">fmt</span><span class=\"p\">::</span><span class=\"nb\">Result</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-47\"><a id=\"__codelineno-4-47\" name=\"__codelineno-4-47\" href=\"#__codelineno-4-47\"></a><span class=\"w\">        </span><span class=\"fm\">writeln!</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;===================== ENVS Loaded =====================</span><span class=\"se\">\\r\\n</span><span class=\"s\">\\</span>\n</span><span id=\"__span-4-48\"><a id=\"__codelineno-4-48\" name=\"__codelineno-4-48\" href=\"#__codelineno-4-48\"></a><span class=\"s\">        websocket_endpoint: {:?}</span><span class=\"se\">\\r\\n</span><span class=\"s\">\\</span>\n</span><span id=\"__span-4-49\"><a id=\"__codelineno-4-49\" name=\"__codelineno-4-49\" href=\"#__codelineno-4-49\"></a><span class=\"s\">        rpc endpoint:       {:?}</span><span class=\"se\">\\r\\n</span><span class=\"s\">\\</span>\n</span><span id=\"__span-4-50\"><a id=\"__codelineno-4-50\" name=\"__codelineno-4-50\" href=\"#__codelineno-4-50\"></a><span class=\"s\">        private wallet:     {:?}</span><span class=\"se\">\\r\\n</span><span class=\"s\">\\</span>\n</span><span id=\"__span-4-51\"><a id=\"__codelineno-4-51\" name=\"__codelineno-4-51\" href=\"#__codelineno-4-51\"></a><span class=\"s\">        swap amount:        {:?} sol</span><span class=\"se\">\\r\\n</span><span class=\"s\">\\</span>\n</span><span id=\"__span-4-52\"><a id=\"__codelineno-4-52\" name=\"__codelineno-4-52\" href=\"#__codelineno-4-52\"></a><span class=\"s\">        swap_priority_fee:  {:?} sol</span><span class=\"se\">\\r\\n</span><span class=\"s\">\\</span>\n</span><span id=\"__span-4-53\"><a id=\"__codelineno-4-53\" name=\"__codelineno-4-53\" href=\"#__codelineno-4-53\"></a><span class=\"s\">        total per trade:    {:?} sol</span><span class=\"se\">\\r\\n</span><span class=\"s\">\\</span>\n</span><span id=\"__span-4-54\"><a id=\"__codelineno-4-54\" name=\"__codelineno-4-54\" href=\"#__codelineno-4-54\"></a><span class=\"s\">        =====================================================&quot;</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-55\"><a id=\"__codelineno-4-55\" name=\"__codelineno-4-55\" href=\"#__codelineno-4-55\"></a><span class=\"w\">                 </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">websocket_endpoint</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-56\"><a id=\"__codelineno-4-56\" name=\"__codelineno-4-56\" href=\"#__codelineno-4-56\"></a><span class=\"w\">                 </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">rpc_endpoint</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-57\"><a id=\"__codelineno-4-57\" name=\"__codelineno-4-57\" href=\"#__codelineno-4-57\"></a><span class=\"w\">                 </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">private_key</span><span class=\"p\">,</span>\n</span><span id=\"__span-4-58\"><a id=\"__codelineno-4-58\" name=\"__codelineno-4-58\" href=\"#__codelineno-4-58\"></a><span class=\"w\">                 </span><span class=\"n\">lamports_to_sol</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">swap_amount</span><span class=\"p\">),</span>\n</span><span id=\"__span-4-59\"><a id=\"__codelineno-4-59\" name=\"__codelineno-4-59\" href=\"#__codelineno-4-59\"></a><span class=\"w\">                 </span><span class=\"n\">lamports_to_sol</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">swap_priority_fee</span><span class=\"p\">),</span>\n</span><span id=\"__span-4-60\"><a id=\"__codelineno-4-60\" name=\"__codelineno-4-60\" href=\"#__codelineno-4-60\"></a><span class=\"w\">                 </span><span class=\"n\">lamports_to_sol</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">swap_amount</span><span class=\"p\">.</span><span class=\"n\">clone</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">swap_priority_fee</span><span class=\"p\">.</span><span class=\"n\">clone</span><span class=\"p\">())</span>\n</span><span id=\"__span-4-61\"><a id=\"__codelineno-4-61\" name=\"__codelineno-4-61\" href=\"#__codelineno-4-61\"></a><span class=\"w\">        </span><span class=\"p\">)</span>\n</span><span id=\"__span-4-62\"><a id=\"__codelineno-4-62\" name=\"__codelineno-4-62\" href=\"#__codelineno-4-62\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-4-63\"><a id=\"__codelineno-4-63\" name=\"__codelineno-4-63\" href=\"#__codelineno-4-63\"></a><span class=\"p\">}</span>\n</span><span id=\"__span-4-64\"><a id=\"__codelineno-4-64\" name=\"__codelineno-4-64\" href=\"#__codelineno-4-64\"></a>\n</span><span id=\"__span-4-65\"><a id=\"__codelineno-4-65\" name=\"__codelineno-4-65\" href=\"#__codelineno-4-65\"></a><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">create_env</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">-&gt;</span><span class=\"w\"> </span><span class=\"nc\">std</span><span class=\"p\">::</span><span class=\"n\">io</span><span class=\"p\">::</span><span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"p\">()</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-66\"><a id=\"__codelineno-4-66\" name=\"__codelineno-4-66\" href=\"#__codelineno-4-66\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">source</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;.env.dist&quot;</span><span class=\"p\">;</span>\n</span><span id=\"__span-4-67\"><a id=\"__codelineno-4-67\" name=\"__codelineno-4-67\" href=\"#__codelineno-4-67\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">destination</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;.env&quot;</span><span class=\"p\">;</span>\n</span><span id=\"__span-4-68\"><a id=\"__codelineno-4-68\" name=\"__codelineno-4-68\" href=\"#__codelineno-4-68\"></a>\n</span><span id=\"__span-4-69\"><a id=\"__codelineno-4-69\" name=\"__codelineno-4-69\" href=\"#__codelineno-4-69\"></a><span class=\"w\">    </span><span class=\"fm\">println!</span><span class=\"p\">(</span><span class=\"s\">&quot;Do you want to copy &#39;{}&#39; to &#39;{}&#39; (y/n)?&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">source</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">destination</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-70\"><a id=\"__codelineno-4-70\" name=\"__codelineno-4-70\" href=\"#__codelineno-4-70\"></a>\n</span><span id=\"__span-4-71\"><a id=\"__codelineno-4-71\" name=\"__codelineno-4-71\" href=\"#__codelineno-4-71\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">String</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">();</span>\n</span><span id=\"__span-4-72\"><a id=\"__codelineno-4-72\" name=\"__codelineno-4-72\" href=\"#__codelineno-4-72\"></a><span class=\"w\">    </span><span class=\"n\">io</span><span class=\"p\">::</span><span class=\"n\">stdin</span><span class=\"p\">().</span><span class=\"n\">read_line</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">;</span>\n</span><span id=\"__span-4-73\"><a id=\"__codelineno-4-73\" name=\"__codelineno-4-73\" href=\"#__codelineno-4-73\"></a>\n</span><span id=\"__span-4-74\"><a id=\"__codelineno-4-74\" name=\"__codelineno-4-74\" href=\"#__codelineno-4-74\"></a><span class=\"w\">    </span><span class=\"c1\">// Trim input and check the response</span>\n</span><span id=\"__span-4-75\"><a id=\"__codelineno-4-75\" name=\"__codelineno-4-75\" href=\"#__codelineno-4-75\"></a><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">input</span><span class=\"p\">.</span><span class=\"n\">trim</span><span class=\"p\">().</span><span class=\"n\">eq_ignore_ascii_case</span><span class=\"p\">(</span><span class=\"s\">&quot;y&quot;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-76\"><a id=\"__codelineno-4-76\" name=\"__codelineno-4-76\" href=\"#__codelineno-4-76\"></a><span class=\"w\">        </span><span class=\"c1\">// Perform the copy</span>\n</span><span id=\"__span-4-77\"><a id=\"__codelineno-4-77\" name=\"__codelineno-4-77\" href=\"#__codelineno-4-77\"></a><span class=\"w\">        </span><span class=\"n\">fs</span><span class=\"p\">::</span><span class=\"n\">copy</span><span class=\"p\">(</span><span class=\"n\">source</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">destination</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"p\">;</span>\n</span><span id=\"__span-4-78\"><a id=\"__codelineno-4-78\" name=\"__codelineno-4-78\" href=\"#__codelineno-4-78\"></a><span class=\"w\">        </span><span class=\"fm\">println!</span><span class=\"p\">(</span><span class=\"s\">&quot;File successfully copied to &#39;{}&#39;.&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">destination</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-79\"><a id=\"__codelineno-4-79\" name=\"__codelineno-4-79\" href=\"#__codelineno-4-79\"></a><span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-4-80\"><a id=\"__codelineno-4-80\" name=\"__codelineno-4-80\" href=\"#__codelineno-4-80\"></a><span class=\"w\">        </span><span class=\"fm\">println!</span><span class=\"p\">(</span><span class=\"s\">&quot;Operation canceled.&quot;</span><span class=\"p\">);</span>\n</span><span id=\"__span-4-81\"><a id=\"__codelineno-4-81\" name=\"__codelineno-4-81\" href=\"#__codelineno-4-81\"></a><span class=\"w\">    </span><span class=\"p\">}</span>\n</span><span id=\"__span-4-82\"><a id=\"__codelineno-4-82\" name=\"__codelineno-4-82\" href=\"#__codelineno-4-82\"></a>\n</span><span id=\"__span-4-83\"><a id=\"__codelineno-4-83\" name=\"__codelineno-4-83\" href=\"#__codelineno-4-83\"></a><span class=\"w\">    </span><span class=\"nb\">Ok</span><span class=\"p\">(())</span>\n</span><span id=\"__span-4-84\"><a id=\"__codelineno-4-84\" name=\"__codelineno-4-84\" href=\"#__codelineno-4-84\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>In the above, we define the <code>Env</code> struct with a ::new method. As a bonus, if you haven't created a <code>.env</code> file with the correct variables, you can use the version from the GitHub repo, and it will prompt you to create the file. Additionally, we implement Display for <code>Env</code> to print it in a controlled way using println!.</p>\n<p>Note that we won't implement the correct data type for the private keypair until it's necessary.</p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">utils/src/env/errors.rs</p>\n</div>\n<div class=\"language-Rust highlight\"><pre><span></span><code><span id=\"__span-5-1\"><a id=\"__codelineno-5-1\" name=\"__codelineno-5-1\" href=\"#__codelineno-5-1\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"p\">::</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">VarError</span><span class=\"p\">;</span>\n</span><span id=\"__span-5-2\"><a id=\"__codelineno-5-2\" name=\"__codelineno-5-2\" href=\"#__codelineno-5-2\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">thiserror</span><span class=\"p\">::</span><span class=\"n\">Error</span><span class=\"p\">;</span>\n</span><span id=\"__span-5-3\"><a id=\"__codelineno-5-3\" name=\"__codelineno-5-3\" href=\"#__codelineno-5-3\"></a>\n</span><span id=\"__span-5-4\"><a id=\"__codelineno-5-4\" name=\"__codelineno-5-4\" href=\"#__codelineno-5-4\"></a><span class=\"cp\">#[derive(Error, Debug)]</span>\n</span><span id=\"__span-5-5\"><a id=\"__codelineno-5-5\" name=\"__codelineno-5-5\" href=\"#__codelineno-5-5\"></a><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">enum</span><span class=\"w\"> </span><span class=\"nc\">EnvErrors</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-5-6\"><a id=\"__codelineno-5-6\" name=\"__codelineno-5-6\" href=\"#__codelineno-5-6\"></a><span class=\"w\">    </span><span class=\"cp\">#[error(</span><span class=\"s\">&quot;Missing .env file&quot;</span><span class=\"cp\">)]</span>\n</span><span id=\"__span-5-7\"><a id=\"__codelineno-5-7\" name=\"__codelineno-5-7\" href=\"#__codelineno-5-7\"></a><span class=\"w\">    </span><span class=\"n\">MissingEnvFile</span><span class=\"p\">,</span>\n</span><span id=\"__span-5-8\"><a id=\"__codelineno-5-8\" name=\"__codelineno-5-8\" href=\"#__codelineno-5-8\"></a>\n</span><span id=\"__span-5-9\"><a id=\"__codelineno-5-9\" name=\"__codelineno-5-9\" href=\"#__codelineno-5-9\"></a><span class=\"w\">    </span><span class=\"cp\">#[error(</span><span class=\"s\">&quot;environment variable {0} set&quot;</span><span class=\"cp\">)]</span>\n</span><span id=\"__span-5-10\"><a id=\"__codelineno-5-10\" name=\"__codelineno-5-10\" href=\"#__codelineno-5-10\"></a><span class=\"w\">    </span><span class=\"n\">EnvVarNotFound</span><span class=\"p\">(</span><span class=\"nb\">String</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">VarError</span><span class=\"p\">),</span>\n</span><span id=\"__span-5-11\"><a id=\"__codelineno-5-11\" name=\"__codelineno-5-11\" href=\"#__codelineno-5-11\"></a>\n</span><span id=\"__span-5-12\"><a id=\"__codelineno-5-12\" name=\"__codelineno-5-12\" href=\"#__codelineno-5-12\"></a><span class=\"w\">    </span><span class=\"cp\">#[error(</span><span class=\"s\">&quot;Invalid ENV {0} file&quot;</span><span class=\"cp\">)]</span>\n</span><span id=\"__span-5-13\"><a id=\"__codelineno-5-13\" name=\"__codelineno-5-13\" href=\"#__codelineno-5-13\"></a><span class=\"w\">    </span><span class=\"n\">InvalidEnv</span><span class=\"p\">(</span><span class=\"cp\">#[from]</span><span class=\"w\"> </span><span class=\"n\">VarError</span><span class=\"p\">),</span>\n</span><span id=\"__span-5-14\"><a id=\"__codelineno-5-14\" name=\"__codelineno-5-14\" href=\"#__codelineno-5-14\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<p>Here, we use <code>thiserror</code> to define the errors that may occur in <code>Env::new</code>, such as a missing file, missing environment variables, or invalid environment configurations.</p>\n<p>Now, let\u2019s give it a try.</p>\n<div class=\"admonition tip\">\n<p class=\"admonition-title\">sniper/srv/mains.rs</p>\n</div>\n<p><div class=\"language-rust highlight\"><pre><span></span><code><span id=\"__span-6-1\"><a id=\"__codelineno-6-1\" name=\"__codelineno-6-1\" href=\"#__codelineno-6-1\"></a><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">utils</span><span class=\"p\">::</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">env</span><span class=\"p\">::</span><span class=\"n\">Env</span><span class=\"p\">;</span>\n</span><span id=\"__span-6-2\"><a id=\"__codelineno-6-2\" name=\"__codelineno-6-2\" href=\"#__codelineno-6-2\"></a><span class=\"k\">fn</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</span><span id=\"__span-6-3\"><a id=\"__codelineno-6-3\" name=\"__codelineno-6-3\" href=\"#__codelineno-6-3\"></a><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Env</span><span class=\"p\">::</span><span class=\"n\">new</span><span class=\"p\">();</span>\n</span><span id=\"__span-6-4\"><a id=\"__codelineno-6-4\" name=\"__codelineno-6-4\" href=\"#__codelineno-6-4\"></a><span class=\"w\">    </span><span class=\"fm\">println!</span><span class=\"p\">(</span><span class=\"s\">&quot;{}&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">env</span><span class=\"p\">.</span><span class=\"n\">unwrap</span><span class=\"p\">());</span>\n</span><span id=\"__span-6-5\"><a id=\"__codelineno-6-5\" name=\"__codelineno-6-5\" href=\"#__codelineno-6-5\"></a>\n</span><span id=\"__span-6-6\"><a id=\"__codelineno-6-6\" name=\"__codelineno-6-6\" href=\"#__codelineno-6-6\"></a><span class=\"p\">}</span>\n</span></code></pre></div>\n<div class=\"language-bash highlight\"><pre><span></span><code><span id=\"__span-7-1\"><a id=\"__codelineno-7-1\" name=\"__codelineno-7-1\" href=\"#__codelineno-7-1\"></a>cargo<span class=\"w\"> </span>run<span class=\"w\"> </span>--bin<span class=\"w\"> </span>sniper\n</span></code></pre></div></p>\n<p>this should print out something that corresponds to the image below</p>\n<figure>\n<p><img alt=\"Output of the loaded env variables\" src=\"/static/raydium_sniper_part_1/Screenshot 2025-01-05 at 23.51.21.png\" /></p>\n<figcaption>\n<p>Output of the loaded env variables</p>\n</figcaption>\n</figure>\n<h2 id=\"up-next\">Up next</h2>\n<p>In the next article, we\u2019ll dive into Solana transactions, websockets, and RPC to listen for newly created tokens. Thanks for reading this tutorial! Don\u2019t forget to subscribe so you won\u2019t miss the next part of the series.</p>", "image": null, "date_modified": "2025-02-06T13:06:57+00:00", "authors": [{"name": "Alexander H\u00f8gh"}], "tags": ["Solana", "Solana Sniper"]}]}